% ------------------------------------------------------------
% Autogenerated LaTeX file for books
% db2latex RELEASE: 0.8pre1
% db2latex VERSION: $Id: VERSION.xml,v 1.6 2004/01/31 12:47:11 j-devenish Exp $
% fithesis VERSION: 1.40
% ------------------------------------------------------------
\def\clsclass{rapport3}
\documentclass{fithesis}
% --------------------------------------------
% MetaFont and MetaPost logo support
% --------------------------------------------
\usepackage{mflogo}
% --------------------------------------------
% Load fithesis param 
% --------------------------------------------
\thesistitle{Generování rostlin pomocí L-systémù}
\thesissubtitle{Diplomová práce}
\thesisstudent{Marek Pasiènyk}
\thesiswoman{false}
\thesislang{cs}
\thesisyear{jaro 2010}
\thesisfaculty{fi}
\thesisadvisor{RNDr. Vít Kovalèík, Ph.D.}
% --------------------------------------------
\label{id323181}\usepackage{ifthen}
% --------------------------------------------
% Check for PDFLaTeX/LaTeX 
% --------------------------------------------
\newif\ifpdf
\ifx\pdfoutput\undefined
\pdffalse % we are not running PDF\LaTeX 
\else
\pdfoutput=1 % we are running PDF\LaTeX 
\pdftrue
\fi
% --------------------------------------------
% Load graphicx package with pdf if needed 
% --------------------------------------------
\ifpdf
\usepackage[pdftex]{graphicx}
\pdfcompresslevel=9
\else
\usepackage{graphicx}
\fi
\usepackage{anysize}
\marginsize{3cm}{2.5cm}{3.5cm}{3.5cm}

\makeatletter
% redefine the listoffigures and listoftables so that the name of the chapter
% is printed whenever there are figures or tables from that chapter. encourage
% pagebreak prior to the name of the chapter (discourage orphans).
\let\save@@chapter\@chapter
\let\save@@l@figure\l@figure
\let\the@l@figure@leader\relax
\def\@chapter[#1]#2{\save@@chapter[{#1}]{#2}%
\addtocontents{lof}{\protect\def\the@l@figure@leader{\protect\pagebreak[0]\protect\contentsline{chapter}{\protect\numberline{\thechapter}#1}{}{\thepage}}}%
\addtocontents{lot}{\protect\def\the@l@figure@leader{\protect\pagebreak[0]\protect\contentsline{chapter}{\protect\numberline{\thechapter}#1}{}{\thepage}}}%
}
\renewcommand*\l@figure{\the@l@figure@leader\let\the@l@figure@leader\relax\save@@l@figure}
\let\l@table\l@figure
\makeatother
\usepackage{fancyhdr}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}
% Safeguard against long headers.
\IfFileExists{truncate.sty}{
\usepackage{truncate}
% Use an ellipsis when text would be larger than x% of the text width.
% Preserve left/right text alignment using \hfill (works for English).
\fancyhead[ol]{\truncate{0.49\textwidth}{\sl\leftmark}}
\fancyhead[er]{\truncate{0.49\textwidth}{\hfill\sl\rightmark}}
\fancyhead[el]{\truncate{0.49\textwidth}{\sl\leftmark}}
\fancyhead[or]{\truncate{0.49\textwidth}{\hfill\sl\rightmark}}
}{\typeout{WARNING: truncate.sty wasn't available and functionality was skipped.}}
\pagestyle{fancy}
% ---------------------- 
% Most Common Packages   
% ---------------------- 
\usepackage{latexsym}         
\usepackage{enumerate}         
\usepackage{fancybox}      
\usepackage{float}       
\usepackage{ragged2e}       
\usepackage{fancyvrb}         
\makeatletter\@namedef{FV@fontfamily@default}{\def\FV@FontScanPrep{}\def\FV@FontFamily{}}\makeatother
\fvset{obeytabs=true,tabsize=3}
\makeatletter
\let\dblatex@center\center\let\dblatex@endcenter\endcenter
\def\dblatex@nolistI{\leftmargin\leftmargini\topsep\z@ \parsep\parskip \itemsep\z@}
\def\center{\let\@listi\dblatex@nolistI\@listi\dblatex@center\let\@listi\@listI\@listi}
\def\endcenter{\dblatex@endcenter}
\makeatother
\usepackage{rotating}         
\usepackage{subfigure}         
\usepackage{tabularx}         
\usepackage{url}         
% --------------------------------------------
% Load hyperref package with pdf if needed 
% --------------------------------------------
\ifpdf
\usepackage[pdftex,bookmarksnumbered,colorlinks,backref,bookmarks,breaklinks,linktocpage,plainpages=false, pdfstartview=FitH, plainpages=false, pdfpagelabels, unicode]{hyperref}
\else
\usepackage[bookmarksnumbered,colorlinks,backref,bookmarks,breaklinks,linktocpage,plainpages=false, plainpages=false, pdfpagelabels]{hyperref}
\fi
% --------------------------------------------
% ----------------------------------------------
% Define a new LaTeX environment (adminipage)
% ----------------------------------------------
\newenvironment{admminipage}%
{ % this code corresponds to the \begin{adminipage} command
 \begin{Sbox}%
 \begin{minipage}%
} %done
{ % this code corresponds to the \end{adminipage} command
 \end{minipage}
 \end{Sbox}
 \fbox{\TheSbox}
} %done
% ----------------------------------------------
% Define a new LaTeX length (admlength)
% ----------------------------------------------
\newlength{\admlength}
% ----------------------------------------------
% Define a new LaTeX environment (admonition)
% With 2 parameters:
% #1 The file (e.g. note.pdf)
% #2 The caption
% ----------------------------------------------
\newenvironment{admonition}[2] 
{ % this code corresponds to the \begin{admonition} command
 \hspace{0mm}\newline\hspace*\fill\newline
 \noindent
 \setlength{\fboxsep}{5pt}
 \setlength{\admlength}{\linewidth}
 \addtolength{\admlength}{-10\fboxsep}
 \addtolength{\admlength}{-10\fboxrule}
 \admminipage{\admlength}
 {\bfseries \sc\large{#2}} \newline
 \\[1mm]
 \sffamily
 \includegraphics[width=1cm]{#1}
 \addtolength{\admlength}{-1cm}
 \addtolength{\admlength}{-20pt}
 \begin{minipage}[lt]{\admlength}
 \parskip=0.5\baselineskip \advance\parskip by 0pt plus 2pt
} %done
{ % this code corresponds to the \end{admonition} command
 \vspace{5mm} 
 \end{minipage}
 \endadmminipage
 \vspace{.5em}
 \par
}
% --------------------------------------------
% Commands to manage/style/create floats      
% figures, tables, algorithms, examples, eqn  
% --------------------------------------------
 \floatstyle{plain}
 \restylefloat{figure}
 \floatstyle{plain}
 \restylefloat{table}
 \floatstyle{plain}
 \newfloat{program}{ht}{lop}[section]
 \floatstyle{plain}
 \newfloat{example}{ht}{loe}[section]
 \floatname{example}{Pøíklad}
 \floatstyle{plain}
 \newfloat{dbequation}{ht}{loe}[section]
 \floatname{dbequation}{Rovnice}
 \floatstyle{boxed}
 \newfloat{algorithm}{ht}{loa}[section]
 \floatname{algorithm}{Algorithm}
\ifpdf
\DeclareGraphicsExtensions{.pdf,.png,.jpg}
\else
\DeclareGraphicsExtensions{.eps}
\fi
% --------------------------------------------
% $latex.caption.swapskip enabled for $formal.title.placement support
\newlength{\docbooktolatextempskip}
\newcommand{\captionswapskip}{\setlength{\docbooktolatextempskip}{\abovecaptionskip}\setlength{\abovecaptionskip}{\belowcaptionskip}\setlength{\belowcaptionskip}{\docbooktolatextempskip}}
\usepackage[czech]{babel} 
% Guard against a problem with old package versions.
\makeatletter
\AtBeginDocument{
\DeclareRobustCommand\ref{\@refstar}
\DeclareRobustCommand\pageref{\@pagerefstar}
}
\makeatother
% --------------------------------------------
\makeatletter
\newcommand{\dbz}{\penalty \z@}
\newcommand{\docbooktolatexpipe}{\ensuremath{|}\dbz}
\newskip\docbooktolatexoldparskip
\newcommand{\docbooktolatexnoparskip}{\docbooktolatexoldparskip=\parskip\parskip=0pt plus 1pt}
\newcommand{\docbooktolatexrestoreparskip}{\parskip=\docbooktolatexoldparskip}
\def\cleardoublepage{\clearpage\if@twoside \ifodd\c@page\else\hbox{}\thispagestyle{empty}\newpage\if@twocolumn\hbox{}\newpage\fi\fi\fi}
\usepackage[latin2]{inputenc}
\usepackage[T1]{fontenc}

\ifx\dblatex@chaptersmark\@undefined\def\dblatex@chaptersmark#1{\markboth{\MakeUppercase{#1}}{}}\fi
\let\save@makeschapterhead\@makeschapterhead
\def\dblatex@makeschapterhead#1{\vspace*{-80pt}\save@makeschapterhead{#1}}
\def\@makeschapterhead#1{\dblatex@makeschapterhead{#1}\dblatex@chaptersmark{#1}}

\AtBeginDocument{\ifx\refname\@undefined\let\docbooktolatexbibname\bibname\def\docbooktolatexbibnamex{\bibname}\else\let\docbooktolatexbibname\refname\def\docbooktolatexbibnamex{\refname}\fi}
% Facilitate use of \cite with \label
\newcommand{\docbooktolatexbibaux}[2]{%
  \protected@write\@auxout{}{\string\global\string\@namedef{docbooktolatexcite@#1}{#2}}
}
% Provide support for bibliography `subsection' environments with titles
\newenvironment{docbooktolatexbibliography}[3]{
   \begingroup
   \let\save@@chapter\chapter
   \let\save@@section\section
   \let\save@@@mkboth\@mkboth
   \let\save@@bibname\bibname
   \let\save@@refname\refname
   \let\@mkboth\@gobbletwo
   \def\@tempa{#3}
   \def\@tempb{}
   \ifx\@tempa\@tempb
      \let\chapter\@gobbletwo
      \let\section\@gobbletwo
      \let\bibname\relax
   \else
      \let\chapter#2
      \let\section#2
      \let\bibname\@tempa
   \fi
   \let\refname\bibname
   \begin{thebibliography}{#1}
}{
   \end{thebibliography}
   \let\chapter\save@@chapter
   \let\section\save@@section
   \let\@mkboth\save@@@mkboth
   \let\bibname\save@@bibname
   \let\refname\save@@refname
   \endgroup
}

%\usepackage{cite}
%\renewcommand\citeleft{(}  % parentheses around list
%\renewcommand\citeright{)} % parentheses around list
\newcommand{\docbooktolatexcite}[2]{%
  \@ifundefined{docbooktolatexcite@#1}%
  {\cite{#1}}%
  {\def\@docbooktolatextemp{#2}\ifx\@docbooktolatextemp\@empty%
   \cite{\@nameuse{docbooktolatexcite@#1}}%
   \else\cite[#2]{\@nameuse{docbooktolatexcite@#1}}%
   \fi%
  }%
}
\newcommand{\docbooktolatexbackcite}[1]{%
  \ifx\Hy@backout\@undefined\else%
    \@ifundefined{docbooktolatexcite@#1}{%
      % emit warning?
    }{%
      \ifBR@verbose%
        \PackageInfo{backref}{back cite \string`#1\string' as \string`\@nameuse{docbooktolatexcite@#1}\string'}%
      \fi%
      \Hy@backout{\@nameuse{docbooktolatexcite@#1}}%
    }%
  \fi%
}

% --------------------------------------------
% A way to honour <footnoteref>s
% Blame j-devenish (at) users.sourceforge.net
% In any other LaTeX context, this would probably go into a style file.
\newcommand{\docbooktolatexusefootnoteref}[1]{\@ifundefined{@fn@label@#1}%
  {\hbox{\@textsuperscript{\normalfont ?}}%
    \@latex@warning{Footnote label `#1' was not defined}}%
  {\@nameuse{@fn@label@#1}}}
\newcommand{\docbooktolatexmakefootnoteref}[1]{%
  \protected@write\@auxout{}%
    {\global\string\@namedef{@fn@label@#1}{\@makefnmark}}%
  \@namedef{@fn@label@#1}{\hbox{\@textsuperscript{\normalfont ?}}}%
  }

\makeindex
% index labeling helper
\newif\ifdocbooktolatexprintindex\docbooktolatexprintindextrue
\let\dbtolatex@@theindex\theindex
\let\dbtolatex@@endtheindex\endtheindex
\@ifundefined{@openrighttrue}{\newif\if@openright}{}
\def\theindex{\relax}
\def\endtheindex{\relax}
\newenvironment{dbtolatexindex}[2]
   {
\if@openright\cleardoublepage\else\clearpage\fi
\let\dbtolatex@@indexname\indexname
\def\dbtolatex@current@indexname{#2}
\ifx\dbtolatex@current@indexname\@empty                                                                                             \def\dbtolatex@current@indexname{\dbtolatex@@indexname}
\fi
\def\dbtolatex@indexlabel{%
 \ifnum \c@secnumdepth >\m@ne \ifx\c@chapter\undefined\refstepcounter{section}\else\refstepcounter{chapter}\fi\fi%
 \label{#1}\hypertarget{#1}{\dbtolatex@current@indexname}%
 \global\docbooktolatexprintindexfalse}
\def\indexname{\ifdocbooktolatexprintindex\dbtolatex@indexlabel\else\dbtolatex@current@indexname\fi}
\dbtolatex@@theindex
   }
   {
\dbtolatex@@endtheindex\let\indexname\dbtolatex@@indexname
   }

\newlength\saveparskip \newlength\saveparindent
\newlength\tempparskip \newlength\tempparindent

\def\docbooktolatexgobble{\expandafter\@gobble}
% Prevent multiple openings of the same aux file
% (happens when backref is used with multiple bibliography environments)
\ifx\AfterBeginDocument\undefined\let\AfterBeginDocument\AtBeginDocument\fi
\AfterBeginDocument{
   \let\latex@@starttoc\@starttoc
   \def\@starttoc#1{%
      \@ifundefined{docbooktolatex@aux#1}{%
         \global\@namedef{docbooktolatex@aux#1}{}%
         \latex@@starttoc{#1}%
      }{}
   }
}
% --------------------------------------------
% Hacks for honouring row/entry/@align
% (\hspace not effective when in paragraph mode)
% Naming convention for these macros is:
% 'docbooktolatex' 'align' {alignment-type} {position-within-entry}
% where r = right, l = left, c = centre
\newcommand{\docbooktolatex@align}[2]{\protect\ifvmode#1\else\ifx\LT@@tabarray\@undefined#2\else#1\fi\fi}
\newcommand{\docbooktolatexalignll}{\docbooktolatex@align{\raggedright}{}}
\newcommand{\docbooktolatexalignlr}{\docbooktolatex@align{}{\hspace*\fill}}
\newcommand{\docbooktolatexaligncl}{\docbooktolatex@align{\centering}{\hfill}}
\newcommand{\docbooktolatexaligncr}{\docbooktolatex@align{}{\hspace*\fill}}
\newcommand{\docbooktolatexalignrl}{\protect\ifvmode\raggedleft\else\hfill\fi}
\newcommand{\docbooktolatexalignrr}{}
\ifx\captionswapskip\@undefined\newcommand{\captionswapskip}{}\fi
\makeatother
\title{\bfseries Generování rostlin pomocí L-systémù\\[12pt]\normalsize Diplomová práce}
\author{Marek Pasiènyk}
% --------------------------------------------
\makeglossary
% --------------------------------------------

\setcounter{tocdepth}{4}

\setcounter{secnumdepth}{4}
\addto\captionsczech{\def\indexname{Rejst\v{r}\'{\i}k}}
\addto\captionsczech{\def\appendixname{P\v{r}\'{i}loha}}
\addto\captionsczech{\def\refname{Literatura}}
\begin{document}
% --------------------------------------------
% Useing fithesis
% --------------------------------------------
\FrontMatter
\ThesisTitlePage
\begin{ThesisDeclaration}
\DeclarationText
\AdvisorName
\end{ThesisDeclaration}

% --------------------------------------------
% Thanks 
% --------------------------------------------
\begin{ThesisThanks}

Chtìl bych podìkovat
\end{ThesisThanks}

% --------------------------------------------
% Abstract 
% --------------------------------------------
\begin{ThesisAbstract}

Tato práce se zabývá problematikou Lindenmayerovýchsystémù, jako¾to nástroje pro generování rostlin. Rozebírá pak také metody a implementaci L-systémù a jejich grafickou implementaci. Souèástí je i zásuvný modul pro generování rostlin pro systém Vrecko.
\end{ThesisAbstract}

% --------------------------------------------
% KeyWords 
% --------------------------------------------
\begin{ThesisKeyWords}
AEC, CAD, OpenGL, plovoucí podlahy, návrh interiéru, vizualizace interiéru, kladeèské plány, FloorPlanner\end{ThesisKeyWords}

\makeatletter
\def\dbtolatex@contentsid{id397556}
\def\dbtolatex@@contentsname{\latex@@contentsname}
\let\latex@@contentsname\contentsname
\newif\ifdocbooktolatexcontentsname\docbooktolatexcontentsnametrue
\def\dbtolatex@contentslabel{%
 \label{\dbtolatex@contentsid}\hypertarget{\dbtolatex@contentsid}{\dbtolatex@@contentsname}%
 \global\docbooktolatexcontentsnamefalse}
\def\contentsname{\ifdocbooktolatexcontentsname\dbtolatex@contentslabel\else\dbtolatex@@contentsname\fi}
\let\save@@@mkboth\@mkboth
\let\@mkboth\@gobbletwo
\tableofcontents
\let\@mkboth\save@@@mkboth
\let\contentsname\latex@@contentsname
\Hy@writebookmark{}{\dbtolatex@@contentsname}{\dbtolatex@contentsid}{0}{toc}%
\makeatother
				\MainMatter

% -------------------------------------------------------------
% Chapter Úvod 
% ------------------------------------------------------------- 	
\chapter{Úvod}
\label{ch01}\hypertarget{ch01}{}%

% -------------------------------------------------------------
% Chapter Lindenmayerovy systémy 
% ------------------------------------------------------------- 	
\chapter{Lindenmayerovy systémy}
\label{ch02}\hypertarget{ch02}{}%

Lindenmayerovy systémy, zkrácenì L-systémy, byly vytvoøeny jako matematická teorie pro generování rostlin(82ABOP). Pùvodnì byl kladen dùraz spí¹e na obecnou topologii. Byly toti¾ vytvoøeny pro simulaci vývoje vìt¹ích èástí rostlin nebo bunìk mnhobunìèných organismù. Geometrie, ani podrobnìj¹í detaily v~této pùvodní teorii zahrnuty nebyly. Pozdìji se objevilo nìkolik geometrických interpretací L-systémù, díky nim¾ se staly L-systémy univerzálním nástrojem pro simulaci a modelování rostlin. Ve své práci pou¾ívám modelování pomocí ¾elví grafiky.

% ------------------------   
% Section 
\section{Vývoj rostlin pomocí procesu pøepisování}
\label{sec0201}\hypertarget{sec0201}{}%

Jádro L-systémù spoèívá v~pou¾ití pøepisovacího systému. Jedná se o~opakované nahrazování modulù pøedchùdcù pomocí sady pøepisovacích pravidel jejich následovníky, pøièem¾ v¹echny moduly nále¾í do koneèné abecedy modulù. Lze tak z~jednoduchého pùvodního objektu vytvoøit opakováním pøepisovacího procesu komplexní model. Modulem je my¹lena libovolná atomická èást modelu, je¾ vìt¹inou reprezentuje nìjakou èást simulovaného modelu. Pøí pou¾ití pøi simulaci biologických procesù se tak mù¾e jednat napøíklad o~buòky nebo rùyné typy rostlinných orgánù.

Jedním z~prvních grafických modelù, pou¾ívajících pøepisovací pravidla, byla Kochova køivka, pøípadnì Kochova vloèka (155 ABOP). ©lo o~jednoduchý bezkontextový pøepisovací systém, je¾ obsahoval pouze jediné pravidlo, pøepisující jeden grafický prvek na jiný. (OBRAZEK). Pozdìji tento model podstatnì roz¹íøil Mandelbrot, je¾ pøidal systémy podporující pøepisování úseèek o~rùzných délkách a hlavnì podporu vìtvených topologií.

Nejvìt¹í pozornost v¹ak byla ubírána ke studiu systémù zalo¾ených na pøepisování øetìzcù znakù. Velkým pøínosem v~tomto odvìtví byly na konci padesátých let 20. století Chomského formální gramatiky, které vyu¾ívaly princip pøepisování pro popis syntaxe pøirozeného jazyka. V~roce 1968 pak biolog Aristid Lindenmayer pøedstavil odli¹ný typ mechanismu pøepisujícího øetìzce. Tento mechanismus byl posléze pojmenován jako L-systémy. Zásadní odli¹ností L-systémù od Chomského gramatik spoèívá v~pou¾ití pøepisovacích pravidel. Zatímco v~Chomského gramatikách jsou pøepisovací pravidla aplikována postupnì, v~L-systémech jsou pou¾ity paralelnì v~jednom derivaèním kroku na v¹echny symboly pøepisovaného øetìzce. Motivací pro tento pøístup byla podobnost s~biologickými procesy. Pøíkladem mohou být mnohobunìèné organismy, ve kterých se dìlí buòky souèasnì. Na rozdíl od pøírodních pochodù vývoj L-systémù probíhá v~diskrétních krocích. Kvùli reprezentaci modelù jako øetìzce znakù se èasto místo pojmu modul pou¾ívá pojem symbol.

% ------------------------   
% Section 
\section{D0L-systémy}
\label{sec0202}\hypertarget{sec0202}{}%

Deterministické bezkontextové L-systémy, zkrácenì D0L-systémy,jsou nejjednodu¹¹í formou L-systémù. Pùvodní Lindenmayerovy systémy zahrnovaly právì pouze tento typ. Takovýto typ L-systém se skládá z~abecedy modulù, pøepisovacích pravidel a axiomu, je¾ slou¾í jako poèáteèní øetìzec modulù. Na obrázku ( str 5 ABOP) je znázornìna simulace vývoje mnohobunìèného vlákna bunìk, je¾ se nachází v~bakterii Anabaena catenula( 99 ABOP ). Tyto øetìzce jsou tvoøeny dvìma typy bunìk. První typ jsou mladé, krat¹í buòky a druhým jsou buòky star¹í, del¹í. Ka¾dá buòka má také svou polaritu polaritu, která urèuje, kterým smìrem bude buòka rùst.

Formální definice D0L-systémù podle (Roz1980 Radekk) je následující: 
\begin{itemize}
%--- Item
\item 
Abeceda {\em{V}} je koneèná mno¾ina {\em{symbolù}}.

%--- Item
\item 
{\em{Slovo}} je posloupnost symbolù nad abecedou {\em{V}}. Mno¾ina v¹ech tìchto posloupností se oznaèuje jako {\em{V*}}.

%--- Item
\item 
{\em{Pøepisovací pravidlo}} je uspoøádaná dvojice \ensuremath{(a,u)} zapsaná jako \ensuremath{a \to u} , kde \ensuremath{a} je symbol nále¾ící {\em{V*}} a \ensuremath{u} je slovo nále¾ící {\em{V*}}. Symbol \ensuremath{a} se nazývá {\em{pøedchùdce}} a slovo \ensuremath{u} {\em{následník}}.

%--- Item
\item 
{\em{D0L-systém}} je trojice \ensuremath{G= \langle V, \omega ,P \rangle} , kde {\em{V}} je abeceda, \ensuremath{\omega \in } {\em{V*}} je poèáteèní slovo, nazývané {\em{axiom}}, a {\em{P}} je mno¾ina pøepisovacích pravidel takových, ¾e pro \ensuremath{\forall a \in V: \exists p_{a} \in P} , kde \ensuremath{p_{a}} oznaèuje pøepisovací pravidlo, jeho¾ pøedchùdce je modul \ensuremath{a} .

\end{itemize}
\noindent  Dle obecných konvencí bývá pøepisovací pravidlo \ensuremath{a \to u} oznaèováno jako odpovídající modulu a pro modul, kterému neodpovídá ¾ádné z~pøepisovacích pravidel, bývá pou¾ito pravidlo identity \ensuremath{a \to a} . Modul je mo¾né bìhem vývoje L-systému odstranit pomocí pou¾ití \ensuremath{\epsilon} pravidla.

% ------------------------   
% Section 
\section{L-systémy se závorkami}
\label{sec0203}\hypertarget{sec0203}{}%

Obecné D0L-systémy poskytují mo¾nosti pouze pro vytvoøení sekvence modulù. Aby v¹ak bylo mo¾né vytvoøit slova reprezentující rostliny, je nutné umo¾nit L-systémùm vytváøet vìtvené topologie. Pro reprezentaci vìtvených topologií je potøeba zavést dva moduly. Tyto moduly byly ji¾ souèástí pùvodního Lindenmayerova konceptu(Lin 1968 Radekk). Pro oznaèení zaèátku a konce vìtve se pou¾ívají symboly pravé a levé hranaté závorky.

Slova, vyprodukovaná derivacemi pøepisovacích pravidel závorkového L-systému, se oznaèují jako stromy. Pøíklad takovéto stromové struktury vytvoøené závorkovým L-systémem je na obrázku (str9 fig 3.2 handbook). Strom je dle (98) slovo w nad abecedou VE = V~U~\{[,]\}, kde V~je abeceda v¹ech modulù z~nich¾ se skládají vìtve. Vìtev je pak libovolné slovo generované L-systémem bez závorek.

% ------------------------   
% Section 
\section{Parametrické L-systémy}
\label{sec0204}\hypertarget{sec0204}{}%

Pøepisování pravidel u~0L-systémù je bezkontextové. Pøi produkci následníkù tedy nezále¾í na modulech v~okolí pøedchùdce. Pøi pøepisování kontextových L-systémù v¹ak musí kromì pøedchùdcù odpovídat také jejich sousední moduly. Tímto zpùsobem mohou mezi sebou jednotlivé moduly komunikovat nebo posílat ostatním modulùm signály. Lze tak simulovat reakci na proudìní látek rostlinou nebo informovat moduly o~globálních vlastnostech celého L-systému, jako je délka stonku, poèet kvìtù, stáøí apod. Moduly v¹ak takto mohou komunikovat i s~okolím L-systému a získávat tak informace napøíklad o~mno¾ství svìtla, mno¾ství ¾ivin, roèním období nebo o~pøeká¾ce v~rùstu. Mozna dat tri typy pouziti -- kapitola 7.3 handbook

Existuje mnoho implementací kontextových L-systémù. Nejpou¾ívanìj¹í jsou 1L-systémy a 2L-systémy. U~1L-systémù je brán zøetel buï pouze na levý nebo pouze na pravý kontext modulu pøedchùdce. Zápis pravidel s~jednostranným kontextem tedy mù¾e být ve tvaru \glqq {\em{lk \textless{} pøedchùdce \ensuremath{\to} následník}}\textquotedblleft{} nebo \glqq {\em{pøedchùdce \textgreater{} pk \ensuremath{\to} následník}}\textquotedblleft{}
 , kde {\em{lk}} je levý a {\em{pk}} pravý kontext. Následující L-systém ukazuje, jakým zpùsobem je mo¾né propagovat signál.
% -------------------------------------------------------------
% Chapter Modelování rostlinných organismù 
% ------------------------------------------------------------- 	
\chapter{Modelování rostlinných organismù}
\label{ch03}\hypertarget{ch03}{}%

% ------------------------   
% Section 
\section{Interpretace ¾elví grafikou}
\label{sec0301}\hypertarget{sec0301}{}%

Proto¾e byly L-systémy navr¾eny jako matematický model bez geometrické interpretace, je potøeba pro modelování rostlin pou¾ít nìkterý z~pøístupù, je¾ pro tento úèel byly buï vyvinuty nebo byly pøevzaty. Sám Lindenmayer publikoval v~roce 1974 øe¹ení je¾ nahrazovalo moduly øetìzcù grafickými obrazci. ©lo v¹ak hlavnì o~topologii vìtvení rostlin a detaily jako délky nebo úhly natoèení segmentù byly do modelu dodávány dodateènì. Bìhem sedmdesátých a osmdesátých let vzniklo je¹tì mnoho jiných interpretací L-systémù, je¾ napøíklad ukázaly, ¾e L-systému jsou velmi platným nástrojem pro tvorbu fraktálù. V~roce 1986 pøi¹el Przemyslaw Prusinkiewicz s~my¹lenkou interpretovat L-systémy jako pohyb ¾elvy známé z~programovacího jazyka LOGO(1 ABOP). Tato ¾elva funguje jako kurzor, který pøijímá rùzné rozkazy týkající se jeho pohybu. Na základì tìchto rozkazù pak tento kurzor kreslí svým pohybem jednu spojitou èáru(???). Pou¾ití ¾elví grafiky znaènì roz¹iøuje geometrické mo¾nosti L-systémù a je ideální pro tvorbu biologických struktur.
\subsection{Planární ¾elví grafika}
\label{sec030101}\hypertarget{sec030101}{}%

Nebo» pùvod ¾elví grafiky spoèívá v~pohybu kurzoru po obrazovce, její pùvodní koncept zahrnoval pohyb ve dvojrozmìrném prostøedí. ®elva je definovaná jako trojice parametrù {\em{(x,y,$\alpha$)}}, kde {\em{x}} a {\em{y}} udávají kartézké souøadnice ¾elvy a úhel {\em{$\alpha$}} smìr, kterým ¾elva míøí, tzv. èelo. Pokud zavedeme navíc hodnotu pro délku kroku a výchozí pøírùstek úhlu o~který se ¾elva bude otáèet, mù¾eme vytvoøit jednoduchá pravidla pro pohyb ¾elvy v~rovinì. Jednotlivé znaky pak reprezentují daný modul a také akci která je pøi naètení tohoto modulu provedena.

\begin{itemize}
%--- Item
\item 
{\bfseries{F}} --- ®elva provede krok vpøed o~pøedem definované délce na pozici {\em{(x',y')}}. Mezi body {\em{(x,y)}} a {\em{(x',y')}} je vykreslena úseèka.

%--- Item
\item 
{\bfseries{+}} --- Pøiká¾e ¾elvì otoèit se o~pøedem definovaný pøírùstek úhlu doleva. Úhel ¾elvy se zvìt¹í o~tuto hodnotu.

%--- Item
\item 
{\bfseries{-}} --- Pøiká¾e ¾elvì otoèit se o~pøedem definovaný pøírùstek úhlu doprava. Úhel ¾elvy se zmen¹í o~tuto hodnotu.

\end{itemize}
\noindent 

Pøi generování grafiky pak ¾elva s~poèáteèními parametry (x0,y0, $\alpha$0) interpretuje jednotlivé znaky øetìzce postupnì zleva doprava.
\subsection{Interpretace závorkových L-systémù}
\label{sec030102}\hypertarget{sec030102}{}%

Jak ji¾ bylo vý¹e zmínìno, pro simulaci vìtvících se struktur rostlin je nutné roz¹íøení L-systémù o~závorky. Ka¾dý podøetìzec uzavøený závorkami zleva i zprava pøedstavuje v~topologii rostliny jednu vìtev. Pøi pou¾ití ¾elví grafiky je tak nutné v~bodech vìtvení rozdìlit souvislou èáru, je¾ ¾elva kreslí, na minimálnì dvì nové cesty. Pro tyto ùèely se u¾ívá zásobníku. Pokud ¾elva narazí pøi procházení slova na znak '[', ulo¾í se spolu se svými parametry na zásobník a její kopie pokraèuje v~interpretaci øetìzce za závorkou. Naopak pokud ¾elva narazí na znak ']', je odstranìna a v~interpretaci pokraèuje ¾elva z~vrcholu zásobníku.
\subsection{Roz¹íøení pro interpretaci L-systémù v~3D}
\label{sec030103}\hypertarget{sec030103}{}%

Jednou z~hlavních výhod ¾elví grafiky je její jednoduchá roz¹iøitelnost pro pou¾ítí ve tøech rozmìrech. Parametry ¾elvy v¹ak musejí být roz¹íøeny. Pro pozici ¾elvy se se definuje vektor P. Pro urèení orientace pak tøi jednotkové vektory H, L, U~takové, ¾e splòují rozvici H x L = U. Vektor H pododbnì jako u~rovinné ¾elvy udává kam ¾elva smìøuje, tedy èelo. Vektor U~smìøuje smìrem nahoru a vektor L pak smìøuje vlevo od ¾elvy.

Sada pøíkazù je v~3D také znaènì roz¹íøena. Pro zmìnu orientace ¾elva interpretuje pøíkazy, je¾ ¾elvu rotují okolo jednotlivých os. Pro tyto rotace jsou bì¾nì pou¾ívány termíny z~letectví: smìr, podélný sklon a pøíèný náklon. Kompletní sada pøíkazù, kterou intepretuje i zásuvný modul, je¾ byl vytvoøen v~rámci této práce, je i spolu s~popisem iterpretovaných funkcí uvedena v~pøíloze ???

% ------------------------   
% Section 
\section{Subapikální L-systémy}
\label{sec0302}\hypertarget{sec0302}{}%

Závorkové L-systémy umo¾nují vytváøet velice ¹irokou ¹kálu øetìzcù. Ne v¹echny v¹ak odpovídají rostlinné stavbì a pro generování rostlin se tak nehodí. Zavádìjí se proto jistá omezení a pravidla, obvykle nazýváné jako vzory vìtvení, je¾ nám zaruèí respektování nìkterých pøírodních vlastností. Výsledkem pak jsou L-systémy, které pravdivìji odpovídají reálným rostlinám. Jednou z~tìchto podmno¾in jsou i subapikální L-systémy. Poprvé byly pøedstaveny Kelemenovou v~roce 1987(7 apical). My¹lenkou tìchto L-systémù je, ¾e k~vìtvení dochází pouze u~vrcholù ji¾ exitujících vìtví. Tato vlastnost výchází ze základních výsledkù pøi pozorování rostoucích rostlin. Nové rostlinné orgány, jako je stonek, vìtve, listy nebo kvìty mohou být vytvoøeny pouze z~apikálního meristému. Tato tkáò obsahuje aktivnì se dìlicí buòky a nachází se v~oblasti vrcholù vìtví.

V~pøírodì rozeznáváme tøi typy vzorù vìtvení je¾ splòují podmínku subapikálních L-systémù. Jednoduché bazitonické a slo¾itìj¹í mezotonické a akrotonické vzory.
\subsection{Bazitonický vzor vìtvení}
\label{sec030201}\hypertarget{sec030201}{}%

Jedná se o~struktury v~nich¾ je vìtvení u~vrcholu rostliny ménì vyvinuté ne¾ vìtve blí¾e základny rostliny. Bazitonické struktury lze vytvoøit i za pomocí jednoduchých D0L-systémù. Klasic
\subsection{Mezotonický a Akrotonický vzor vìtvení}
\label{sec030202}\hypertarget{sec030202}{}%

% -------------------------------------------------------------
% Chapter Zásuvný modul LSystem 
% ------------------------------------------------------------- 	
\chapter{Zásuvný modul LSystem}
\label{ch04}\hypertarget{ch04}{}%

Stì¾ejní èásti této diplomové práce je návrh a implemtace zásuvného modulu pro systém VRECKO. Tento modul umo¾nuje simulaci rostlin, stromù ale i jiných struktur pomocí rùzných typù L-systémù a jejich následnou grafickou interpretaci a zobrazení v~systému Vrecko. Návrh a analýza byla provedena s~velkým dùrazem na modularitu a tedy mo¾nost pozdìj¹ího roz¹íøení o~nové funkcionality.

Logicky lze zásuvný modul Lsystem rozdìlit na tøi èásti. První celek tvoøí syntaktický analyzátor souborù L-systémù a generátor slov. Syntaktický analyzátor zaji¹»uje správné zpracování L-systémù, jejich náhrání ze souboru a naètení v¹ech potøebných parametrù. Následnì pak zpracuje naètená data, která generátor pou¾ije pro provedení jednotlivých derivaèních krokù L-systémù. Slova i ostatní data jsou bìhem derivaèního procesu i poté ulo¾ena do datových struktur optimalizovaných pro daný úèel. Jeliko¾ existuje nìkolik typù L-systémù, je implementována funckionalita, která pro pøepisování vybere algoritmus, který je svými schopnostmi i èasovou nároèností nejvhodnìj¹í pro zpracovávaný L-systém. Tvorba L-systémù se slo¾itìj¹í strukturou se vìt¹inou neobejde bez hiearchického rozdìlení problému. Zásuvný modul proto umo¾òuje rozdìlit model na nìkolik úrovní a do hlavního L-systému vkládat podsystémy. V~praxi to pak napøíklad u~generování stromù znamená, ¾e je mo¾né vytvoøit rozdílný L-systémy pro listy, kvìty a plody a následnì je vlo¾it do L-systému kostry stromu. Podrobnìji se touto èásti funcionality zabývá kapitola ???.

Druhý celek se zabývá grafickou interpretací vygenerovaného øetìzce. Komunikace s~prvnì zmiòovaným celkem je pouze na úrovni pøedání vygenerovaného slova, poskytnutí detailních parametrù pro nastavení interpretu a také mechanismu pro zpracování dotazù. Interpret v~souèasné podobì pou¾ívá pro generování geometrie modelù výhradnì ¾elví grafiku. Tento modul v¹ak obsahuje i interpret, je¾ k~vytváøení geometrie neslou¾í. Jedná se o~intepret pro zpracování dotazù bìhem generování iterací L-systémù. Je tedy optimalizován pro rychlé zji¹tìní polohy a orientace ¾elvy. Pro zpracování slov obsahující závorky má interpret implementován zásobník. U¾ivatel má také mo¾nost zvolit si z~nìkolika typù ¾elv, je¾ pak dovolují vykreslovat geometrii rozdílnými pøístupy. Poslední celek plní funkci øídícího modulu a je umístnìn nad obìmi pøedcházejícími celky, je¾ spravuje. Umo¾òuje také nahrání a ukládání vygenerovaných slov. Odpadá tak opìtovné generování pøi jejich dal¹ím pou¾ití. Zároveò sprostøedkovává komunikaci jak se systémem Vrecko tak mezi moduly navzájem. Jedná se pøedev¹ím o~naètení základních parametrù, které oba moduly potøebují pro svou inicializaci.

% ------------------------   
% Section 
\section{Vývoj zásuvného modulu}
\label{sec0401}\hypertarget{sec0401}{}%

Vývoj probíhal na platformì Windows v~prostøedí Visual Studio 2010 v~jazyce C++. Ve¹keré tøídy nále¾í do jmenného prostoru AP\_LSystem. Stejnì jako celý systém Vrecko je i modul LSystem postaven na OpenSceneGraphu. Zejména se jedná o~èást zaji¹»ující interpretaci L-systémù a generování geometrie. Mimoto byly pro vývoj pou¾ity nìkteré z~knihoven Boost. Jednak jde o~knihovnu Program properties pro jednoduché a intuitivní ukládání a zpracovaní nastavení a konfiguraèních souborù a dále pak o~knihovnu Lexical cast, která jednodu¹e pøevádí a pøetypovává øetìzce znakù. O~zpracování XML souborù se stará knihovna Xerces-C.

% ------------------------   
% Section 
\section{OpenSceneGraph}
\label{sec0402}\hypertarget{sec0402}{}%

Základním kamenem pro modul LSystem i pro systém Vrecko je OpenSceneGraph API. Jedná se o~obejktovì orientované rozhraní nad OpenGL. Nízkoúrovòová funkcionalita je zde pøevedena na objekty v~grafech scén. Zároveò jsou mo¾nosti OpenSceneGraphu oproti klasickému OpenGL znaènì roz¹íøené a je pøidáno mnoho funkcionalit, je¾ zjednodu¹ují a urychlují práci programátora.

% ------------------------   
% Section 
\section{Vrecko}
\label{sec0403}\hypertarget{sec0403}{}%

Jak ji¾ bylo zmínìno, je modul LSystem urèen pro systém Vrecko. Jedná se o~prostøedí pro tvorbu virtuální reality vyvíjené v~rámci HCI laboratoøe na Fakultì informatiky Masarykovy univerzity v~Brnì. Slou¾í primárnì pro vytváøení scén, je¾ nìjakým zpùsobem demonstrují a zkoumají mo¾nosti interakce èlovìka s~poèítaèem. Vychází z~principu OpenSceneGraph a scény jsou tedy obdobnì definovány jako grafy. Scény se v~tomto prostøedí dìlí na objekty je¾ mají urèité vlastnosti a dovednosti. Díky ním lze objekty ovládat a mìnit jejich tvar i vlastnosti. Zároveò lze k~tomuto systému pøipojit øadu rùzných zaøízení pro interakci obsahu scény s~u¾ivatelem.

% -------------------------------------------------------------
% Chapter Generovaní slov pro modely rostlin 
% ------------------------------------------------------------- 	
\chapter{Generovaní slov pro modely rostlin}
\label{ch05}\hypertarget{ch05}{}%

Tato kapitola se zabývá implementací syntaktického analyzátoru a následným generováním slov pomocí L-systémù. Pøi implementaci této èásti byl kladen velký dùraz na rychlost a také na modularitu. Rychlost je zde dùle¾itá zejména pøi iteraèním procesu, nebo» výsledné slovo mù¾e mít délku a¾ v~øádu miliónù modulù. Je tedy tøeba zajistit vhodné struktury pro ukládání dat a vybrat vhodný algoritmus pro rychlý pøepis pravidel. Modularita a roz¹íøitelnost zde s~rychlostí úzce souvisí. Jednotlivé typy L-systémy toti¾ vy¾adují rozdílné pøístupy pøi pøepisování pravidel a tak je dùle¾ité vytvoøit více algoritmù je¾ budou rùzné typy jednodu¹¹ích i komplexnìj¹ích L-systémù zpracovávat Zároveò je v¹ak tøeba zaruèit, aby jednodu¹¹í L-systémy nebyly zpracovány pøíli¹ slo¾itými algoritmy, ale aby byly vybrány jednodu¹¹í a hlavnì optimalizovanìj¹í postupy pro daný problém. Modularita je zde dýle¾itá i pro syntaktický analyzátor je¾ tak zvládne zpracovat více formátù L-systémù.

Celou tuto funkcionalitu a komunikaci s~okolím zaji¹»uje tøída LSystemGenerator. Tato tøída je potomkem tøídy AbstractGenerator je¾ obsahuje rozhraní pro obsluhu této tøídy. Instance tøídy LSystemGenerator obsahuje odkaz na hlavní L-systém tøídy AbstractLSystem, který je poté pou¾it pro generování slova. Hlavním úkolem tøídy LSystemGenerator je vybrat správný syntaktický analyzátor pro nahrání souboru s~L-systémem a na základì získaných parametrù vybrat a vytvoøit instanci tøídy dìdící z~AbstractLSystem, je¾ bude pro následný iteraèní proces nejvhodnìj¹í. Nahráním souborù a jejich strukturou se zabývá následující kapitola.

% ------------------------   
% Section 
\section{Soubory L-systémù}
\label{sec0501}\hypertarget{sec0501}{}%

Vstupním bodem pro ka¾dý L-systém je jeho definice ulo¾ená v~jednom z~podporovaných souborových formátù. Spolu s~definicí mù¾e být souèástí celá øada parametrù, které mohou ovlivnit jak proces pøepisování pravidel tak i zpùsob následné geometrické intepretace. Zásuvný modul nyní podporuje dva typy souborù a lze jej roz¹íøit o~podporu dal¹ích formátù. Jednat se jedná o~mírnì pozmìnìný textový formát LS, je¾ v~obdobné formì pou¾ívá ve svých projektech výzkumná skupina Biologického Modelování a Vizualizace kolem prof. Przemyslawa Prusinkiewicze z~University of Calgary. Tento formát byl zvolen z~dùvodu vedoucí úlohy této skupiny v~oboru L-systémù. Druhým formátem je soubor napsaný ve znaèkovacím jazyce XML, je¾ byl zvolen pro svou jednoduchou roz¹íøitelnost a pøehlednost.

Struktura je v~obou pøípadech hiearchická a a popis jejich entit je následující. 
\begin{itemize}
%--- Item
\item 
{\bfseries{Unikátní identifikátor L-systému}} je nutné pøiøadit ka¾dému L-systému. Ten se pak pou¾ívá hlavnì pøi vkládání subsytémù nebo pro získávání parametrù o~daném L-systému.

%--- Item
\item 
{\bfseries{Typ L-systému}} je dùle¾itým a nutným parametrem L-systému. Urèuje základní vlastnosti jako je determiniènost a bezkontextovost L-systému. Na jeho správném nastavení pak zále¾í pøi výbìru správného algoritmu pro zpracování samotných pravidel a pro následný iteraèní proces.

%--- Item
\item 
{\bfseries{Parametry}} nastavené pøímo v~souboru L-systému jsou specifické pro konkrétní L-systém. Pokud nìkteré z~parametrù nejsou nastaveny zde, pou¾ijí se pro generování i interpretaci slova globální parametry získané z~konfiguraèního souboru. Kompletní popis jednotlivých parametrù se nachází v~APPENDIX

%--- Item
\item 
{\bfseries{Subsystémy}} lze vkládát do ka¾dého L-systému. Lze je vlo¾it pøidáním cesty k~souboru L-systému. Nikdy v¹ak není vhodné tvoøit v~grafu hiarchie L-systémù kru¾nice. Podrobnìji se touto tématikou zabývá kapitola SUBSYSTEMY

%--- Item
\item 
{\bfseries{Axiom}} je poèáteèní øetìzec symbolù. Jde tedy o~slovo v~nulté iteraci L-systému.

%--- Item
\item 
{\bfseries{Pøepisovací pravidla}} jsou mno¾ina, která budou pou¾ita pøi iteraèním procesu. Na poøadí není brán zøetel, proto¾e se pøi ka¾dém iteraèním kroku aplikují v¹echny pravidla najednou. Z~tohoto dùvodu je v¹ak dùle¾ité, aby byla jednotlivá pravidla jednoznaèná a neexistovaly dvì pravidla pro stejný modul pøedchùdce. Jedinou výjímkou jsou stachistické systémy. Struktura pravidel je závislá na jejich typu a podrobnìji je popsána v~odpovídajících podkapitolách kapitoly TYPY.

%--- Item
\item 
{\bfseries{Homomorfismy}} jsou zvlá¹tním typem pøepisovacích pravidel, je¾ se nezpracovávají bìhem iteraèního procesu. K~pøepisu tìchto pravidel dochází v¾dy a¾ po dokonèení v¹ech iterací.

\end{itemize}
\noindent 

Formáty se implementují jako potomci tøídy AbstractFile. Ta poskytuje rozhraní pro získání potøebných dat ze souboru.

\begin{Verbatim}[fontsize=\small]
class AbstractFile
{
protected:
    unsigned m_Type;
    std::string m_Name, m_Axiom;
    std::vector<std::string> m_Rules, m_Homomorphisms, m_Subsytems;
    void substitute(std::map<std::string, std::string> & pairs)
public:
    AbstractFile();
    virtual void open( std::string & ) = 0;
    virtual std::vector<string> * getHomomorphisms()
    virtual std::vector<string> * getRules();
    virtual std::vector<string> * getSubsystems();
    std::string & getAxiom();
    unsigned getType();
    std::string & getName();
};
\end{Verbatim}

Tøídy odvozené od tøídy AbstractFile musí implementovat metodu {\texttt{{open()}}}, je¾ zaruèí zpracování dat ze souboru a ulo¾í je do jednotlivých atributù této tøídy. Metoda {\texttt{{substitute()}}} slou¾í jako výpomocná metoda pøi nahrazování øetìzcù a mù¾e být pou¾ita pro zpracování konstant nebo subsystémù. Ostatní metody slou¾í jen pøístupové metody k~atributùm.
\subsection{Formát LS}
\label{sec050101}\hypertarget{sec050101}{}%

Jedná se o~jednoduchý textový formát zalo¾ený na pøíkazech je¾ jsou podobné preprocesorovým pøíkazùm jazyka C. Nìkteré pøíkazy jsou párové a musí být ukonèeny. Jako hodnota je brán øetìzec následující po pøíkazu. Tento øetìzec nemù¾e obsahovat ¾ádné bílé znaky. Formát LS dovoluje také vkládat komentáøe pou¾itím dvojitého lomítka "//".
\subsection{Formát XML}
\label{sec050102}\hypertarget{sec050102}{}%

V~pøípadì XML souboru jde o~klasický XML dokument verze 1.0 s~kódováním UTF-8. Ve¹keré pou¾ité elementy jsou párové a nejsou pou¾ity ¾ádné atributy. Koøenovou znaèkou je LSystem a ta pak obsahuje v¹echny potøebné entity. V~následujícím odstavci je pøíklad zápisu L-systému do XML souboru.

\begin{Verbatim}[fontsize=\small]
<?xml version="1.0"?>
<!-- koøenová znaèka -->
<LSystem>
  <!-- unikátní identifikátor L-systému -->
  <Name>TernaryTree</Name>
  <!-- typ L-systému -->
  <Types>
    <Type>0L</Type>
  </Types>
  <!-- konstanty -->
  <Constants>
    <LeafPitch>65.0</LeafPitch>
  </Constants>
  <!-- parametry -->
  <Parameters>
    <Iteration>14</Iteration>
    <TurtleType>STRAIGHT_PIPE</TurtleType>
    <DefaultAngle>30.0</DefaultAngle>
  </Parameters>
  <!-- subsystémy -->
  <Subsystems>
    <Subsystem>data\ls\leaf01.ls</Subsystem>
  </Subsystems>
  <!-- axiom -->
  <Axiom>F'(0.65)A</Axiom>
  <!-- pøepisovací pravidla -->
  <Rules>
    <Rule>A:*->!(0.577)'(0.87)[/(90.74)B][/(-132.63)B]B</Rule>
    <Rule>B:*->^(33.95)[^(LeafPitch)#{Leaf01}][#{Leaf01}]Z
                       [^(LeafPitch)#{Leaf01}][#{Leaf01}]ZA</Rule>
  </Rules>
  <!-- homomorfismy -->
  <Homomorphisms>
    <Homomorphism>A:*->Z</Homomorphism>
  </Homomorphisms>
</LSystem>
\end{Verbatim}

Nìkteré symboly pravidel jsou bohu¾el zároveò øídícími symboly XML a tak je zapotøebí nahradit je odpovídajícími XML entitami.

% ------------------------   
% Section 
\section{Soubory L-systémù}
\label{sec0502}\hypertarget{sec0502}{}%

Pøi generování slova L-systémem dochází k~vytváøení velmi dlouhých øetìzcù s~nestejnorodými daty. Moduly, ze kterých se øetìzce tvoøí, toti¾ kromì znaku pro identifikaci modulu obsahují také parametry rùzných datových formátù. Zpracování takovýchto dat musí být navíc dostateènì rychlé. Pro tento úèel byla proto vytvoøena na míru pøizpùsobená tøída LongString. Data jsou zde ulo¾ena ve formátu, který umo¾òuje rychlou manipulaci s~daty, pøedev¹ím pak pøipojení nového øetìzce na konec stávajícího. Rychlost provedení této operace je potøeba pøi iteraèním procesu. Ten pøi ka¾dém kroku zpracovává pùvodní slovo a vytváøí podle nìj na základì pøepisovacích pravidel nové slovo dal¹í iterace. Provádí to tak, ¾e nahlí¾í na jednotlivé moduly pùvodního slova zleva doprava a hledá shodu s~nìkterým z~pøedchùdcù v~pøepisovacích pravidlech. V~pøípadì nalezení pravidla je následník pøidán na konec nového slova. V~pøípadì, ¾e pøedchùdce mezi pravidly nalezen není, pøipojí se na konec kopie pùvodního modulu. Pou¾ije se tedy pravidlo identity. Implementací se zabývá kapitola LINK
\subsection{Vnitøní struktura øetìzce}
\label{sec050201}\hypertarget{sec050201}{}%

Datová struktura LongString je v~jádru tvoøena bajtovým polem. Toto pole se nezvìt¹uje pøi ka¾dém zvìt¹ení øetìzce, ale jen v¾dy po dosa¾ení urèité velikosti. Dochází tak ke znatelné úspoøe èasu pøi alokaci pamìti, která se provádí podstatnì ménì èastìji. Ka¾dý modul je zde ulo¾en jako znak identifikující daný modul a pøípadnì jeho parametry. Parametry mohou být typu int, unsigned char nebo typu double. Implementace dal¹ích typù je mo¾ná a jednoduchá. Pro souèasné pou¾ití v¹ak nebyly jiné typy zapotøebí. Obrázek LINK ukazuje jakým je zpùsobem je struktura navr¾ena.

Jedno políèko odpovídá jednomu bajtu. Ka¾dý modul obsahuje jeden znak, jen¾ jej identifikuje. Dále pak mù¾e obsahovat libovolný poèet parametrù. Ka¾dý parametr je identifikován dvìma bajty zleva a zprava. Pøi pou¾ití této datové struktury tedy není nutné provádìt jakékoli pøevody mezi typy, jejich¾ hodnoty jsou tak rychle dostupné. Pro ilustraci byly na obrázku pou¾ity u~jednoho modulu dva rùzné datové typy. Souèasná implementace umo¾òuje pouze pou¾ití modulù, které mají v¹echny parametry shodného typu.
\subsection{Inicializace}
\label{sec050202}\hypertarget{sec050202}{}%

Pro vytvoøení instance slou¾í jediný konstruktor. Jediným parametrem je velikost øetìzce. Implicitní hodnota tohoto parametru je 1 048 576 bajtù. Právì tato hodnota je také pou¾ita jako minimální pøírùstek alokované pamìti, pokud se stávající pamì» naplní. Plnìní daty lze provádìt buï pøipojováním øetìzcù, je¾ je popsáno v~následující kapitole, nebo konverzí klasického zápisu øetìzce typu std::string do podoby øetìzce LongString. K~tomu slou¾í metoda convertFromString(). Této mo¾nosti lze vyu¾ít pøi naèítání pravidel získaných ze souboru. Pøíklad takovéhoto øetìzce:

Identifikující znaky modulù jsou v~nezmìnìné podobì ulo¾eny i v~øetìzci LongString. Hodnoty parametrù jsou v¹ak konvertovány do odpovídajícího typu. Pro rozli¹ení typù se pou¾ívají rùzné závorky. Zatímco kulaté závorky indikují typ double, slo¾ené závorky indikují typ integer. Konvertované hodnoty jsou v~øetìzci z~obou stran obaleny jednobajtovým identifikátorem. Hodnota tohoto idetifikátoru odpovídá poøadí ve výètu ParameterType.
\subsection{Pøipojování øetìzcù}
\label{sec050203}\hypertarget{sec050203}{}%

Jak ji¾ bylo vý¹e zmínìno, je tato struktura optimalizována pro opakované zvìt¹ování pøidáváním øetìzcù na její konec. Pøi ka¾dém pøipojení se provádí kontrola, zda je alokované místo dostateèné pro pøipojení dal¹ích dat. Pokud ne, volá se automaticky metoda resize(), je¾ alokuje novou pamì» a zvìt¹í tento øetìzec o~délku nastavenou pøi vytváøení instance.

Pro pøipojení dat je k~dispozici nìkolik metod. Jedná se o~rùzné formy metody append(). Ta poskytuje díky ¹ablonì mo¾nost ulo¾it libovolný, ve výètu ParameterType definovaný, datový typ. Kromì toho je tato metoda pøetí¾ena kvùli specifickým zpùsobùm pøipojení nìkterých dat. Lze tak pøipojit jiný øetìzec typu LongString nebo pole bajtù ve správném formátu.
\subsection{Pøipojování øetìzcù}
\label{sec050204}\hypertarget{sec050204}{}%

Pøistupovat lze k~datùm jedním ze ètyø zpùsobù. 
\begin{itemize}
%--- Item
\item 
Pomocí operátoru [] získat pøímo hodnotu bajtu na urèité pozici øetìzce.

%--- Item
\item 
Díky metodì getData() lze získat blok dat nebo celý øetìzec bajtù. Hodí se pøedev¹ím pøi provádìní substitucí.

%--- Item
\item 
Nejpou¾ívanìj¹í mo¾ností je metoda getSymbol(), díky ní¾ lze získat blok dat odpovídající jednomu modulu, neboli symbolu, na dané pozici.

%--- Item
\item 
Pro zpracování parametrických L-systémù se pou¾ívá jedna z~metod ¹ablony getParameters(), která vrací pole parametrù libovolného typu a jejich poèet. Tyto parametry jsou získány z~pozice za identifikujícím znakem.

%--- Item
\item 
Metody matchRight() a matchLeft() slou¾í pøedev¹ím k~ovìøování kontextu. Pro svou funkci vyu¾ívají metody peekSymbol() pro nahlédnutí na levý nebo pravý nejbli¾¹í znak a jeliko¾ øetìzce obsahují i závorky, jsou implementovány i pomocné metody findMatchingRightBracket() a findMatchingLeftBracket() pro nalezení odpovídajícího protìj¹ku k~nalezené závorce. Podrobnìji je celá funkcionalita nalezení kontextu popsána v~kapitole LINK.

\end{itemize}
\noindent 

% ------------------------   
% Section 
\section{Implementace pøepisovacích pravidel}
\label{sec0503}\hypertarget{sec0503}{}%

Potomci tøídy AbstractFile zaji¹»ují, aby byla pravidla správnì naètena ze souboru. L-systému jsou pøedána jako klasický øetìzec znakù. Ten v¹ak není vhodný pro samotný iteraèní proces. Proto se ka¾dé pravidlo zpracovává do struktury Rule. Rùzné typy L-systémù zpracovávají pøedané øetìzce odli¹nì. Podrobnìji se tomuto vìnuje kapitola LINK. V~této èásti jsou uvedeny implementaèní podrobnosti struktury Rule do nich¾ v¹echny L-systémy svá pøepisovací pravidla pøed iteraèním procesem ukládají.

Jednou ze zásadních vìcí bylo zkomponovat do pravidel nìjaký mechanismus pro vyhodnocování výrazù. V~pravidlech se toti¾ mohou výrazy vyskytovat hned na nìkolika místech. 
\begin{itemize}
%--- Item
\item 
Ka¾dý modul na stranì následníka mù¾e místo parametru obsahovat výraz, je¾ se vyhodnocuje a¾ na základì parametrù pøedchùdce

U~parametrických L-systémù se mù¾e vyskytnout podmínka pøepisu, která se musí pøed ka¾dým pøepisem vyhodnotit. Pøi jejím nesplnìní je pravidlo zamítnuto.

Stochastické L-systémy mívají nastaven pravdìpodobnostní faktor, na jejím¾ základì závisí pravdìpodobnost vybrání daného pravidla pro pøepis. Tento faktor se mù¾e rovnì¾ vyhodnocovat z~výrazu.

\end{itemize}
\noindent 

Pro zpracování výrazù byla vybrána knihovna FunctionParser. Jedná se o~volnì dostupnou knhovnu, která poskytuje dostateènou a navíc u¾ivatelsky roz¹íritelnou funkcionalitu. Nabízí i mo¾nosti optimalizace. Pro ka¾dý výraz je tedy vytvoøena instance tøídy FunctionParser. Pro zpracování slou¾í metoda {\texttt{{Parse()}}} s~parametry zpracovávaného výrazu a øetìzce v¹ech promìnných. Vyhodnocení se provádí metodou Eval(), která po pøedání pole s~hodnotami promìnných vrací výsledek výrazu.

Jako pøíklad je zde uvedeno pravidlo stochastického parametrického 2L-systému, kterým se zabývala kapitola LINK.

\begin{Verbatim}[fontsize=\small]
A(x,y) < B(z) > C(a,b,c) : (x + z~> abs(a-c)) -> B(b-1)FA(x/2,y/2) : max(0, 1-1/z*z)
\end{Verbatim}

Z~tohoto zápisu je zøejmé ¾e pro v¹echny výrazy se pou¾ívají pouze promìnné pøedchùdce a kontextù. V~tomto pøípadì se jedná o~x, y, z, a, b, c. Tyto znaky jsou ulo¾eny ve struktuøe Rule jako m\_Variables a slou¾í k~vytváøení instancí tøídy FunctionParser. Dále struktura obsahuje promìnné pro ulo¾ení znakù pøechùdce, obou kontextù a odkazy na instance pro vyhodnocení podmínky pravidla a pravdìpodobnostního faktoru.

Jeliko¾ se následník skládá z~klasických øetìzcù a výrazù, je jeho zpracování slo¾itìj¹í. Jednoduché øetìzce jsou ulo¾eny do instancí tøídy StaticString. Jedná se o~zjednodu¹enou variantu tøídy LongString. Data jsou zde ulo¾ena ve stejné podobì. Rozdílem v¹ak je, ¾e tento øetìzec nelze zvìt¹it. Pro úèel krátkých nemìnných øetìzcù následníka je tedy ideální proto¾e pamì»ovì nezabírá tolik prostoru jako LongString. Øetìzce i výrazy se ukládájí do konejneru typu std::vector. Jsou zde ulo¾eny tak, aby mohly být pøi pøepisu tohoto pravidla støídavì z~kontejneru vybírány. Ukázka zpracovaného pravidla z~pøedchozího pøíkladu je na obrázku LINK

Z~pøíkladu je vidìt, ¾e pokud po sobì následují dva výrazy, mù¾e být øetìzec mezi nimi prázdný. ©edì jsou znázornìny znaky, které jsou zahozeny, nebo» nejsou pro dal¹í zpracování potøebné.Pøi zpracování i následném pøepisu pravidla se v¾dy zaèíná a konèí. Velikost kontejneru s~øetìzci je tedy v¾dy o~jednu vìt¹í ne¾ kontejner s~výrazy. Je to z~toho dùvodu, ¾e èasto existují pravidla, která obsahují v~následníkovi pouze øetìzec a ¾ádný výraz.

% ------------------------   
% Section 
\section{Zpracování L-systémù}
\label{sec0504}\hypertarget{sec0504}{}%

V¹echny tyto typy jsou implementovány jako potomci tøídy AbstractLSystem. Obrázek LINK ukazuje hiearchii tøíd L-systémù.

Abstraktní tøída AbstractLSystem obsahuje nìkolik metod, slou¾ící jako rozhraní pro L-systémy. 
\begin{itemize}
%--- Item
\item 
Pro inicializaci slou¾í metoda loadFromFile(), která naète v¹echna potøebná nastavení. Jako zdroj nastavení slou¾í nìkterá z~instancí potomkù abstraktní tøídy AbstractFile.

Pro provedení dal¹í iterace slou¾í metoda nextIteration(). Poèet iterací lze ovlivnit i nastavení v~konfiguraèním souboru a v~parametrech L-systému. Díky této metodì je v¹ak mo¾né interaktivnì provádìt dal¹í iterace L-systému.

Metoda translate() vrátí vygenerované slovo. Slovo je v¾dy uvnitø tøídy L-systému ulo¾eno ve své nejvy¹¹í iteraci. Na slovì, které vrací tato metoda jsou provedeny navíc finální úpravy. Jedná se o~aplikaci pravidel homomorfismù a vlo¾ení slov, je¾ generují subystémy tohoto L-systému.

\end{itemize}
\noindent  Ve¹kerá funcionalita, je¾ je spoleèná pro v¹echny typy L-systémù je implementována ve spoleèném rodièi LSystem. Ve¹keré funkce se dají rozdìlit do tøí fází.
\subsection{Výbìr nejvhodnìj¹ího L-systému}
\label{sec050401}\hypertarget{sec050401}{}%

Zásuvný modul v~souèasné podobì obsahuje tøi rùzné tøídy zpracovávající rùzné typy L-systémù. Li¹í se rychlostí a svými schopnostmi. Je tedy nutné, aby generátor vybral vhodný algoritmus. Stejnì dùle¾itý je i výbìr u~sybsystémù. Ka¾dý soubor L-systému má nastaven svùj typ. Jedná se o~výèet vlastností, které od tøídy L-systému bude po¾adovat. Samotné tøídy mají pak implementovanou statickou metodu bool isCapable(), na základì ní¾ lze rozpoznat zda daná tøída po¾adavkùm vyhovuje. Pou¾ívá k~tomu statického atributu capabilities, nebo» zde jsou schopnosti ulo¾eny jako jejich bitový souèet. Jednotlivých schopností jsou definovány ve výètu LSystemCapabilities.

Vytvoøení nejvhodnìj¹í instance usnadòuje statická metoda AbstractGenerator::createLSystem(), je¾ na základì typu naèteného souboru automaticky vytvoøí a vrátí vhodnou instanci L-systému. Testování, zda daný typ L-systému vyhovuje, zde probíhá od nejrychlej¹ího typu algoritmu k~nejpomalej¹ímu. První typ, který splòuje v¹echny po¾adavky, je vybrán a pou¾it.
\subsection{Inicializaèní fáze}
\label{sec050402}\hypertarget{sec050402}{}%

Pravidla, která jsou pøedána jako øetìzce, jsou zde v~této fázi konvertována do struktury Rule. Ke konverzi slou¾í trojice metod. Metoda setAxiom() jednodu¹e pøelo¾í øetìzec znakù na vnitøní formát slova a nastaví jej jako poèáteèní slovo typu LongString pro iteraèní proces.

Nezbytnou souèástí jsou metody pro pøidání pøepisovacích pravidel a homomorfismù. Struktura i funkce jsou u~addRule() a addHomomoprhism() dosti podobné. Zpùsob zpracování je v~pøípadì pøedchùdce shodný. Li¹it se mù¾e zpracování následníka. Zpracování pravidel probíhá voláním jednotlivých funkcí struktury Rule, èím¾ se postupnì prochází øetìzec pravidla a instance struktury Rule je automaticky nastavována. Následující pseudokód ukazuje, jakým zpùsobem je zpracováno napøíklad pravidlo parametrického stochastického 0L-systému.

\begin{Verbatim}[fontsize=\small]
pøidejPøepisovacíPravidlo( øetìzec pravidlo )
{
      
}
\end{Verbatim}

\subsection{Pøepisovací fáze}
\label{sec050403}\hypertarget{sec050403}{}%

Jednoznaènì nejdùle¾itìj¹í fází je samotný iteraèní proces. Probíhá v~krocích po jednotlivých iteracích. Zaèíná v¾dy s~poèáteèním slovem, axiomem, v~nìm¾ jsou pøi první iteraci v¹echny moduly nahrazeny dle pøepisovacích pravidel. Tento postup se opakuje pøi ka¾dé iteraci na novì vzniklých slovech. Celý proces pøepisu je zjednodu¹enì zobrazen v~následujícím pseudokódu.

\begin{Verbatim}[fontsize=\small]
LongString puvodniSlovo;
LongString noveSlovo;
for( v¹echny moduly v~puvodniSlovo )
{
    najdi v¹echny pravidla, které mají aktuální modul jako pøedchùdce;
    if( existuje alespoò jedno takové)
    {
        if(vyber pravidlo)
        {
            noveSlovo.pøipoj( vygeneruj následníka modulu);
        }
        else
        {
            noveSlovo.pøipoj(pou¾ij pro daný modul pravidlo identity);
        }
    }
    else
    {
         noveSlovo.pøipoj(pou¾ij pro daný modul pravidlo identity);
    }
}
\end{Verbatim}

Prvotní prohledání pravidel vybere pouze ty, které mají aktuální modul jako svého pøedchùdce. Takových pravidel mù¾e být hned nìkolik. Mohou se li¹it v~kontextu, podmínce nebo mohou být vybrány na základì pravdìpodobnosti. Výbìr jednoho pravidla z~mno¾iny provádí metoda selectRule(), v~pseudokódu oznaèená jako "vyber slovo". Právì toto je funkce v~ní¾ se jednotlivé L-systémy mohou nejvíce li¹it a kde lze implementovat rùzné typy funkcionalit pro výbìr pravidla. Detaily výbìru pravidla u~jednotlivých L-systémù rozebírá kapitola LINK. Pokud ¾ádné z~pravidel nevyhovuje, pou¾ije se pravidlo identity, které pouze zkopíruje modul do novì vznikajícího slova. Vkládání do nového slova probíhá výhradnì pøipojováním na jeho konec.

% ------------------------   
% Section 
\section{Rozdìlení L-systémù}
\label{sec0505}\hypertarget{sec0505}{}%

Jak ji¾ bylo zmínìno v~kapitole XX o~typech vìtvených struktur, je nutné pro modelování pokroèilej¹ích botanických organismù pou¾ít slo¾itìj¹í typy L-systémù. Zároveò v¹ak není kvùli optimalizaci vhodné pou¾ít stejných L-systémù pro generování jednoduchých struktur. Navíc mají rùzné typy L-systémù rùzné formy zápisù svých pøepisovacích pravidel. V~následující kapitole jsou popsány jednotlivá specifika implementace jednotlivých typù L-systémù a také formáty zápisù pravidel, je¾ tyto systémy zpracovávají. Jsou zde rozebrány pouze vlastnosti které nebyly spoleèné a tak byly v~minulé kapitole LINK zmínìny jen okrajovì.
\subsection{D0L-systémy}
\label{sec050501}\hypertarget{sec050501}{}%

Nejjednodu¹¹ím L-systémem je tato varianta implementovaná tøídou D0LSystem. Jak ji¾ název napovídá zpracovává tato tøída pouze deterministické bezkontextové L-systémy. Pro øadu modelù je tento typ generování dostateèný. Navíc je díky své jednoduchosti nejrychlej¹í. Zápis pravidel je ukázán na následujícím vzorovém pøíkladu.

\begin{Verbatim}[fontsize=\small]
A->A+(10)FBF
\end{Verbatim}

Tento typ tedy nepodporuje zpracování výrazù. Ka¾dý následník se tedy skládá pouze z~jednoho øetìzce typu StaticString. Iteraèní proces je v~tomto pøípadì vcelku jednoduchý. V¾dy existuje maximálnì jedno pravidlo, jeho¾ pøedchùdce odpovídá právì zpracovávanému modulu pùvodního øetìzce. Toto pravidlo je také v¾dy vybráno a jeho následník je pou¾it pøi pøepisu.
\subsection{Parametrické stochastické bezkontextové L-systémy}
\label{sec050502}\hypertarget{sec050502}{}%

Tento typ L-systému umo¾òuje zpracovat parametrické i stochastické L-systémy, èím¾ znaènì roz¹iøuje ¹kálu mo¾ností. Díky parametrùm lze vytvoøit i mezotonické a akrotonické struktury. Náhodnost pak dovoluje vytváøet rostlinné organismy s~rozdílnou a náhodnout strukturou, je¾ v¹ak mají spoleèné rodové znaky. Jsou implementovány ve tøídì ParStoch0LSystem. Tato tøída zpracovává L-systémy ve tvaru, jak je popisuje kapitola LINK. Pøíkladem mohou být následující pravidla zapsané ji¾ v~podobì, je¾ je tímto L-systémem zpracovatelná.

\begin{Verbatim}[fontsize=\small]
A(x,y):(x>y)->A(x-1,y)FB(y/2)F:(x*y)
\end{Verbatim}

Jednotlivé èásti tohoto øetìzce mají následující význam. 
\begin{itemize}
%--- Item
\item 
A(x,y) oznaèuje pøedchùdce pravidla se dvìmi parametry x a y. Tento údaj je povinný,

%--- Item
\item 
(x\textgreater{}y) je pøíklad podmínky. Pokud pravidlo podmínku neobsahuje, mù¾e být podmínka nahrazena symbolem *, který znaèí, ¾e je podmínka splnìna v¾dy.

%--- Item
\item 
Následník A(x-1,y)FB(y/2)F bude rozdìlen a zpracován do struktury Rule

%--- Item
\item 
(x*y) je pravdìpodobnostní faktor. Pokud se jedná o~deterministické pravidlo, lze tento výraz vynechat a ukonèit pravidlo posledním znakem následníka. V~takovém pøípadì je v¹ak nutné, aby ¾ádné z~pravidel s~tímto pøedchùdcem neobsahovalo pravdìpodobnostní faktor.

\end{itemize}
\noindent 

Výbìr konkrétního pravidla provádí pøetí¾ená virtuální metoda selectRule(), která na vstupu obdr¾í u¾ jen pravidla se shodujícím se pøedchùdcem. Tyto pravidla je nutné dále protøídit. Pokud se nejedná o~stochastický L-systém vybere se pravidlo, které splòuje svou podmínku. V~pøípadì stochastického L-systému je bì¾né, ¾e podmínku splòuje nìkolik pravidel. Zde je zapotøebí vyhodnotit jejich pravdìpodobnostní faktory a výsledky pak pøedat instanci pomocné tøídy RandomIndex. Ta na základì tìchto faktorù vybere náhodnì jedno z~pravidel, které je pou¾ito pro pøepis.
\subsection{Parametrické stochastické kontextové L-systémy}
\label{sec050503}\hypertarget{sec050503}{}%

Aby byl zásuvný modul schopen zpracovávat dotazy a signály, obsahuje také tøídu pro zpracování kontextových L-systémù. Pou¾ití kontextu také znamená jiný zápis pravidel.

\begin{Verbatim}[fontsize=\small]
A(x,y) < B(z) > C(a,b,c) : (x + z~> abs(a-c)) -> B(b-1)FA(x/2,y/2) : max(0, 1-1/z*z)
\end{Verbatim}

Oproti bezkontextovým gramatikám se zde navíc zadává levý a pravý kontext. Jeho zadání lze vynechat, av¹ak znaménka \textless{} a \textgreater{} je nutné v~øetìzci pravidla zachovat. Zpracování podmínky i pravdìpodobnostního faktoru je zde obdobné jako u~bezkontextových L-systémù.

Nejdùle¾itìj¹ím roz¹íøením je schopnost ovìøovat kontext pøedchùdce. Ovìøování kontextu se øídí pravidly popsanými v~kapitole o~kontextových L-systémech LINK. Pro tuto èinnost byly implementovány metody matchRight() a matchLeft(). Jde o~metody tøídy LongString a vrací hodnotu int, která informuje zda bylo ovìøování úspì¹né. V~pøípadì úspìchu vrací tyto metody pozici úspì¹nì ovìøeného modulu, jinak vrací -1. Metody instance tøídy LongString tedy dostanou informace, jaký kontext a kde jej ovìøovat a poté samy vyhodnotí výsledek. Jak vyplývá z~vý¹e zmínìných pravidel, je potøeba u~L-systémù se závorkami provádìt nìkdy ovìøení na více místech zároveò. Jedná se napøíklad o~situaci symbolu vedle závorky nebo pokud je sousední symbol v~seznamu ignorovaných znakù. Ovìøovací metody tak uvnitø obsahují rekurzivní volání sebe sama, aby v¹echny tyto situace byly korektnì vyhodnoceny. Pokud dochází pøi ovìøování k~vìtvení, je vìt¹inou nutné naleznout v~øetìzci správná místa pro ovìøení kontextu tak, aby byla respektována skuteèná topologie modelu. K~tomuto úèelu slou¾í metody findMatchingRightBracket() a findMatchingLeftBracket(), které k~nalezené závorce najdou její protìj¹ek. Tímto umo¾ní ovìøovacímu mechanismu pokraèovat za závorkou. Pseudokód fungování metody matchRight() zjednodu¹enì ukazuje princip fungování této metody. U~metody matchLeft() je princip obdobný.

\begin{Verbatim}[fontsize=\small]
int matchRight( kontext,   /*symbol pravého kontextu*/
                        pozice     /*odkud hledat*/,
                        ignorovat /*seznam ignorovaných znakù*/ )
{
    if ( slovo[pozice] == '[' )
         return matchRight( kontext, pozice + 1, ignorovat )  ||
                   matchRight( kontext, findMatchingRightBracket(), ignorovat);
    else if (( slovo[pozice] == '[' ) || ( ignorovat obsahuje slovo[pozice] )
        return matchRight( kontext, pozice +1, ignorovat );
    else if ( slovo[pozice] == kontext )
        return pozice;
    else
        return -1;
}
\end{Verbatim}

Levý i pravý kontext mù¾e stejnì jako pøedchùdce mít své parametry, které je nutné naèíst pro zpracování výrazù. Tyto parametry se naètou z~øetìzce slova díky pozicím modulù získaných bìhem ovìøování kontextu. Díky roz¹íøení o~zpracování kontextu mohl být do zásuvném modulu implementován také mechanismus pro zpracování dotazù. Podrobnìj¹ím popisem implementace dotazù se zabývá kapitola LINK.

% ------------------------   
% Section 
\section{Dotazy}
\label{sec0506}\hypertarget{sec0506}{}%

Díky nim lze ji¾ bìhem generování zjistit, kde a v~jaké poloze se bude daný modul nacházet v~prostoru. Díky roz¹íøitelnosti knihovny FunctionParser mohly být pøidány do výrazù funkce, je¾ kterýkoli parametr polohy ¾elvy vrátí. Toto pøipojení u¾ivatelsky definovaných funkcí je provádìno pouze do výrazù které tyto funkce obsahují. Je to z~dùvodu, ¾e výrazy, které tyto funkce obsahují, nemohou být optimalizovány vnitøními algoritmy knihovny FunctionParser. Tyto funkce jsou ve skuteènosti statickými metodami tøídy Query. Ka¾dá tato metoda je bezparametrická a vrací hodnotu double. Pro ka¾dou souøadnici ka¾dého vektoru tedy existuje jedna metoda.

Tøída Query v¹ak slou¾í pouze jako adaptér mezi tøídami FunctionParser a QueryInterpret, co¾ je speciálnì uzpùsobený interpret pro zpracování dotazù. Jeho fungování je podobné jako u~tøídy pro intepretaci geometrie, je¾ bude popsána v~kapitole LINK. Narozdíl od ní v¹ak nevytváøí ¾ádnou geometrii a intepretuje jen symboly, které jsou dùle¾ité pro polohu ¾elvy. Je implementován dle návrhového vzoru jedináèek.

Na základì volání nìkteré z~metod tøídy Query pak dostane pokyn k~interpretaci slova. Interpretována je v¾dy jen ta èást slova, která pøedcházela právì zpracovávanému modulu s~dotazy. Nakonci interpretace je poloha ¾elvy ulo¾ena a pøipravena pro dotazovaní metody. Celá tato operace získání polohy je zaji¹»ována vnitøní metodou update(). Problémem je, ¾e hodnoty polohy ¾elvy velice rychle stárnou a jejich obnovení je kvùli nutnosti interpretace øetìzce èasovì nároèná procedura. Pro omezení volání metody update je implementován jednoduchý algoritmus. Je zalo¾en na principu, ¾e pokud je nìkterá souøadnice pøeètena podruhé, jedná se o~jiný modul a je tedy tøeba provést obnovu. Na obrázku lze vidìt, jakým zpùsobem vypadá pravidlo s~dotazy a jak se jednotlivé dotazy pomocí instance tøídy QueryInterpret vyhodnocují. U~dotazù, které si vynutí provedení interpretace slova je spolu s~dùvodem uvedena metoda update(). Ostatní dotazy obdr¾í odpovìï okam¾itì.

Instance tøídy QueryInterpret tedy pøi prvním volání dotazu positionX() zjistí v¹echny souøadníce polohy ¾elvy. Poté je mo¾né vracet jednotlivé souøadnice polohy. Jakmile se jeden z~dotazù zopakuje, provede se obnova polohy ¾elvy a tedy i nová interpretace ¾elvy. Stejným zpùsobem reaguje interpret na dotazy týkající se aktuálních smìrových vektorù ¾elvy.

Zpracováním dotazù lze tedy do øetìzce slova dostat pozièní hodnoty je¹tì pøed fází vykreslování. Kombinací s~kontextovými pravidly s~pomínkou lze dosáhnout toho, ¾e nìkterá pravidla budou pou¾ita jen pøi urcèitých hodnotách tìchto dotazù. Druhou mo¾ností je vyu¾ít tyto hodnoty ke zmìnì parametrù modulù pravidla. Napøíklad v~pøípadì popinavých rostlin lze na základì polohy a smìru rostoucí vìtve vyhodnotit, kterým smìrem by se mìla daná vìtev vyvíjet a podle toho pak ovlivnit její smìr.

% ------------------------   
% Section 
\section{Podøízené L-systémy}
\label{sec0507}\hypertarget{sec0507}{}%

Problematiku návrhu modelu pomocí L-systémù lze rozdìlit na nìkolik úrovní. Pro lep¹í kontrolu, pøehlednost a také nastavitelnost je lep¹í jednotlivé dílèí celky hiearchicky seøadit. U~botanických organismù se mù¾e jednat napøíklad o~rozdìlení na rostlinné orgány. Jde v¹ak jí samozøejmì i hloubìji. Výhodou tohoto pøístupu je modularita. Ka¾dý takovýto dílèí L-systém má svá vlastní nastavení a mù¾e být pou¾it v~libovolném poètu jiných L-systémù. Pokud tedy vytvoøím L-systém pro list, je velice jednoduché pøidat jej jako podsystém ke v¹em L-systémùm stromù stejného druhu.

Ka¾dý L-systém si své podsystémy spravuje sám. Po jejich naètení pomocí metod tøídy AbstractFile je ka¾dý L-systém inicializován a zpracován podobnì jako ve tøídì LSystemGenerator. Ka¾dému podsystému je pøiøazeno unikátní èíslo. Pod ním je tento systém reprezentován v~øetìzci pomocí modulu \#( L-System\_ID ). V¹echna slova jsou vygenerována a ponechána ulo¾ena v~nadøazeném L-systému. Do øetìzce jsou vlo¾ena a¾ po ukonèení iteraèního procesu, kdy jsou v¹echny moduly \#( ) nahrazeny vygenerovanými slovy. Na zaèátku a konci ka¾dého slova podsystému jsou speciální moduly \$, je¾ poté informují intepret o~zmìnì L-systému, který pak dle parametrù tohoto modulu pøepne na zpracování øetìzce dle odpovídajících nových parametrù. Nebo» je toto chování dosti podobné zpracování závorkám, vìnuje se jim spoleèná kapitola o~implementaci zásobníku LINK.

% -------------------------------------------------------------
% Chapter Generovaní slov pro modely rostlin 
% ------------------------------------------------------------- 	
\chapter{Generovaní slov pro modely rostlin}
\label{ch06}\hypertarget{ch06}{}%

Pøedchozí kapitola se vìnovala výhradnì iteraènímu procesu L-systémù za úèelem vytvoøení slova, je¾ bude reprezentovat po¾adovaný model. V~této kapitole budou podrobnìji rozvedeny techniky, které takto vygenerované slovo intepretují a vytváøí tak jeho geometrickou podobu. Pro intepretaci byla zvolena vý¹e zmínìná technika ¾elví grafiky. Jednotlivé moduly pak slou¾í jako pøíkazy ¾elvì k~rùzným úkonùm. Díky abstrakci na úrovni modulù lze vybírat z~rùzných technik, kterými ¾elva kreslí, a tak vytváøet rozmanitìj¹í modely.

Kromì samotné geomterie je nutné øe¹it i jiné otázky týkající se zobrazení modelu. Jedná se zejména o~mapování textur a o~úroveò detailù. Na této vrstvì je také mo¾né pøidat i rùzné vlivy okolí. Jeliko¾ se jedná ji¾ pouze o~intepretaci, tyto vlivy nijak nemohou ovlivnit strukturu výsledného modelu. Mohou v¹ak globálnì ovlivnit celý model. Lze tak jednodu¹e pøidat modelu závislost na nìkterých silách, jako je gravitace. Jinou mo¾ností je pøiblí¾ení rostlin svým reálným pøedlohám pomocí malé náhodnosti úhlù. Modely tak ztratí svou viditelnou matematickou pøesnost.

Pro interpretaci slov slou¾í abstraktní tøída AbstractInterpret. Implementováni jsou dva potomci. GeometryInterpret zpracovává vì¹keré pøíkazy ¾elvy a slou¾í k~vytváøení geometrie. QueryIntepret provádí zpracování dotazù ohlednì polohy ¾elvy. Tento interpret zpracovává jen vybrané pøíkazy. Podrobnìji byl popsán v~kapitole LINK.

Øetìzec generovaný L-systémem je pøetypován na nový typ. Z~intstance tøídy LongString je konvertován na instanci tøídy ParseableString. Jedná se o~jednoduchou tøídu, která obsahuje metody pro dopøedné procházení øetìzcem a získávání parametrù.

% ------------------------   
% Section 
\section{Spojení s~grafem scény}
\label{sec0601}\hypertarget{sec0601}{}%

Pro zobrazení generované geometrie je dùle¾ité napojení na graf scény. Pøi vytváøení interpretu je mu kontruktorem pøedán ukazatel na rodièe v~grafu. Vzhledem k~tomu, ¾e slovo mù¾e díky mechanismu podsystémù obsahovat øetìzce nìkolika L-systémù mající rùzné parametry, je nutné i pøi vytváøení geometrie tyto L-systémy oddìlit. Díky grafu scény je k~dispozici ideální øe¹ení. Pro ka¾dý L-systém vytvoøí interpret jeden uzel s~geometrií, je¾ bude obsahovat i svá nastavení. Tyto uzly jsou instancemi tøídy LSGeode. Tato tøída je roz¹íøením tøídy osg::Geode. Navíc obsahuje metody pro volbu správného typu ¾elvy pro generování geometrie a také metody pro pøedání výchozích hodnot nastavení ¾elvy. V¹echny tyto hodnoty jsou získány z~parametrù, je¾ se naèítají pøi zpracování souborù L-systémù potomky tøídy AbstractFile LINK.

Pøi inicializaci instance LSGeode dochází také k~nastavení uzlu. Nastaví se textura, materiály a dal¹í vlastnosti. Ve¹keré parametry jsou zpracovány a konvertovány do takové podoby, aby pøi generování byly buï ji¾ nastaveny nebo rychle pøipraveny ke zpracování.

% ------------------------   
% Section 
\section{Interpretace pomocí ¾elví grafiky}
\label{sec0602}\hypertarget{sec0602}{}%

\subsection{Zásobník pro ukládání ¾elvích instancí}
\label{sec060201}\hypertarget{sec060201}{}%

Pro zpracování slov, které obsahují závorky a podsystémy, je nutná dobrá implementace zásobníku pro ¾elvy. K~tomuto úèelu slou¾í tøída TurtleStack, která poskytuje standardní funkce zásobníku. Je v¹ak uzpùsobena pro pou¾ití v~tomto zásuvném modulu. Pøi procházení øetìzce a interpretaci jednotlivých modulù se operace prov K~operacím na zásobníku dochází v~pøípadì nìkterých speciálních symbolù.

\begin{itemize}
%--- Item
\item 
[ - Tato závorka oznaèuje poèátek nové vìtve. Je tedy nutné vytvoøit na zásobníku metodou push() novou ¾elvu, která se vykreslováním této vìtve bude zabývat. Parametry i typ si tato ¾elva nastaví podle ¾elvy na vrcholu zásobníku.

%--- Item
\item 
] - Ukonèení vìtve je signalizováno tímto symbolem. ®elva je z~vrcholu zásobníku odstranìna a v~generování dále pokraèuje ¾elva pod ní.

%--- Item
\item 
\$(x) - Jednotlivé L-systémy mají ji¾ od svého naètení pøiøazen jednoznaèný identifikátor. Symbol dolaru s~jedním parametrem oznamuje intepreteru, ¾e má dojiít ke zmìnì L-systému. Podle identifikátoru v~parametru modulu se zvolí správný L-systém a jeho odpovídající uzel s~geometrií LSGeode. Ten u¾ poté ví, který typ ¾elvy pou¾ít a jaké ji nastavit výchozí parametry. Nìkteré parametry, jako je matice polohy, mohou být nastaveny podle ¾elvy na vrcholu zásobníku. S~novou ¾elvou se pak na zásobníku provede operace push().

%--- Item
\item 
\$ - Ukonèení slova podsystému signalizuje symbol dolaru bez parametru. Z~vrcholu zásobníku je odstranìna ¾elva a ve vykreslování tak pokraèuje ¾elva nadøazeného L-systému.

\end{itemize}
\noindent 
\subsection{®elví rozhraní}
\label{sec060202}\hypertarget{sec060202}{}%

Pro vìt¹í modularitu byl zvolen pøi návrhu model, je¾ umo¾òuje pou¾ití libovolného mno¾ství typù ¾elv. Lze tedy generovat rùznou geometrii pomocí stejných mechanismù. V¹echny tøídy ¾elv dìdí z~abstraktní tøídy AbstractTurtle. Tato tøída obsahuje rozhraní pro úplnou kontrolu ¾elvy. Vìt¹inu tvoøí metody pro zpracování v¹ech pøíkázù, které se ve slovech vyskytují jako moduly. Kromì toho obsahuje metody pro propojení s~uzlem geometrie. Do nìj pak pøímo ukládá ve¹kerou geometrii. K~propojení dochází pøi vkládání ¾elvy na vrchol zásobníku. Je zde k~dispozici i nìkolik metod pro vykreslování pomocné geometrie pøi ladìní.

Ka¾dá ¾elva má celou øadu parametrù, je¾ se mohou bìhem vykreslování neustále mìnit. Proto obsahuje strukturu TurtleProperties, která v¹echny tyto hodnoty uchovává. Tyto parametry si ¾elvy mezi sebou pøedávájí pøi operacích na zásobníku. Jinou mo¾ností nahrání výchozích parametrù z~instance tøídy LSGeode.
\subsection{®elví pøíkazy}
\label{sec060203}\hypertarget{sec060203}{}%

Ka¾dá ¾elva intepretuje celou øadu pøíkazù. Ne v¹echny ¾elvy musí nutnì implementovat v¹echny pøíkazy. Nìkteré mohou být velice úzce specializované a mít implementováno jen nìkolik pøíkazù. Obecnì v¹ak lze pøíkazy rozdìlit do nìkolika kategorií.

\begin{itemize}
%--- Item
\item 
Základní pohybové pøíkazy - Vìt¹ina ¾elv má implementovány základní pøíkazy pro pohyb. Metody pro pohyb jsou spoleèné a nachází se v~abstraktní tøídì MovingTurtle. Umo¾òují napøíklad pohyb ¾elvy dopøedu a natáèení kolem v¹ech os. ®elva se mù¾e pohybovat i bez generování geometrie pouze za úèelem pøemístìní se.

%--- Item
\item 
Pokroèilé pohybové pøíkazy - Jedná se o~nestandardní pohyby ¾elvy, jako je otoèení do protismìru, vyrovnání náklonu do vodorovné polohy nebo náhodné otoèení v~libovolném smìru.

%--- Item
\item 
Zmìna stavových promìnných - Øadu parametrù ¾elvy lze bìhem intepretace mìnit. Je tak mo¾né napøíklad prodlou¾it délku kroku nebo mìnit výchozí úhel rotace.

%--- Item
\item 
Nastavení vnìj¹ích vlivù - Nìkteré pøíkazy mohou ovlivnit reakci dané ¾elvy na globální vnìj¹í vlivy. V~pøípadì gravitace se mù¾e napøíklad jednat o~zmìnu pru¾nosti vìtve.

\end{itemize}
\noindent 
% ------------------------------------------- 
%
%  Bibliography - chapter
%
% ------------------------------------------- 
\begin{thebibliography}{123}\hypertarget{id401159}{}

% ............. biblioentry 
\bibitem{CAD}\docbooktolatexbibaux{id401347}{CAD}
\hypertarget{id401347}
Fischer, M. a Vanìk, P.: \emph{CAD I-V}, e-Architekt.cz, 2004, Seriál dokumentù dostupný na 
      {\textless}\url{http://www.e-architekt.cz/}{\textgreater} (leden 2008). 

% ............. biblioentry 
\bibitem{CAD history}\docbooktolatexbibaux{id401304}{CAD history}
\hypertarget{id401304}
Bozdoc, M.: \emph{iMB The History of CAD}, MB Solutions, 2004, Dokument dostupný na 
         {\textless}\url{http://mbinfo.mbdesign.net/CAD-History.htm}{\textgreater} (leden 2008)
      . 

% ............. biblioentry 
\bibitem{OpenGL}\docbooktolatexbibaux{id401161}{OpenGL}
\hypertarget{id401161}
Shreiner, D. a Woo, M. a Neider, J. a Davis, T.: \emph{OpenGL Prùvodce programátora}, Computer Press, a.s., 2006, 80-251-1275-6. 

% ............. biblioentry 
\bibitem{adv oGL}\docbooktolatexbibaux{id401444}{adv oGL}
\hypertarget{id401444}
McReynolds, T. a Blythe, D.: \emph{Advanced Graphics Programming Techniques Using OpenGL}, Elsevier Inc., 2005, 1-55860-659-9, Dokument dostupný na adrese
         {\textless}\url{http://web.informatik.uni-bonn.de/II/ag-klein/global/proseminar_ss2001/course12.pdf}{\textgreater} (leden 2008)
      . 

% ............. biblioentry 
\bibitem{mpg}\docbooktolatexbibaux{id401234}{mpg}
\hypertarget{id401234}
®ára, J. a Bene¹, B. a Sochor, J. a Felkel, P.: \emph{Moderní poèítaèová grafika}, Computer Press, a.s., 2004. 

% ............. biblioentry 
\bibitem{nehe}\docbooktolatexbibaux{id401552}{nehe}
\hypertarget{id401552}
Turek, M.: \emph{CZ NeHe OpenGL}, Michal Turek, 2004, Dokument dostupný na 
         {\textless}\url{http://nehe.ceske-hry.cz/download/download/cz_nehe_opengl.pdf}{\textgreater} (leden 2008)
      . 

% ............. biblioentry 
\bibitem{oGL bible}\docbooktolatexbibaux{id401502}{oGL bible}
\hypertarget{id401502}
Wright, R. a Lipchak, B.: \emph{OpenGL Super Bible}, Macmillan Computer Publishing, 1996, 1-57169-073-5. 

% ............. biblioentry 
\bibitem{scanline}\docbooktolatexbibaux{id401401}{scanline}
\hypertarget{id401401}
Snapp, R.: \emph{Scanline Fill Algorithm}, Department of Computer Science, University of Vermont, 2003, Dokument dostupný na 
         {\textless}\url{http://www.cs.uvm.edu/~snapp/teaching/CS274/lectures/scanlinefill.pdf}{\textgreater} (leden 2008)
      . 

\end{thebibliography}
\addcontentsline{toc}{chapter}{Literatura}

\newcommand{\dbappendix}[1]{\chapter{#1}}%
% ------------------------------------------------------------- 
% Appendices start here
% -------------------------------------------------------------
\appendix

% -------------------------------------------------------------
% appendix:  Pøíloha 
% ------------------------------------------------------------- 	
\dbappendix{Pøíloha}
\label{appA}\hypertarget{appA}{}%

\end{document}

