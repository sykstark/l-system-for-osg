% ------------------------------------------------------------
% Autogenerated LaTeX file for books
% db2latex RELEASE: 0.8pre1
% db2latex VERSION: $Id: VERSION.xml,v 1.6 2004/01/31 12:47:11 j-devenish Exp $
% fithesis VERSION: 1.40
% ------------------------------------------------------------
\def\clsclass{rapport3}
\documentclass{fithesis}
% --------------------------------------------
% MetaFont and MetaPost logo support
% --------------------------------------------
\usepackage{mflogo}
% --------------------------------------------
% Load fithesis param 
% --------------------------------------------
\thesistitle{Generování rostlin pomocí L-systémù}
\thesissubtitle{Diplomová práce}
\thesisstudent{Marek Pasiènyk}
\thesiswoman{false}
\thesislang{cs}
\thesisyear{jaro 2010}
\thesisfaculty{fi}
\thesisadvisor{RNDr. Vít Kovalèík, Ph.D.}
% --------------------------------------------
\label{id305555}\usepackage{ifthen}
% --------------------------------------------
% Check for PDFLaTeX/LaTeX 
% --------------------------------------------
\newif\ifpdf
\ifx\pdfoutput\undefined
\pdffalse % we are not running PDF\LaTeX 
\else
\pdfoutput=1 % we are running PDF\LaTeX 
\pdftrue
\fi
% --------------------------------------------
% Load graphicx package with pdf if needed 
% --------------------------------------------
\ifpdf
\usepackage[pdftex]{graphicx}
\pdfcompresslevel=9
\else
\usepackage{graphicx}
\fi
\usepackage{anysize}
\marginsize{3cm}{2.5cm}{3.5cm}{3.5cm}

\makeatletter
% redefine the listoffigures and listoftables so that the name of the chapter
% is printed whenever there are figures or tables from that chapter. encourage
% pagebreak prior to the name of the chapter (discourage orphans).
\let\save@@chapter\@chapter
\let\save@@l@figure\l@figure
\let\the@l@figure@leader\relax
\def\@chapter[#1]#2{\save@@chapter[{#1}]{#2}%
\addtocontents{lof}{\protect\def\the@l@figure@leader{\protect\pagebreak[0]\protect\contentsline{chapter}{\protect\numberline{\thechapter}#1}{}{\thepage}}}%
\addtocontents{lot}{\protect\def\the@l@figure@leader{\protect\pagebreak[0]\protect\contentsline{chapter}{\protect\numberline{\thechapter}#1}{}{\thepage}}}%
}
\renewcommand*\l@figure{\the@l@figure@leader\let\the@l@figure@leader\relax\save@@l@figure}
\let\l@table\l@figure
\makeatother
\usepackage{fancyhdr}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}
% Safeguard against long headers.
\IfFileExists{truncate.sty}{
\usepackage{truncate}
% Use an ellipsis when text would be larger than x% of the text width.
% Preserve left/right text alignment using \hfill (works for English).
\fancyhead[ol]{\truncate{0.49\textwidth}{\sl\leftmark}}
\fancyhead[er]{\truncate{0.49\textwidth}{\hfill\sl\rightmark}}
\fancyhead[el]{\truncate{0.49\textwidth}{\sl\leftmark}}
\fancyhead[or]{\truncate{0.49\textwidth}{\hfill\sl\rightmark}}
}{\typeout{WARNING: truncate.sty wasn't available and functionality was skipped.}}
\pagestyle{fancy}
% ---------------------- 
% Most Common Packages   
% ---------------------- 
\usepackage{latexsym}         
\usepackage{enumerate}         
\usepackage{fancybox}      
\usepackage{float}       
\usepackage{ragged2e}       
\usepackage{fancyvrb}         
\makeatletter\@namedef{FV@fontfamily@default}{\def\FV@FontScanPrep{}\def\FV@FontFamily{}}\makeatother
\fvset{obeytabs=true,tabsize=3}
\makeatletter
\let\dblatex@center\center\let\dblatex@endcenter\endcenter
\def\dblatex@nolistI{\leftmargin\leftmargini\topsep\z@ \parsep\parskip \itemsep\z@}
\def\center{\let\@listi\dblatex@nolistI\@listi\dblatex@center\let\@listi\@listI\@listi}
\def\endcenter{\dblatex@endcenter}
\makeatother
\usepackage{rotating}         
\usepackage{subfigure}         
\usepackage{tabularx}         
\usepackage{url}         
% --------------------------------------------
% Load hyperref package with pdf if needed 
% --------------------------------------------
\ifpdf
\usepackage[pdftex,bookmarksnumbered,colorlinks,backref,bookmarks,breaklinks,linktocpage,plainpages=false, pdfstartview=FitH, plainpages=false, pdfpagelabels, unicode]{hyperref}
\else
\usepackage[bookmarksnumbered,colorlinks,backref,bookmarks,breaklinks,linktocpage,plainpages=false, plainpages=false, pdfpagelabels]{hyperref}
\fi
% --------------------------------------------
% ----------------------------------------------
% Define a new LaTeX environment (adminipage)
% ----------------------------------------------
\newenvironment{admminipage}%
{ % this code corresponds to the \begin{adminipage} command
 \begin{Sbox}%
 \begin{minipage}%
} %done
{ % this code corresponds to the \end{adminipage} command
 \end{minipage}
 \end{Sbox}
 \fbox{\TheSbox}
} %done
% ----------------------------------------------
% Define a new LaTeX length (admlength)
% ----------------------------------------------
\newlength{\admlength}
% ----------------------------------------------
% Define a new LaTeX environment (admonition)
% With 2 parameters:
% #1 The file (e.g. note.pdf)
% #2 The caption
% ----------------------------------------------
\newenvironment{admonition}[2] 
{ % this code corresponds to the \begin{admonition} command
 \hspace{0mm}\newline\hspace*\fill\newline
 \noindent
 \setlength{\fboxsep}{5pt}
 \setlength{\admlength}{\linewidth}
 \addtolength{\admlength}{-10\fboxsep}
 \addtolength{\admlength}{-10\fboxrule}
 \admminipage{\admlength}
 {\bfseries \sc\large{#2}} \newline
 \\[1mm]
 \sffamily
 \includegraphics[width=1cm]{#1}
 \addtolength{\admlength}{-1cm}
 \addtolength{\admlength}{-20pt}
 \begin{minipage}[lt]{\admlength}
 \parskip=0.5\baselineskip \advance\parskip by 0pt plus 2pt
} %done
{ % this code corresponds to the \end{admonition} command
 \vspace{5mm} 
 \end{minipage}
 \endadmminipage
 \vspace{.5em}
 \par
}
% --------------------------------------------
% Commands to manage/style/create floats      
% figures, tables, algorithms, examples, eqn  
% --------------------------------------------
 \floatstyle{plain}
 \restylefloat{figure}
 \floatstyle{plain}
 \restylefloat{table}
 \floatstyle{plain}
 \newfloat{program}{ht}{lop}[section]
 \floatstyle{plain}
 \newfloat{example}{ht}{loe}[section]
 \floatname{example}{Pøíklad}
 \floatstyle{plain}
 \newfloat{dbequation}{ht}{loe}[section]
 \floatname{dbequation}{Rovnice}
 \floatstyle{boxed}
 \newfloat{algorithm}{ht}{loa}[section]
 \floatname{algorithm}{Algorithm}
\ifpdf
\DeclareGraphicsExtensions{.pdf,.png,.jpg}
\else
\DeclareGraphicsExtensions{.eps}
\fi
% --------------------------------------------
% $latex.caption.swapskip enabled for $formal.title.placement support
\newlength{\docbooktolatextempskip}
\newcommand{\captionswapskip}{\setlength{\docbooktolatextempskip}{\abovecaptionskip}\setlength{\abovecaptionskip}{\belowcaptionskip}\setlength{\belowcaptionskip}{\docbooktolatextempskip}}
\usepackage[czech]{babel} 
% Guard against a problem with old package versions.
\makeatletter
\AtBeginDocument{
\DeclareRobustCommand\ref{\@refstar}
\DeclareRobustCommand\pageref{\@pagerefstar}
}
\makeatother
% --------------------------------------------
\makeatletter
\newcommand{\dbz}{\penalty \z@}
\newcommand{\docbooktolatexpipe}{\ensuremath{|}\dbz}
\newskip\docbooktolatexoldparskip
\newcommand{\docbooktolatexnoparskip}{\docbooktolatexoldparskip=\parskip\parskip=0pt plus 1pt}
\newcommand{\docbooktolatexrestoreparskip}{\parskip=\docbooktolatexoldparskip}
\def\cleardoublepage{\clearpage\if@twoside \ifodd\c@page\else\hbox{}\thispagestyle{empty}\newpage\if@twocolumn\hbox{}\newpage\fi\fi\fi}
\usepackage[latin2]{inputenc}
\usepackage[T1]{fontenc}

\ifx\dblatex@chaptersmark\@undefined\def\dblatex@chaptersmark#1{\markboth{\MakeUppercase{#1}}{}}\fi
\let\save@makeschapterhead\@makeschapterhead
\def\dblatex@makeschapterhead#1{\vspace*{-80pt}\save@makeschapterhead{#1}}
\def\@makeschapterhead#1{\dblatex@makeschapterhead{#1}\dblatex@chaptersmark{#1}}

\AtBeginDocument{\ifx\refname\@undefined\let\docbooktolatexbibname\bibname\def\docbooktolatexbibnamex{\bibname}\else\let\docbooktolatexbibname\refname\def\docbooktolatexbibnamex{\refname}\fi}
% Facilitate use of \cite with \label
\newcommand{\docbooktolatexbibaux}[2]{%
  \protected@write\@auxout{}{\string\global\string\@namedef{docbooktolatexcite@#1}{#2}}
}
% Provide support for bibliography `subsection' environments with titles
\newenvironment{docbooktolatexbibliography}[3]{
   \begingroup
   \let\save@@chapter\chapter
   \let\save@@section\section
   \let\save@@@mkboth\@mkboth
   \let\save@@bibname\bibname
   \let\save@@refname\refname
   \let\@mkboth\@gobbletwo
   \def\@tempa{#3}
   \def\@tempb{}
   \ifx\@tempa\@tempb
      \let\chapter\@gobbletwo
      \let\section\@gobbletwo
      \let\bibname\relax
   \else
      \let\chapter#2
      \let\section#2
      \let\bibname\@tempa
   \fi
   \let\refname\bibname
   \begin{thebibliography}{#1}
}{
   \end{thebibliography}
   \let\chapter\save@@chapter
   \let\section\save@@section
   \let\@mkboth\save@@@mkboth
   \let\bibname\save@@bibname
   \let\refname\save@@refname
   \endgroup
}

%\usepackage{cite}
%\renewcommand\citeleft{(}  % parentheses around list
%\renewcommand\citeright{)} % parentheses around list
\newcommand{\docbooktolatexcite}[2]{%
  \@ifundefined{docbooktolatexcite@#1}%
  {\cite{#1}}%
  {\def\@docbooktolatextemp{#2}\ifx\@docbooktolatextemp\@empty%
   \cite{\@nameuse{docbooktolatexcite@#1}}%
   \else\cite[#2]{\@nameuse{docbooktolatexcite@#1}}%
   \fi%
  }%
}
\newcommand{\docbooktolatexbackcite}[1]{%
  \ifx\Hy@backout\@undefined\else%
    \@ifundefined{docbooktolatexcite@#1}{%
      % emit warning?
    }{%
      \ifBR@verbose%
        \PackageInfo{backref}{back cite \string`#1\string' as \string`\@nameuse{docbooktolatexcite@#1}\string'}%
      \fi%
      \Hy@backout{\@nameuse{docbooktolatexcite@#1}}%
    }%
  \fi%
}

% --------------------------------------------
% A way to honour <footnoteref>s
% Blame j-devenish (at) users.sourceforge.net
% In any other LaTeX context, this would probably go into a style file.
\newcommand{\docbooktolatexusefootnoteref}[1]{\@ifundefined{@fn@label@#1}%
  {\hbox{\@textsuperscript{\normalfont ?}}%
    \@latex@warning{Footnote label `#1' was not defined}}%
  {\@nameuse{@fn@label@#1}}}
\newcommand{\docbooktolatexmakefootnoteref}[1]{%
  \protected@write\@auxout{}%
    {\global\string\@namedef{@fn@label@#1}{\@makefnmark}}%
  \@namedef{@fn@label@#1}{\hbox{\@textsuperscript{\normalfont ?}}}%
  }

\makeindex
% index labeling helper
\newif\ifdocbooktolatexprintindex\docbooktolatexprintindextrue
\let\dbtolatex@@theindex\theindex
\let\dbtolatex@@endtheindex\endtheindex
\@ifundefined{@openrighttrue}{\newif\if@openright}{}
\def\theindex{\relax}
\def\endtheindex{\relax}
\newenvironment{dbtolatexindex}[2]
   {
\if@openright\cleardoublepage\else\clearpage\fi
\let\dbtolatex@@indexname\indexname
\def\dbtolatex@current@indexname{#2}
\ifx\dbtolatex@current@indexname\@empty                                                                                             \def\dbtolatex@current@indexname{\dbtolatex@@indexname}
\fi
\def\dbtolatex@indexlabel{%
 \ifnum \c@secnumdepth >\m@ne \ifx\c@chapter\undefined\refstepcounter{section}\else\refstepcounter{chapter}\fi\fi%
 \label{#1}\hypertarget{#1}{\dbtolatex@current@indexname}%
 \global\docbooktolatexprintindexfalse}
\def\indexname{\ifdocbooktolatexprintindex\dbtolatex@indexlabel\else\dbtolatex@current@indexname\fi}
\dbtolatex@@theindex
   }
   {
\dbtolatex@@endtheindex\let\indexname\dbtolatex@@indexname
   }

\newlength\saveparskip \newlength\saveparindent
\newlength\tempparskip \newlength\tempparindent

\def\docbooktolatexgobble{\expandafter\@gobble}
% Prevent multiple openings of the same aux file
% (happens when backref is used with multiple bibliography environments)
\ifx\AfterBeginDocument\undefined\let\AfterBeginDocument\AtBeginDocument\fi
\AfterBeginDocument{
   \let\latex@@starttoc\@starttoc
   \def\@starttoc#1{%
      \@ifundefined{docbooktolatex@aux#1}{%
         \global\@namedef{docbooktolatex@aux#1}{}%
         \latex@@starttoc{#1}%
      }{}
   }
}
% --------------------------------------------
% Hacks for honouring row/entry/@align
% (\hspace not effective when in paragraph mode)
% Naming convention for these macros is:
% 'docbooktolatex' 'align' {alignment-type} {position-within-entry}
% where r = right, l = left, c = centre
\newcommand{\docbooktolatex@align}[2]{\protect\ifvmode#1\else\ifx\LT@@tabarray\@undefined#2\else#1\fi\fi}
\newcommand{\docbooktolatexalignll}{\docbooktolatex@align{\raggedright}{}}
\newcommand{\docbooktolatexalignlr}{\docbooktolatex@align{}{\hspace*\fill}}
\newcommand{\docbooktolatexaligncl}{\docbooktolatex@align{\centering}{\hfill}}
\newcommand{\docbooktolatexaligncr}{\docbooktolatex@align{}{\hspace*\fill}}
\newcommand{\docbooktolatexalignrl}{\protect\ifvmode\raggedleft\else\hfill\fi}
\newcommand{\docbooktolatexalignrr}{}
\ifx\captionswapskip\@undefined\newcommand{\captionswapskip}{}\fi
\makeatother
\title{\bfseries Generování rostlin pomocí L-systémù\\[12pt]\normalsize Diplomová práce}
\author{Marek Pasiènyk}
% --------------------------------------------
\makeglossary
% --------------------------------------------

\setcounter{tocdepth}{4}

\setcounter{secnumdepth}{4}
\addto\captionsczech{\def\indexname{Rejst\v{r}\'{\i}k}}
\addto\captionsczech{\def\appendixname{P\v{r}\'{i}loha}}
\addto\captionsczech{\def\refname{Literatura}}
\begin{document}
% --------------------------------------------
% Useing fithesis
% --------------------------------------------
\FrontMatter
\ThesisTitlePage
\begin{ThesisDeclaration}
\DeclarationText
\AdvisorName
\end{ThesisDeclaration}

% --------------------------------------------
% Thanks 
% --------------------------------------------
\begin{ThesisThanks}

Chtìl bych podìkovat
\end{ThesisThanks}

% --------------------------------------------
% Abstract 
% --------------------------------------------
\begin{ThesisAbstract}

Tato práce se zabývá problematikou Lindenmayerových systémù, jako¾to nástroje pro generování rostlin. Rozebírá pak také metody a implementaci L-systémù a jejich grafickou interpretaci. Souèástí je i zásuvný modul pro generování rostlin pro systém Vrecko.
\end{ThesisAbstract}

% --------------------------------------------
% KeyWords 
% --------------------------------------------
\begin{ThesisKeyWords}
Lindenmayerovy systémy, L-systémy, generování rostlin, generování stromù, Vrecko, OpenSceneGraph, LSystem\end{ThesisKeyWords}

\makeatletter
\def\dbtolatex@contentsid{id378281}
\def\dbtolatex@@contentsname{\latex@@contentsname}
\let\latex@@contentsname\contentsname
\newif\ifdocbooktolatexcontentsname\docbooktolatexcontentsnametrue
\def\dbtolatex@contentslabel{%
 \label{\dbtolatex@contentsid}\hypertarget{\dbtolatex@contentsid}{\dbtolatex@@contentsname}%
 \global\docbooktolatexcontentsnamefalse}
\def\contentsname{\ifdocbooktolatexcontentsname\dbtolatex@contentslabel\else\dbtolatex@@contentsname\fi}
\let\save@@@mkboth\@mkboth
\let\@mkboth\@gobbletwo
\tableofcontents
\let\@mkboth\save@@@mkboth
\let\contentsname\latex@@contentsname
\Hy@writebookmark{}{\dbtolatex@@contentsname}{\dbtolatex@contentsid}{0}{toc}%
\makeatother
				\MainMatter

% -------------------------------------------------------------
% Chapter Úvod 
% ------------------------------------------------------------- 	
\chapter{Úvod}
\label{ch01}\hypertarget{ch01}{}%

Snaha pøevést pøírodu do digitální podoby provází poèítaèovou grafiku ji¾ od samého poèátku. Po celou tuto dobu je zpracování pøírodních procesù jednou z~nejvíce studovaných a tedy i rozvíjejících se oblastí. Od poèátku toti¾ byly pøírodní procesy pøíli¹ slo¾ité, ne¾ aby bylo mo¾né vytvoøit je pomocí poèítaèe bez jakéhokoli zpracování a zjednodu¹ení. Zároveò jsou v¹ak souèástí témìø ka¾dé animace, filmu, simulace èi poèítaèové hry. Díky tomu vzniklo za posledních padesát let od vynálezu svìtelného pera Ivana Sutherlanda, tedy od poèátku moderní poèítaèové grafiky, obrovské mno¾ství více èi ménì úspì¹ných metod. Proto také dnes ty nejmodernìj¹í metody umo¾òují nìkdy i fotorealistické zpracování modelù nebo simulaci rùzných pøírodních jevù graficky i fyzikálnì. S~urèitými omezeními je to navíc mo¾né i v~reálném èase. V~tomto vývoji samozøejmì hrál velkou roli i vývoj samotné poèítaèové techniky.

První pokusy o~vytvoøení poèítaèových modelù rostlinných organismù pochází z~roku 1966, kdy Stanislaw Ulman pøi¹el s~prvním mechanismem pro vytváøení vìtvených struktur. Vyu¾il k~tomu principu von Neumannova {\em{celulárního automatu}}. Zanedlouho v¹ak Aristid Lindenmayer publikoval koncept Lindenmayerových systémù, které se pozdìji staly nejpou¾ívanìj¹í metodou pro generování rostlinných organismù. Bìhem posledních 45 let se z~generování rostlin stal jeden z~dùle¾itých mezivìdních oborù. Na jedné stranì v¾dy stáli biologové, je¾ se za pomocí poèítaèových modelù a simulací sna¾ili pochopit principy vývoje a stavby rostlin. Na druhé stranì jsou pak specialisti na poèítaèovou grafiku, je¾ stromy pou¾ívají jako souèást grafických scén. Kombinací poznatkù obou vìdních oborù tak vznikají stále nové metody. Výsledkem je, ¾e modely rostlin jsou dnes èasto tì¾ko rozeznatelné od svých opravdových protìj¹kù.

Tato diplomová práce se vìnuje modelování rostlinných organismù za pou¾ití Lindenmayerových systémù. Cílem bylo navrhnout zásuvný modul LSystem pro systém Vrecko. Tento modul umo¾òuje na základì u¾ivatelsky definovaných parametrù vytvoøit ¹irokou ¹kálu rùzných modelù. Implementován toti¾ není pouze pùvodní Lindenmayerùv koncept, ale také øada metod, je¾ jej roz¹iøuje o~dal¹í mo¾nosti. Modely tak mohou napøíklad reagovat na okolní prostøedí. Lindenmayerovy systémy lze díky jejich v¹estranosti pou¾ít i pro vytváøení rùzných neorganických modelù. Vìt¹ina zde zmínìných metod je pou¾itelná pro vytvoøení libovolného rostlinného organismu. Pøi implementaci modulu LSystem v¹ak byl kladen dùraz na vytváøení modelù stromù a keøù, je¾ pak mohou být pou¾ity pro vytváøení venkovních scén v~systému Vrecko.

Zaèátek této diplomové práce se vìnuje pøedev¹ím samotným Lindenmayerovým systémùm, jejich typùm a mo¾nostem. Tøetí kapitola pak rozebírá problematiku modelování rostlinných organismù. Zbývající kapitoly se ji¾ vìnují samotnému návrhu a implementaci zásuvného modulu LSystem. Ètvrtá kapitola se zabývá obecným popisem modulu. Následující pátá kapitola pak obsahuje popis implementace generování øetìzcù pomocí L-systémù. Interpretace øetìzcù a vytváøení samotné geometrie modelù je pak obsahem ¹esté kapitoly. Práci uzavírá sedmá kapitola shrnující výkonnostní i zobrazovací výsledky.

% -------------------------------------------------------------
% Chapter Lindenmayerovy systémy 
% ------------------------------------------------------------- 	
\chapter{Lindenmayerovy systémy}
\label{ch02}\hypertarget{ch02}{}%

Lindenmayerovy systémy, zkrácenì L-systémy, byly vytvoøeny jako matematická teorie pro generování rostlin \docbooktolatexcite{Linden68}{}. Pùvodnì byl kladen dùraz spí¹e na obecnou topologii. Byly toti¾ vytvoøeny pro simulaci vývoje vìt¹ích èástí rostlin nebo bunìk mnohobunìèných organismù. Geometrie ani podrobnìj¹í detaily v~této pùvodní teorii zahrnuty nebyly. Pozdìji se v¹ak objevilo nìkolik geometrických interpretací L-systémù, díky nim¾ se staly L-systémy univerzálním nástrojem pro simulaci a modelování rostlin. V~této práci je napøíklad pou¾ito modelování pomocí ¾elví grafiky.

Lindemayerovy systémy v¹ak nenalezly uplatnìní zdaleka jen v~generování rostlinných organismù. Existuje øada projektù, je¾ rùznými zpùsoby experimentuje s~pou¾itím L-systémù.

% ------------------------   
% Section 
\section{Vývoj rostlin pomocí procesu pøepisování}
\label{sec0201}\hypertarget{sec0201}{}%

Jádro L-systémù spoèívá v~pou¾ití pøepisovacího systému. Jedná se o~opakované nahrazování modulù pøedchùdcù pomocí sady pøepisovacích pravidel jejich následníky, pøièem¾ následník je øetìzec modulù. V¹echny moduly nále¾í do koneèné abecedy modulù. Lze tak z~jednoduchého pùvodního objektu vytvoøit opakováním pøepisovacího procesu komplexní model. Modulem je my¹len libovolný objekt, je¾ vìt¹inou reprezentuje nìjakou èást simulovaného modelu nebo jeho vlastnost. Pøi pou¾ití pro simulaci biologických procesù se tak mù¾e jednat napøíklad o~buòky nebo rùzné typy rostlinných orgánù.

Jedním z~prvních grafických modelù, pou¾ívajících pøepisovací pravidla, byla Kochova køivka, pøípadnì Kochova vloèka \docbooktolatexcite{Koch05}{}. ©lo o~jednoduchý bezkontextový pøepisovací systém, který obsahoval pouze jediné pravidlo pøepisující jeden grafický prvek na jiný (\hyperlink{pic020101}{{\ref{pic020101}}}). Pozdìji tento model podstatnì roz¹íøil Benoît Mandelbrot, je¾ pøidal systémy podporující pøepisování úseèek o~rùzných délkách a hlavnì podporu vìtvených topologií.

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic020101}{}%
\begin{center}

{{\includegraphics[]{020102}}\hypertarget{id378364}{}%
\label{id378364}
}
{{\caption[{Kochova vloèka a její první tøi iterace pøepisovacího procesu.}]{{{Kochova vloèka a její první tøi iterace pøepisovacího procesu.}}}\label{pic020101}}}
\end{center}
\end{figure}

Nejvìt¹í pozornost v¹ak byla ubírána ke studiu systémù zalo¾ených na pøepisování øetìzcù znakù. Velkým pøínosem v~tomto odvìtví byly na konci padesátých let 20. století Chomského formální gramatiky, které vyu¾ívaly princip pøepisování pro popis syntaxe pøirozeného jazyka. V~roce 1968 pak biolog Aristid Lindenmayer pøedstavil odli¹ný typ mechanismu pøepisujícího øetìzce. Tento mechanismus byl posléze pojmenován jako L-systémy. Zásadní odli¹nost L-systémù od Chomského gramatik spoèívá v~pou¾ití pøepisovacích pravidel. Zatímco v~Chomského gramatikách jsou pøepisovací pravidla aplikována postupnì, v~L-systémech jsou pou¾ita paralelnì v~jednom derivaèním kroku na v¹echny symboly pøepisovaného øetìzce. Motivací pro tento pøístup byla podobnost s~biologickými procesy. Pøíkladem mohou být mnohobunìèné organismy, ve kterých se dìlí v¹echny buòky souèasnì. Na rozdíl od pøírodních pochodù vývoj L-systémù probíhá v~diskrétních krocích. Kvùli reprezentaci modelù jako øetìzce znakù se èasto místo pojmu modul pou¾ívá pojem symbol.

% ------------------------   
% Section 
\section{D0L-systémy}
\label{sec0202}\hypertarget{sec0202}{}%

Deterministické bezkontextové L-systémy, zkrácenì D0L-systémy,jsou nejjednodu¹¹í formou L-systémù. Pùvodní Lindenmayerovy systémy zahrnovaly právì pouze tento typ. Takovýto typ L-systému se skládá z~abecedy modulù, pøepisovacích pravidel a axiomu, je¾ slou¾í jako poèáteèní øetìzec modulù. Na obrázku \hyperlink{pic020201}{{\ref{pic020201}}} je znázornìna simulace vývoje mnohobunìèného vlákna bunìk nacházející se v~bakterii Anabaena catenula \docbooktolatexcite{Mitch1972}{}. Tyto øetìzce jsou tvoøeny dvìma typy bunìk. Prvním typem jsou mladé, krat¹í buòky. Druhý typ jsou buòky star¹í a del¹í. Ka¾dá buòka má také svou polaritu, která urèuje smìr jejich rùstu.

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic020201}{}%
\begin{center}

{{\includegraphics[]{020201}}\hypertarget{id378414}{}%
\label{id378414}
}
{{\caption[{První tøi iterace vlákna buòky {\em{Anabaena catenula}}}]{{{První tøi iterace vlákna buòky {\em{Anabaena catenula}}}}}\label{pic020201}}}
\end{center}
\end{figure}

Formální definice D0L-systémù je následující \docbooktolatexcite{Rozen1980}{}: 
\begin{itemize}
%--- Item
\item 
Abeceda {\em{V}} je koneèná mno¾ina {\em{symbolù}}.

%--- Item
\item 
{\em{Slovo}} je posloupnost symbolù nad abecedou {\em{V}}. Mno¾ina v¹ech tìchto posloupností se oznaèuje jako {\em{V*}}.

%--- Item
\item 
{\em{Pøepisovací pravidlo}} je uspoøádaná dvojice \ensuremath{(a,u)} zapsaná jako \ensuremath{a \to u} , kde \ensuremath{a} je symbol nále¾ící {\em{V}} a \ensuremath{u} je slovo nále¾ící {\em{V*}}. Symbol \ensuremath{a} se nazývá {\em{pøedchùdce}} a slovo \ensuremath{u} {\em{následník}}.

%--- Item
\item 
{\em{D0L-systém}} je uspoøádaná trojice \ensuremath{G= \langle V, \omega ,P \rangle}, kde {\em{V}} je abeceda, \ensuremath{\omega \in } {\em{V*}} je poèáteèní slovo nazývané {\em{axiom}} a {\em{P}} je mno¾ina pøepisovacích pravidel takových, ¾e pro \ensuremath{\forall a \in V: \exists p_{a} \in P}, kde \ensuremath{p_{a}} oznaèuje pøepisovací pravidlo, jeho¾ pøedchùdce je modul \ensuremath{a}.

\end{itemize}
\noindent  Dle obecných konvencí bývá pøepisovací pravidlo \ensuremath{a \to u} oznaèováno jako odpovídající modulu \ensuremath{a} a pro modul, kterému neodpovídá ¾ádné z~pøepisovacích pravidel, bývá pou¾ito pravidlo identity \ensuremath{a \to a} . Modul je mo¾né bìhem vývoje L-systému odstranit pomocí pou¾ití \ensuremath{\epsilon} pravidla.

Dle této definice je pak mo¾né pro vývoj vláken bakterie Anabaena zavést L-systém, je¾ popisuje jeho vývoj. V~tìchto pravidlech nahrazují del¹í buòky moduly \ensuremath{a} a krat¹í buòky moduly \ensuremath{b}. Index u~modulù oznaèuje jejich orientaci.

\ensuremath{\omega : a_p}

\ensuremath{p_1 : a_p \to a_l b_p}

\ensuremath{p_2 : a_l \to b_l a_p}

\ensuremath{p_3 : b_p \to a_p}

\ensuremath{p_4 : b_l \to a_l}

% ------------------------   
% Section 
\section{L-systémy se závorkami}
\label{sec0203}\hypertarget{sec0203}{}%

Obecné D0L-systémy poskytují mo¾nosti pouze pro vytvoøení sekvence modulù. Aby v¹ak bylo mo¾né vytvoøit slova reprezentující rostliny, je nutné umo¾nit L-systémùm vytváøet vìtvené topologie. Pro reprezentaci vìtvených struktur je potøeba zavést dva moduly. Tyto moduly byly ji¾ souèástí pùvodního Lindenmayerova konceptu \docbooktolatexcite{Linden68}{}. Pro oznaèení zaèátku a konce vedlej¹í vìtve se pou¾ívají symboly pravé a levé hranaté závorky.

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic020301}{}%
\begin{center}

{{\includegraphics[]{020301}}\hypertarget{id378806}{}%
\label{id378806}
}
{{\caption[{První tøi iterace vlákna buòky {\em{Anabaena catenula}}}]{{{První tøi iterace vlákna buòky {\em{Anabaena catenula}}}}}\label{pic020301}}}
\end{center}
\end{figure}

Slova, vyprodukovaná derivacemi pøepisovacích pravidel závorkového L-systému, se oznaèují jako stromy. Pøíklad takovéto stromové struktury vytvoøené L-systémem se závorkami je na obrázku \hyperlink{pic020301}{{\ref{pic020301}}}. Jedná se o~základní vìtvenou strukturu s~jednou hlavní osou tvoøenou moduly \ensuremath{aehik} . Slovo reprezentující tento strom lze pomocí jednoho øetìzce zapsat jako \ensuremath{w = a[b[c]d]e[fg]hi[j]k}.

Øetìzce modulù \ensuremath{a}, \ensuremath{e} a \ensuremath{hi} se oznaèují jako meziuzly a øetìzce \ensuremath{b[c]d}, \ensuremath{fg} a \ensuremath{j} jako vedlej¹í vìtve. Modul \ensuremath{k} je hrotem hlavní osy. Obdobnì lze pojmenovat i moduly na ni¾¹ích úrovních a oznaèit tak napøíklad moduly \ensuremath{c}, \ensuremath{d}, \ensuremath{g} a \ensuremath{j} jako hroty vedlej¹ích vìtví.

Strom lze podle \docbooktolatexcite{Prusin94}{} definovat jako slovo \ensuremath{w} nad abecedou \ensuremath{V_{E} = V~\cup \{ [,] \}} pro které platí, ¾e 
\begin{itemize}
%--- Item
\item 
\ensuremath{w = x_{1}[a_{1}]x_{2}[a_{2}]...x_{n}[a_{n}]x_{n+1}},

%--- Item
\item 
podslova \ensuremath{x_{1},x_{2},...,x_{n+1} \in V^*} neobsahují moduly závorek a

%--- Item
\item 
podslova \ensuremath{a_1,a_2,...,a_n \in V_{E}^*} jsou stromy.

\end{itemize}
\noindent 

% ------------------------   
% Section 
\section{Kontextové L-systémy}
\label{sec0204}\hypertarget{sec0204}{}%

Pøepisování pravidel u~0L-systémù je bezkontextové. Pøi produkci následníkù tedy nezále¾í na modulech v~okolí pøedchùdce. Pøi pøepisování kontextových L-systémù v¹ak musí kromì pøedchùdcù odpovídat také jejich sousední moduly. Tímto zpùsobem mohou mezi sebou jednotlivé moduly komunikovat nebo posílat ostatním modulùm signály. Lze tak simulovat reakci na proudìní látek rostlinou nebo informovat moduly o~globálních vlastnostech celého L-systému, jako je délka stonku, poèet kvìtù, stáøí apod. Moduly v¹ak takto mohou komunikovat i s~okolím L-systému a získávat tak informace napøíklad o~mno¾ství svìtla, mno¾ství ¾ivin, roèním období nebo pøeká¾ce v~rùstu.

Existuje mnoho implementací kontextových L-systémù. Nejpou¾ívanìj¹í jsou 1L-systémy a 2L-systémy. U~1L-systémù je brán zøetel buï pouze na levý nebo pouze na pravý kontext modulu pøedchùdce. Zápis pravidel s~jednostranným kontextem tedy mù¾e být ve tvaru

\begin{tabular}{l}

  \\
{\em{lk \textless{} pøedchùdce \ensuremath{\to} následník}} nebo {\em{pøedchùdce \textgreater{} pk \ensuremath{\to} následník}},  \\
  \\
\end{tabular}

kde {\em{lk}} je levý a {\em{pk}} pravý kontext. Obecnìj¹í tøídu tvoøí (k,l)-systémy, kde levý kontext tvoøí slovo o~délce {\em{k}} modulù a pravý kontext slovo o~délce {\em{l}} modulù. V~nìkteré litaratuøe bývají oznaèovány jako IL-systémy. V~této práci se zabývám jejich podmno¾inou, tøídou 2L-systémù. Pøepisovací pravidla v~tomto pøípadì zji¹»ují levý i pravý kontext s~maximální délkou 1. Touto tøídou lze pokrýt v¹echny po¾adované vlastnosti L-systémù na komunikaci modulù mezi sebou i s~okolím. Pravidla 2L-systémù se zapisují v~následující podobì:

\begin{tabular}{l}

  \\
{\em{lk \textless{} pøedchùdce \textgreater{} pk}} \ensuremath{\to} {\em{následník}}.  \\
  \\
\end{tabular}

U~bezzávorkových L-systémù je proces zji¹»ování, zda pøepisovací pravidlo odpovídá kontextu pøedchùdce, triviální a jednoznaèný. Pro závorkové systémy se v¹ak literatura rozchází a jsou pou¾ity rozdílné podmínky. Jde pøedev¹ím o~zpracování pravého kontextu. Pro tuto práci jsem se rozhodl pou¾ít zpùsob, je¾ obdobnì pou¾ívá ve své práci James Scott Hannan \docbooktolatexcite{Hanan92}{}. Na rozdíl od jiných pøístupù respektuje topologickou strukturu rostliny. Pokud toti¾ algoritmus napøíklad pøi zpracování pravého kontextu narazí na vìtvení, porovnává s~pravým kontextem ka¾dou vìtev. U~jiných pøístupù se nìkdy porovnává pouze vìtev, která s~pøedchùdcem sousedí v~øetìzci. Pøíklad je zobrazen na obrázku \hyperlink{pic02040201}{{\ref{pic02040201}}}.
\subsection{Párování levého kontextu}
\label{sec020401}\hypertarget{sec020401}{}%

Pøi párování levého kontextu dochází k~porovnání modulù kontextu s~moduly, které jsou v~øetìzci slova umístìny nalevo od modulu pøedchùdce. V~topologii rostlinného organismu se tedy jedná o~èásti rostliny, je¾ le¾í na nejkrat¹í cestì ke koøenùm. Pro ka¾dý modul existuje pouze jedna taková cesta a párování se tedy provádí pouze s~jedním øetìzcem modulù. Tato cesta, je¾ je v~topologii spojitá, nemusí v~øetìzci slova tvoøit spojitý øetìzec modulù. Pokud je pøi tomto párování nalezen modul {\texttt{{]}}}, znamená to , ¾e zde konèí vedlej¹í vìtev. Ta v¹ak topologicky nenavazuje a musí být pøeskoèena. Párování tedy pokraèuje za odpovídajícím symbolem {\texttt{{[}}}. Obrázek \hyperlink{pic02040101}{{\ref{pic02040101}}} ukazuje, jakým zpùsobem se levý kontext páruje. Modul {\em{A}} je zde levým kontextem pro pøedchùdce {\em{B}} i {\em{C}}. Modul {\em{B}} v¹ak není pøedchùdcem {\em{C}}, nebo» spolu topologicky nijak nesousedí.

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic02040101}{}%
\begin{center}

{{\includegraphics[]{02040101}}\hypertarget{id379217}{}%
\label{id379217}
}
{{\caption[{Párování levého kontextu.}]{{{Párování levého kontextu.}}}\label{pic02040101}}}
\end{center}
\end{figure}

\subsection{Párování pravého kontextu}
\label{sec020402}\hypertarget{sec020402}{}%

Párování pravého kontextu porovnává moduly napravo od pøedchùdce. Jde tedy o~moduly, je¾ vyrùstají z~pøedchùdce. Situace je zde komplikovanìj¹í, nebo» je nìkdy zapotøebí kvùli vìtvení provést párování na více øetìzcích. Pokud toti¾ za pøedchùdcem následuje rozvìtvení symbolizované modulem {\texttt{{[}}}, je nutné provést párování s~hlavní vìtví a se v¹emi vedlej¹ími vìtvemi. Pokud alespoò v~jednom pøípadì dojde ke shodì, je pravidlo pova¾ováno za odpovídající danému modulu pøedchùdce. Na obrázku \hyperlink{pic02040201}{{\ref{pic02040201}}} je znázonìno jednoduché vìtvení, kdy ke shodì dochází v~pøípadì, ¾e pravý kontext bude modul {\em{B}} nebo {\em{C}}.

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic02040201}{}%
\begin{center}

{{\includegraphics[]{02040201}}\hypertarget{id379267}{}%
\label{id379267}
}
{{\caption[{Párování pravého kontextu.}]{{{Párování pravého kontextu.}}}\label{pic02040201}}}
\end{center}
\end{figure}

% ------------------------   
% Section 
\section{Parametrické L-systémy}
\label{sec0205}\hypertarget{sec0205}{}%

Pøesto¾e doposud popisované typy L-systémù poskytují ¹irokou ¹kálu mo¾ností pro generování rostlin, jejich mo¾nosti jsou v~jistém smìru omezené. Problém spoèívá v~tom, ¾e ve¹keré moduly lze pou¾ít pouze v~celoèíselných násobcích. Výsledkem pak je, ¾e nelze napøíklad vytvoøit tak jednoduchý tvar, jako je rovnoramenný trojúhelník, jeho¾ základna má v~pomìru k~ramenùm iracionální délku. Pro odbourání tìchto problémù je nutné zavést parametrické L-systémy, je¾ pracují nad parametrickými slovy. Parametrická slova se skládají z~modulù, které kromì znaku obsahují také pøidru¾ené parametry.

Identifikující znak \ensuremath{A} nále¾í do abecedy \ensuremath{V} a parametry \ensuremath{a_1 , a_2 ,\dots, a_n} nále¾í do mno¾iny \ensuremath{\Re}. Takovýto roz¹íøený modul se znaèí jako \ensuremath{A( a_1 , a_2 ,..., a_n )} a patøí do mno¾iny \ensuremath{M = V\times \Re^*}, kde \ensuremath{\Re^*} je mno¾ina v¹ech koneèných posloupností parametrù.

Pravidla parametrických 0L-systémù mají tvar

\begin{tabular}{l}

  \\
{\em{pøedchùdce (parametry) : podmínka \ensuremath{\to} následník}}.  \\
  \\
\end{tabular}

Parametry modulù následníka nemusí mít nutnì tvar reálného èísla. Typicky jde o~aritmetické výrazy, které se pøed ka¾dým derivaèním krokem vyhodnotí na základì hodnot formálních parametrù pøedchùdce. Tyto parametry jsou oznaèovány jako {\em{$\Sigma$}} a aritmetické výrazy, je¾ tyto parametry pou¾ívají {\em{E($\Sigma$)}}. Dal¹ím roz¹íøením parametrických systémù je podmínka. Pøepisovací pravidlo mù¾e být pou¾ito pro pøepis pouze tehdy, pokud je podmínka splnìna. Jedná se o~logický výraz oznaèovaný jako {\em{C($\Sigma$)}}. Podmínka je volitelný parametr pravidla a pokud není definována, je implicitnì pova¾ována za splnìnou. I~pro vyhodnocení podmínky se pou¾ívají parametry pøedchùdce. Jak výrazy v~podmínce tak výrazy v~následníkovi jsou slo¾eny z~rùzných aritmetických znamének, volání funkcí, konstant a formálních parametrù pøedchùdce.

Parametrické 0L-systémy \docbooktolatexcite{Prusin04}{} jsou definovány jako uspoøádaná ètveøice \ensuremath{G= \langle V, \Sigma, \omega, P \rangle}, kde 
\begin{itemize}
%--- Item
\item 
{\em{V}} je koneèná neprázdná {\em{abeceda}},

%--- Item
\item 
{\em{$\Sigma$}} je mno¾ina {\em{formálních parametrù}},

%--- Item
\item 
\ensuremath{\omega \in ( V\times \Re )^+ } je neprázdné parametrické poèáteèní slovo nazývané {\em{axiom}} a

%--- Item
\item 
\ensuremath{P \subset ( V\times \Sigma^* )^+ \times C(\Sigma) \times (V~\times E(\Sigma)^*)^*} je koneèná mno¾ina {\em{pøepisovacích pravidel}}.

\end{itemize}
\noindent 

Ukázkou, jak je díky parametrùm ¹kála vytváøených slov roz¹íøena, je následující L-systém. Pomocí parametrù a rùzného nastavení konstant lze pomocí jediného pravidla vytváøet tvarovì velice rozmanité struktury. Obrázek \hyperlink{pic020501}{{\ref{pic020501}}} zobrazuje ètyøi pøíklady nastavení L-systému dle \docbooktolatexcite{Prusin96}{}. V¹echny tyto stromové struktury byly vytvoøeny pomocí následujícího jednoduchého L-systému:

\ensuremath{\omega : A(100, w_0 )}

\ensuremath{p_1 : A(s,w) : s>= min \to !(w)F(s)[+( \alpha_1 )/( \varphi_1 ) A~( s~\star r_1 , (w \star q)^e ) ]
        [+( \alpha_2 )/( \varphi_2 ) A~( s~\star r_2 , (w \star (1-q) )^e ) ]}

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic020501}{}%
\begin{center}

{{\includegraphics[]{020501}}\hypertarget{id382154}{}%
\label{id382154}
}
{{\caption[{Stromové struktury vytvoøené pomocí parametrického L-systému.}]{{{Stromové struktury vytvoøené pomocí parametrického L-systému.}}}\label{pic020501}}}
\end{center}
\end{figure}

% table ------------------------------------------------------
\begin{table}[htb]
\begin{center}%
\hypertarget{tab03040101}{}%
\begin{tabular}{cccccccccccc}
\hline 
{{Obrázek}} & {{\ensuremath{r_1}}} & {{\ensuremath{r_2}}} & {{\ensuremath{\alpha_1}}} & {{\ensuremath{\alpha_2}}} & {{\ensuremath{\varphi_1}}} & {{\ensuremath{\varphi_2}}} & {{\ensuremath{w_0}}} & {{\ensuremath{q}}} & {{\ensuremath{e}}} & {{\ensuremath{min}}} & {{\ensuremath{n}}} \tabularnewline
{{a}} & {{.65}} & {{.71}} & {{27}} & {{-68}} & {{0}} & {{0}} & {{20}} & {{.53}} & {{.50}} & {{1.7}} & {{12}} \tabularnewline
{{b}} & {{.92}} & {{.37}} & {{0}} & {{60}} & {{180}} & {{0}} & {{2}} & {{.50}} & {{.00}} & {{0.5}} & {{15}} \tabularnewline
{{c}} & {{.80}} & {{.80}} & {{30}} & {{-30}} & {{137}} & {{137}} & {{30}} & {{.50}} & {{.50}} & {{0.0}} & {{10}} \tabularnewline
{{d}} & {{.55}} & {{.95}} & {{-5}} & {{30}} & {{137}} & {{137}} & {{5}} & {{.40}} & {{.00}} & {{5.0}} & {{12}} \tabularnewline
\hline 
\end{tabular}
{{\caption{Hodnoty konstant pro vytvoøení stromù z~obrázku {{\ref{pic020501}}}.}\label{tab03040101}}}
\label{tab03040101}
\end{center}
\end{table}

% ------------------------   
% Section 
\section{Stochastické L-systémy}
\label{sec0206}\hypertarget{sec0206}{}%

V¹echna slova generovaná stejným deterministickým L-systémem jsou identická. Tato pøedvídatelnost je samozøejmì jednou z~velkých výhod modelování pomocí L-systémù. Díky ní mù¾e u¾ivatel pøímo pozorovat dopady provedených zmìn. Tento determinismus má v¹ak také za následek, ¾e modely zcela neodpovídájí svým biologickým protìj¹kùm. V~pøírodì se toti¾ jedinci urèitého rostlinného druhu èasto mezi sebou li¹í. Mohou se li¹it stavbou i tvarem a pøitom stále sdílet urèité vlastnosti dané svým druhem. Pro simulaci tohoto jevu je dobré vnést do L-systému urèitý druh náhodnosti, je¾ zároveò zajistí, ¾e základní vlastnosti daného druhu budou zachovány a výslední jedinci se budou li¹it jen ve vybraných detailech. Pro tento úèel byly zavedeny stochastické L-systémy, které umo¾òují do pøepisovacího procesu zavést náhodnost velice dobøe kontrolovatelným zpùsobem.

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic020601}{}%
\begin{center}

{{\includegraphics[]{020601}}\hypertarget{id382615}{}%
\label{id382615}
}
{{\caption[{Pøíklady rùzných jedincù generovaných jedním stochastickým L-systémem.}]{{{Pøíklady rùzných jedincù generovaných jedním stochastickým L-systémem.}}}\label{pic020601}}}
\end{center}
\end{figure}

Takovýto parametrický stochastický 0L-systém lze definovat jako uspoøádanou pìtici \ensuremath{G_\pi = \langle V, \Sigma, \omega, P, \pi \rangle .} Definice abecedy {\em{V}}, formálních parametrù {\em{$\Sigma$}}, axiomu \ensuremath{\omega} a mno¾iny pøepisovacích pravidel {\em{P}} je stejná jako u~parametrických L-systémù. Navíc je zde definována funkce \ensuremath{\pi}, která ka¾dému pravidlu z~mno¾iny {\em{P}} pøiøazuje aritmetický výraz \ensuremath{E( \Sigma )}. Tento výraz nabývá v¾dy nezáporných hodnot a jeho výsledek se oznaèuje jako {\em{pravdìpodobnostní faktor}} pøepisovacího pravidla. Pokud je pøi pøepisovacím procesu více pravidel, které odpovídají urèitému modulu, pou¾ije se pro výbìr pravidla vzorec, který na základì pravdìpodobnostního faktoru urèí pravdìpodobnost pou¾ití pravidla. Tento faktor nenabývá obecnì konstantních hodnot pro celý pøepisovací proces, ale vyhodnocuje se, podobnì jako podmínka a následník, na základì formálních parametrù pøedchùdce pøi ka¾dém pou¾ití pravidla. Pokud oznaèíme \ensuremath{\widehat{P} \subseteq P } jako mno¾inu v¹ech odpovídajících pravidel jednomu modulu, pak pravdìpodobnost \ensuremath{prob(p_k)} jednoho pravidla \ensuremath{p_k \in \widehat{P}} odpovídá výsledku rovnice 2.6.1.

\begin{dbequation}
\begin{center}
\hypertarget{id382710}{}%
\ensuremath{prob(p_k) = \frac {\pi ( p_k )}{ \sum_{ p_i \in \widehat{P} } \pi ( p_i )  }}{{\caption{Výpoèet pravdìpodobnosti výbìru pravidla p$_\textrm{\tiny k}$}\label{id382710}}}
\end{center}
\end{dbequation}

% -------------------------------------------------------------
% Chapter Modelování rostlinných organismù 
% ------------------------------------------------------------- 	
\chapter{Modelování rostlinných organismù}
\label{ch03}\hypertarget{ch03}{}%

Efektivní a reálné zobrazování rostlin je v~oblasti poèítaèové grafiky velice aktuální a diskutované téma. Hlavním dùvodem je, ¾e se jedná o~zcela bì¾nì zobrazované objekty v~rùzných aplikacích, scénách a simulacích. Jejich generování a zobrazení v¹ak na rozdíl od jiných èasto zobrazovaných modelù není tak jednoduché. Vìt¹ina modelù je toti¾ tvoøena relativnì velkými plochami a lze je vytvoøit malým mno¾stvím polygonù. Rostlinné organismy jsou v¹ak tvoøeny slo¾itými strukturami malých objektù, které jsou navíc øízené urèitými pøírodními zákonitostmi. Jejich modely jsou tedy díky velkému mno¾ství polygonù slo¾itìj¹í pro vykreslování. Kvùli slo¾ité vnitøní struktuøe je navíc komplikované i jejich generování.

Tato kapitola se zabývá samotnou problematikou vytváøení modelù rostlin. Jsou zde vysvìtleny metody, je¾ byly v~této práci pou¾ity pro návrh a modelování rostlinných organismù pøi zachování nìkterých nejdùle¾itìj¹ích pøírodních pravidel.

% ------------------------   
% Section 
\section{Interpretace ¾elví grafikou}
\label{sec0301}\hypertarget{sec0301}{}%

Proto¾e byly L-systémy navr¾eny jako matematický model bez geometrické interpretace, je potøeba pro modelování rostlin pou¾ít nìkterý z~pøístupù, je¾ pro tento úèel byly buï vyvinuty nebo byly pøevzaty. Sám Lindenmayer publikoval v~roce 1974 øe¹ení je¾ nahrazovalo moduly øetìzcù grafickými obrazci. ©lo v¹ak hlavnì o~topologii vìtvení rostlin a detaily jako délky nebo úhly natoèení segmentù byly do modelu dodávány dodateènì. Bìhem sedmdesátých a osmdesátých let vzniklo je¹tì mnoho jiných interpretací L-systémù, je¾ napøíklad ukázaly, ¾e L-systému jsou velmi platným nástrojem pro tvorbu fraktálù. V~roce 1986 pøi¹el Przemyslaw Prusinkiewicz s~my¹lenkou interpretovat L-systémy jako pohyb ¾elvy známé z~programovacího jazyka LOGO \docbooktolatexcite{Abel82}{}. Tato ¾elva funguje jako kurzor, který pøijímá rùzné pøíkazy týkající se jeho pohybu. Na základì tìchto pøíkazù pak tento kurzor kreslí svým pohybem jednu spojitou èáru. Pou¾ití ¾elví grafiky znaènì roz¹iøuje geometrické mo¾nosti L-systémù a je ideální pro tvorbu rostlinných struktur.
\subsection{Planární ¾elví grafika}
\label{sec030101}\hypertarget{sec030101}{}%

Jeliko¾ pùvod ¾elví grafiky spoèívá v~pohybu kurzoru po obrazovce, její pùvodní koncept zahrnoval pohyb ve dvojrozmìrném prostøedí. ®elva je definovaná jako trojice parametrù \ensuremath{(x,y, \alpha )} , kde \ensuremath{x} a \ensuremath{y} udávají kartézké souøadnice ¾elvy a úhel \ensuremath{\alpha} smìr, kterým ¾elva míøí. Jde o~tzv. èelo ¾elvy. Pokud zavedeme navíc hodnotu pro délku kroku a výchozí pøírùstek úhlu, o~který se ¾elva bude otáèet, mù¾eme vytvoøit jednoduchá pravidla pro pohyb ¾elvy v~rovinì. Jednotlivé znaky pak reprezentují daný modul a také akci, která je pøi naètení tohoto modulu provedena.

\begin{description}
% \null and \mbox are tricks to induce different typesetting decisions
\item[{F}]\null{}
®elva provede krok vpøed o~pøedem definované délce na pozici \ensuremath{(x',y')} . Mezi body \ensuremath{(x,y)} a \ensuremath{(x',y')} je vykreslena úseèka.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{+}]\null{}
Pøiká¾e ¾elvì otoèit se o~pøedem definovaný pøírùstek úhlu doleva. Úhel ¾elvy se zvìt¹í o~tuto hodnotu.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{-}]\null{}
Pøiká¾e ¾elvì otoèit se o~pøedem definovaný pøírùstek úhlu doprava. Úhel ¾elvy se zmen¹í o~tuto hodnotu.
\end{description}
\noindent 

Vykreslování pomocí ¾elví grafiky probíhá tak, ¾e ¾elva s~poèáteèními parametry \ensuremath{( x_0 , y_0 , \alpha_0 )} interpretuje jednotlivé znaky øetìzce postupnì zleva doprava.
\subsection{Interpretace závorkových L-systémù}
\label{sec030102}\hypertarget{sec030102}{}%

Jak ji¾ bylo vý¹e zmínìno, pro simulaci vìtvících se struktur rostlin je nutné roz¹íøení L-systémù o~závorky. Ka¾dý podøetìzec uzavøený závorkami zleva i zprava pøedstavuje v~topologii rostliny jednu vìtev. Pøi pou¾ití ¾elví grafiky je tak nutné v~bodech vìtvení rozdìlit souvislou èáru, je¾ ¾elva kreslí, na minimálnì dvì nové cesty. Pro tyto úèely se u¾ívá zásobníku. Pokud ¾elva narazí pøi procházení slova na znak {\texttt{{[}}}, ulo¾í se spolu se svými parametry na zásobník a její kopie pokraèuje v~interpretaci øetìzce za závorkou. Naopak pokud ¾elva narazí na znak {\texttt{{]}}}, je odstranìna a v~interpretaci pokraèuje ¾elva z~vrcholu zásobníku.
\subsection{Roz¹íøení pro interpretaci L-systémù v~3D}
\label{sec030103}\hypertarget{sec030103}{}%

Jednou z~hlavních výhod ¾elví grafiky je její jednoduchá roz¹iøitelnost pro pou¾ítí ve tøech rozmìrech. Parametry ¾elvy v¹ak musejí být roz¹íøeny. Pro pozici ¾elvy je zaveden vektor \ensuremath{\vec{P}}. Orientaci urèují tøi jednotkové vektory \ensuremath{\vec{H}}, \ensuremath{\vec{L}} a \ensuremath{\vec{U}} takové, ¾e splòují rovnici \ensuremath{\vec{H} \times \vec{L} = \vec{U}}. Vektor \ensuremath{\vec{H}}, podobnì jako u~rovinné ¾elvy, udává kam ¾elva smìøuje. Vektor \ensuremath{\vec{U}} smìøuje smìrem nahoru a vektor \ensuremath{\vec{L}} smìøuje vlevo od ¾elvy.

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic03010301}{}%
\begin{center}

{{\includegraphics[]{03010301}}\hypertarget{id383020}{}%
\label{id383020}
}
{{\caption[{Polohové a pohybové parametry ¾elvy v~3D prostoru.}]{{{Polohové a pohybové parametry ¾elvy v~3D prostoru.}}}\label{pic03010301}}}
\end{center}
\end{figure}

Sada pøíkazù je v~3D také znaènì roz¹íøena. Pro zmìnu orientace ¾elva interpretuje pøíkazy, je¾ ¾elvu rotují okolo jednotlivých os. Pro tyto rotace jsou bì¾nì pou¾ívány termíny z~letectví: kurs, podélný sklon a pøíèný náklon. Kompletní sada pøíkazù, kterou interpretuje i zásuvný modul, je¾ byl vytvoøen v~rámci této práce, je i spolu s~popisem interpretovaných funkcí uvedena v~pøíloze \hyperlink{appA}{{\ref{appA}}}.

% ------------------------   
% Section 
\section{Subapikální L-systémy}
\label{sec0302}\hypertarget{sec0302}{}%

Závorkové L-systémy umo¾nují vytváøet velice ¹irokou ¹kálu øetìzcù. Ne v¹echny v¹ak odpovídají rostlinné stavbì a pro generování rostlin se tak nehodí. Zavádìjí se proto jistá omezení a pravidla, obvykle nazýváné jako vzory vìtvení, je¾ nám zaruèí respektování nìkterých pøírodních vlastností. Výsledkem pak jsou L-systémy, které pravdivìji odpovídají reálným rostlinám. Jednou z~tìchto podmno¾in jsou i subapikální L-systémy. Poprvé byly pøedstaveny Alicí Kelemenovou v~roce 1986 \docbooktolatexcite{Kele86}{}. My¹lenkou tìchto L-systémù je, ¾e k~vìtvení dochází pouze u~vrcholù ji¾ exitujících vìtví. Tato vlastnost výchází ze základních výsledkù pøi pozorování rostoucích rostlin. Nové rostlinné orgány, jako je stonek, vìtve, listy nebo kvìty mohou být vytvoøeny pouze z~{\em{apikálního meristému}}. Tato tkáò obsahuje aktivnì se dìlicí buòky a nachází se v~oblasti vrcholù vìtví.

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic030201}{}%
\begin{center}

{{\includegraphics[]{030201}}\hypertarget{id383077}{}%
\label{id383077}
}
{{\caption[{První øada (a) zobrazuje vývoj struktury, je¾ splòuje podmínku subapikálního vìtvení. Druhá vìtvená struktura (b) ji nesplòuje\docbooktolatexcite{Prusin94}{}.}]{{{První øada (a) zobrazuje vývoj struktury, je¾ splòuje podmínku subapikálního vìtvení. Druhá vìtvená struktura (b) ji nesplòuje\docbooktolatexcite{Prusin94}{}.}}}\label{pic030201}}}
\end{center}
\end{figure}

% ------------------------   
% Section 
\section{Vzory vìtvených struktur}
\label{sec0303}\hypertarget{sec0303}{}%

Jedním z~nejvýznamnìj¹ích parametrù rostlin je zpùsob vìtvení. Má toti¾ velice zásadní vliv na vzhled. Zaøazením rostliny do nìkterého z~typù vìtvení lze také nìkdy odvodit typ L-systému, který bude nutné pro vygenerování modelu pou¾ít. Tato kapitola obsahuje základní vzory vìtvení rostlin, je¾ se v~pøírodì vyskytují.
\subsection{Monopodiální vzor}
\label{sec030301}\hypertarget{sec030301}{}%

Monopodiální struktury se vyznaèují jedním hlavním souvislým stonkem. Z~nìj pak vychází mnoho vedlej¹ích vìtví. Jeliko¾ hlavní kmen je v¾dy nejstar¹í vìtví, jeho tlou¹»ka je nejvìt¹í. Vedlej¹í vìtve se pak vyvíjejí podle stejného vzoru. Tento vzor lze dále rozdìlit podle distribuce vedlej¹ích vìtví na hlavním stonku.

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic03030101}{}%
\begin{center}

{{\includegraphics[]{03030101}}\hypertarget{id383128}{}%
\label{id383128}
}
{{\caption[{Ukázky monopodiálního vìtvení stromù \docbooktolatexcite{Prusin04}{}.}]{{{Ukázky monopodiálního vìtvení stromù \docbooktolatexcite{Prusin04}{}.}}}\label{pic03030101}}}
\end{center}
\end{figure}

\begin{itemize}
%--- Item
\item 
{\em{Bazitonické struktury}} mají vìtve u~vrcholu rostliny ménì vyvinuté, ne¾ vìtve blí¾e základny rostliny. Lze je vytvoøit i za pomocí jednoduchých D0L-systémù. Pokud je toti¾ pøi pøepisování dodr¾ena subapikální podmínka a je postupováno tak, ¾e moduly vrcholu jsou pøepisovány urèitým poètem meziuzlù zakonèených opìt vrcholy, je zøejmé, ¾e vìtve blí¾e koøenù budou rozvinutìj¹í. Je na nich toti¾ provedeno vìt¹í mno¾ství iterací. V~pøírodì se jedná o~jednodu¹¹í organismy. Typickými zástupci jsou napøíklad jehliènany nebo cykasy.

%--- Item
\item 
{\em{Mezotonický a akrotonický typ vìtvení}} lze v~pøírodì také nalézt. U~takto stavìných rostlin jsou nejrozvinutìj¹í vìtve uprostøed, respektive u~vrcholu stonku. Pro vìtvení dále od poèátku vìtve je v¹ak zapotøebí zavést do L-systému signály nebo rùstový potenciál. Tyto mechanismy v¹ak nelze vytvoøit pomocí D0L-systémù. Propagaci signálu lze provést pomocí kontextu u~kontextových L-systémù. Zvy¹ování rùstového potenciálu lze provést naopak pomocí parametrických L-systémù.

\end{itemize}
\noindent 

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic03030102}{}%
\begin{center}

{{\includegraphics[]{03030102}}\hypertarget{id383187}{}%
\label{id383187}
}
{{\caption[{Bazitonické (a), mezotonické (b) a akrotonické (c) dìlení \docbooktolatexcite{Prusin94}{}.}]{{{Bazitonické (a), mezotonické (b) a akrotonické (c) dìlení \docbooktolatexcite{Prusin94}{}.}}}\label{pic03030102}}}
\end{center}
\end{figure}

\subsection{Sympodiální vzor}
\label{sec030302}\hypertarget{sec030302}{}%

Jedná se o~vývojovì pokroèilej¹í typ vìtvení. Hlavní stonek je nesouvislý a jeho rùst je brzy potlaèen. Vedlej¹ích vìtví je zde men¹í poèet. Jsou v¹ak o~to více rozvinutìj¹í. Vìt¹ina listnatých stromù tvoøí právì sympodiální struktury. Modely s~touto strukturou lze vytvoøit i za pomocí D0L-systémù. Docílíme v¹ak pouze jednodu¹e se dìlících a opakujících se topologií. Pro pokroèilej¹í modely je mo¾né pou¾ít i jiné typy L-systémù.

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic03030201}{}%
\begin{center}

{{\includegraphics[]{03030201}}\hypertarget{id383228}{}%
\label{id383228}
}
{{\caption[{Ukázky sympodiálního vìtvení stromù \docbooktolatexcite{Prusin04}{}.}]{{{Ukázky sympodiálního vìtvení stromù \docbooktolatexcite{Prusin04}{}.}}}\label{pic03030201}}}
\end{center}
\end{figure}

% ------------------------   
% Section 
\section{Vlastnosti vìtvených struktur rostlinných organismù}
\label{sec0304}\hypertarget{sec0304}{}%

Aèkoli se vìtvení stromù i jiných rostlin mù¾e jevit náhodné, platí i pro nì urèitá pravidla. Ji¾ Leonardo da Vinci zkoumal nìkteré zákonitosti vìtvení stromù a stanovil postulát. Ten øíká, ¾e obsah prùøezu vìtve pøed vìtvením je shodný se souètem v¹ech obsahù prùøezù vìtví za vìtvením. Pozdìji se ukázalo, ¾e tento odhad byl velice pøesný a je vhodné jej pøi návrhu L-systému dodr¾ovat.

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic030401}{}%
\begin{center}

{{\includegraphics[]{030401}}\hypertarget{id383266}{}%
\label{id383266}
}
{{\caption[{Distribuce cév ve vìtvích a závíslost mno¾ství cév na úhlu dìlení.}]{{{Distribuce cév ve vìtvích a závíslost mno¾ství cév na úhlu dìlení.}}}\label{pic030401}}}
\end{center}
\end{figure}

V~roce 1994 tento postulát roz¹íøil Matthew Holton \docbooktolatexcite{Holt94}{}. Na rozdíl od da Vinciho v¹ak ji¾ znal vnitøní strukturu vìtví a také princip cévních svazkù u~cévnatých rostlin. Cévní svazky jsou souèástí transportního systému rostlin a rozvádìjí ¾iviny z~koøenù rostliny do jejího tìla. Pøi vìtvení dochází k~rozdìlení svazku na dva èi více samostaných svazkù. Toto rozdìlení právì souvisí s~da Vinciho postulátem. Kvùli men¹ímu mno¾ství ¾ivin, mají rozvìtvené vìtve adekvátnì men¹í obsah prùøezu. Holton v¹ak navíc pøi modelování svých rostlin pou¾il zajímavou spojitost mno¾ství cévních svazkù a úhlu dìlení vìtví. Cévní svazky toti¾ plní také zpevòovací funkci. Zavedl vztah, podle nìho¾ lze mno¾ství cév, a tedy i tlou¹»ku vìtve pøi dìlení, urèit podle úhlu odchylky od pùvodní osy. Èím je tento úhel vìt¹í, tím men¹í je poèet cév a prùmìr vìtve.

% -------------------------------------------------------------
% Chapter Zásuvný modul LSystem 
% ------------------------------------------------------------- 	
\chapter{Zásuvný modul LSystem}
\label{ch04}\hypertarget{ch04}{}%

Stì¾ejní èástí této diplomové práce je návrh a implementace zásuvného modulu pro systém Vrecko. Tento modul umo¾òuje simulaci rostlin, stromù a jiných modelù pomocí rùzných typù L-systémù a jejich následnou grafickou interpretaci a zobrazení v~systému Vrecko. Návrh a analýza byla provedena s~velkým dùrazem na modularitu a tedy mo¾nost pozdìj¹ího roz¹íøení o~nové funkce.

Logicky lze zásuvný modul LSystem rozdìlit na tøi èásti. První celek tvoøí syntaktický analyzátor souborù L-systémù a generátor slov. Syntaktický analyzátor zaji¹»uje správné zpracování L-systémù, jejich náhrání ze souboru a naètení v¹ech potøebných parametrù. Následnì pak zpracuje naètená data, která generátor pou¾ije pro provedení jednotlivých iteraèních krokù L-systémù. Slova i ostatní data jsou bìhem iteraèního procesu ulo¾ena do datových struktur optimalizovaných pro daný úèel. Jeliko¾ existuje nìkolik typù L-systémù, je implementována funckionalita, která pro pøepisování vybere algoritmus, který je svými schopnostmi i èasovou nároèností nejvhodnìj¹í pro zpracovávaný L-systém. Tvorba L-systémù se slo¾itìj¹í strukturou se vìt¹inou neobejde bez hiearchického rozdìlení problému. Zásuvný modul proto umo¾òuje rozdìlit model na nìkolik úrovní a do hlavního L-systému vkládat podsystémy. V~praxi to pak napøíklad u~generování stromù znamená, ¾e je mo¾né vytvoøit rozdílné L-systémy pro listy, kvìty a plody, které lze následnì vlo¾it do L-systému kostry stromu.

Druhý celek se zabývá grafickou interpretací vygenerovaného øetìzce. S~døíve zmiòovaným celkem komunikuje pouze na úrovni pøedání vygenerovaného slova, poskytnutí detailních parametrù pro nastavení interpretu a také mechanismu pro zpracování dotazù. Interpret v~souèasné podobì pou¾ívá pro generování geometrie modelù výhradnì ¾elví grafiku. Tento modul v¹ak obsahuje rovnì¾ interpret, jen¾ k~vytváøení geometrie neslou¾í. Jedná se o~interpret pro zpracování dotazù bìhem generování iterací L-systémù. Je tedy urèen pro rychlé zji¹tìní polohy a orientace ¾elvy. Pro zpracování slov obsahující závorky má interpret implementován zásobník. U¾ivatel má také mo¾nost volit z~nìkolika typù ¾elv, které mu dovolují vykreslovat geometrii rozdílnými pøístupy. Poslední ze tøí celkù plní funkci øídícího modulu a je umístnìn nad obìma pøedcházejícími celky, je¾ spravuje. Zároveò sprostøedkovává komunikaci jak se systémem Vrecko tak mezi moduly navzájem. Jedná se pøedev¹ím o~naètení základních parametrù, které oba moduly potøebují pro svou inicializaci.

% ------------------------   
% Section 
\section{Vývoj zásuvného modulu}
\label{sec0401}\hypertarget{sec0401}{}%

Vývoj probíhal na platformì Windows v~prostøedí Visual Studio 2005 v~jazyce C++. Ve¹keré tøídy nále¾í do jmenného prostoru {\texttt{{AP\_LSystem}}}. Stejnì jako celý systém Vrecko je i modul LSystem postaven na OpenSceneGraphu. Zejména se jedná o~èást zaji¹»ující interpretaci L-systémù a generování geometrie. Mimo to byly pro vývoj pou¾ity nìkteré z~knihoven Boost. Knihovna boost::program\_options umo¾òuje jednoduché a intuitivní ukládání a zpracovávání nastavení a konfiguraèních souborù. Knihovna boost::lexical\_cast jednodu¹e pøevádí a pøetypovává øetìzce znakù. Z~balíku Boost je také pou¾it inteligentní ukazatel boost::shared\_ptr. O~zpracování XML souborù se stará knihovna Xerces-C.

% ------------------------   
% Section 
\section{OpenSceneGraph}
\label{sec0402}\hypertarget{sec0402}{}%

Základním kamenem pro modul LSystem i pro systém Vrecko je OpenSceneGraph API. Jedná se o~objektovì orientované rozhraní nad OpenGL. Nízkoúrovòová funkcionalita je zde pøevedena na objekty v~grafech scén. Zároveò jsou mo¾nosti OpenSceneGraphu oproti klasickému OpenGL znaènì roz¹íøené a je pøidáno mnoho funkcionalit, je¾ zjednodu¹ují a urychlují vývoj.

% ------------------------   
% Section 
\section{Vrecko}
\label{sec0403}\hypertarget{sec0403}{}%

Jak ji¾ bylo zmínìno, je modul LSystem urèen pro systém Vrecko. Jedná se o~prostøedí pro tvorbu virtuální reality vyvíjené v~rámci HCI laboratoøe na Fakultì informatiky Masarykovy univerzity v~Brnì. Slou¾í primárnì pro vytváøení scén, je¾ nìjakým zpùsobem demonstrují a zkoumají mo¾nosti interakce èlovìka s~poèítaèem. Vychází z~principu OpenSceneGraph a scény jsou tedy obdobnì definovány jako grafy. Scény se v~tomto prostøedí dìlí na objekty, které mají urèité vlastnosti a dovednosti. Díky ním lze objekty ovládat a mìnit jejich tvar i vlastnosti. Zároveò lze k~tomuto systému pøipojit øadu rùzných zaøízení pro interakci u¾ivatele s~obsahem scény.

% -------------------------------------------------------------
% Chapter Generování slov pro modely rostlin 
% ------------------------------------------------------------- 	
\chapter{Generování slov pro modely rostlin}
\label{ch05}\hypertarget{ch05}{}%

Tato kapitola se zabývá implementací syntaktického analyzátoru a následným generováním slov pomocí L-systémù. Pøi implementaci této èásti byl kladen velký dùraz na rychlost a také na modularitu. Rychlost je zde dùle¾itá zejména pøi iteraèním procesu, nebo» výsledné slovo mù¾e mít délku a¾ v~øádu statisícù modulù. Je tedy tøeba zajistit vhodné struktury pro ukládání dat a vybrat vhodný algoritmus pro rychlý pøepis pravidel. Modularita a roz¹iøitelnost zde s~rychlostí úzce souvisí. Jednotlivé typy L-systémy toti¾ vy¾adují rozdílné pøístupy pøi pøepisování pravidel a tak je dùle¾ité vytvoøit více algoritmù, je¾ budou rùzné typy jednodu¹¹ích i komplexnìj¹ích L-systémù zpracovávat. Zároveò je v¹ak tøeba zaruèit, aby jednodu¹¹í L-systémy nebyly zpracovány pøíli¹ slo¾itými algoritmy, ale aby byly vybrány jednodu¹¹í a hlavnì optimalizovanìj¹í postupy pro daný problém. Modularita je zde dùle¾itá i pro syntaktický analyzátor, který tak zvládne zpracovat více formátù L-systémù.

Celou tuto funkcionalitu a komunikaci s~okolím zaji¹»uje tøída {\texttt{{LSystemGenerator}}}. Tato tøída je potomkem tøídy {\texttt{{AbstractGenerator}}}, která obsahuje rozhraní pro obsluhu této tøídy. Instance tøídy {\texttt{{LSystemGenerator}}} obsahuje odkaz na hlavní L-systém tøídy {\texttt{{AbstractLSystem}}}, který je poté pou¾it pro generování slova. Hlavním úkolem tøídy {\texttt{{LSystemGenerator}}} je vybrat správný syntaktický analyzátor pro nahrání souboru s~L-systémem a na základì získaných parametrù vybrat a vytvoøit instanci tøídy dìdící z~{\texttt{{AbstractLSystem}}}, je¾ bude pro následný iteraèní proces nejvhodnìj¹í. Nahráním souborù a jejich strukturou se zabývá následující kapitola.

% ------------------------   
% Section 
\section{Soubory L-systémù}
\label{sec0501}\hypertarget{sec0501}{}%

Vstupním bodem pro ka¾dý L-systém je jeho definice ulo¾ená v~jednom z~podporovaných souborových formátù. Spolu s~definicí mù¾e být souèástí celá øada parametrù, které mohou ovlivnit jak proces pøepisování pravidel tak i zpùsob následné geometrické interpretace. Zásuvný modul nyní podporuje dva typy souborù a lze jej roz¹íøit o~podporu dal¹ích formátù. Jedná se o~textový formát LS, jen¾ v~obdobné formì pou¾ívá ve svých projektech výzkumná skupina Biologického Modelování a Vizualizace kolem prof. Przemyslawa Prusinkiewicze z~University of Calgary. Tento formát byl zvolen z~dùvodu vedoucí úlohy této skupiny v~oboru L-systémù. Druhým formátem je soubor napsaný ve znaèkovacím jazyce XML, jen¾ byl zvolen pro svou jednoduchou roz¹iøitelnost a pøehlednost.

Struktura je v~obou pøípadech hierarchická a popis jejich entit je následující: 
\begin{itemize}
%--- Item
\item 
{\bfseries{Unikátní identifikátor L-systému}} je nutné pøiøadit ka¾dému L-systému. Ten se pak pou¾ívá hlavnì pøi vkládání podøízených L-systémù nebo pro získávání parametrù o~daném L-systému.

%--- Item
\item 
{\bfseries{Typ L-systému}} je dùle¾itým a nutným parametrem L-systému. Urèuje napøíklad, zda je L-systém deterministický èi bezkontextový. Na jeho správném nastavení pak závisí výbìr správného algoritmu pro zpracování samotných pravidel a pro následný iteraèní proces.

%--- Item
\item 
{\bfseries{Parametry}} nastavené pøímo v~souboru L-systému jsou specifické pro konkrétní L-systém. Pokud nìkteré z~parametrù nejsou nastaveny zde, pou¾ijí se pro generování a interpretaci slova globální parametry získané z~konfiguraèního souboru. Kompletní popis jednotlivých parametrù se nachází v~pøíloze \hyperlink{appB}{{\ref{appB}}}.

%--- Item
\item 
{\bfseries{Podøízené L-systémy}} lze vkládát do ka¾dého L-systému. Lze je vlo¾it pøidáním cesty k~souboru L-systému. Nikdy v¹ak není vhodné tvoøit v~grafu hierarchie L-systémù kru¾nice. Podrobnìji se touto tématikou zabývá kapitola \hyperlink{sec0507}{{\ref{sec0507}}}.

%--- Item
\item 
{\bfseries{Axiom}} je poèáteèní øetìzec symbolù. Jde tedy o~slovo v~nulté iteraci L-systému.

%--- Item
\item 
{\bfseries{Pøepisovací pravidla}} tvoøí mno¾inu pravidel, která budou pou¾ita pøi iteraèním procesu. Na poøadí není brán zøetel, proto¾e se pøi ka¾dém iteraèním kroku aplikují v¹echna pravidla najednou. Z~tohoto dùvodu je dùle¾ité, aby byla jednotlivá pravidla jednoznaèná a neexistovala dvì pravidla pro stejný modul pøedchùdce. Jedinou výjimkou jsou stochastické systémy. Struktura pravidel je závislá na jejich typu a podrobnìji je popsána v~odpovídajících podkapitolách kapitoly \hyperlink{sec0505}{{\ref{sec0505}}}.

%--- Item
\item 
{\bfseries{Homomorfismy}} jsou zvlá¹tním typem pøepisovacích pravidel, která se nezpracovávají bìhem iteraèního procesu. K~pøepisu tìchto pravidel dochází v¾dy a¾ po dokonèení v¹ech iterací.

\end{itemize}
\noindent 

Formáty se implementují jako potomci tøídy {\texttt{{AbstractFile}}}. Ta poskytuje rozhraní pro získání potøebných dat ze souboru.

\begin{Verbatim}[fontsize=\small]
class AbstractFile
{
protected:
    unsigned m_Type;
    std::string m_Name, m_Axiom;
    std::vector<std::string> m_Rules, m_Homomorphisms, m_Subsytems;
    void substitute(std::map<std::string, std::string> &)
public:
    AbstractFile();
    virtual void open( std::string & ) = 0;
    std::vector<string> * getHomomorphisms();
    std::vector<string> * getRules();
    std::vector<string> * getSubsystems();
    std::string & getAxiom();
    unsigned getType();
    std::string & getName();
};
\end{Verbatim}

Tøídy odvozené od tøídy {\texttt{{AbstractFile}}} musí implementovat metodu {\texttt{{open()}}}, je¾ zaruèí zpracování dat ze souboru a ulo¾í je do jednotlivých atributù této tøídy. Pomocná metoda {\texttt{{substitute()}}} nahrazuje øetìzce a mù¾e být pou¾ita pro zpracování konstant nebo podøízených L-systémù. Ostatní metody slou¾í jen jako pøístupové metody k~atributùm.
\subsection{Formát LS}
\label{sec050101}\hypertarget{sec050101}{}%

Jedná se o~jednoduchý textový formát zalo¾ený na pøíkazech podobných preprocesorovým pøíkazùm jazyka C. Nìkteré pøíkazy jsou párové a musí být ukonèeny. Jako hodnota je brán øetìzec následující po pøíkazu. Tento øetìzec nemù¾e obsahovat ¾ádné bílé znaky. Formát {\em{LS}} dovoluje také vkládat komentáøe pou¾itím dvojitého lomítka {\texttt{{//}}}.

\begin{Verbatim}[fontsize=\small]
#lsystem TernaryTree          // unikátní ID L-systému

#type 0L                      // typ L-systému
#define Pitch 65              // konstanta
#include data\ls\leaf.ls      // cesta k podøízenému L-systému

// parametry
#set Iteration=14             
#set TurtleType=STRAIGHT_PIPE
#set DefaultAngle=30.0

// axiom
#axiom
F'(0.65)A
#endaxiom

// pøepisovací pravidla
#rules 
A:*->!(0.577)'(0.87)[/(90.74)B][/(-132.63)B]B
B:*->^(33.95)[^(Pitch)#{Leaf}][#{Leaf}]Z[^(Pitch)#{Leaf}][#{Leaf}]ZA
#endrules

#endlsystem
\end{Verbatim}

\subsection{Formát XML}
\label{sec050102}\hypertarget{sec050102}{}%

V~pøípadì {\em{XML}} souboru jde o~klasický {\em{XML}} dokument verze 1.0 s~kódováním UTF-8. Ve¹keré pou¾ité elementy jsou párové a nejsou pou¾ity ¾ádné atributy. {\texttt{{LSystem}}} je koøenová znaèka, která obsahuje v¹echny potøebné entity. V~následujícím odstavci je pøíklad zápisu L-systému do {\em{XML}} souboru.

\begin{Verbatim}[fontsize=\small]
<?xml version="1.0"?>
<!-- koøenová znaèka -->
<LSystem>
  <!-- unikátní identifikátor L-systému -->
  <Name>TernaryTree</Name>
  <!-- typ L-systému -->
  <Types>
    <Type>0L</Type>
  </Types>
  <!-- konstanty -->
  <Constants>
    <LeafPitch>65.0</LeafPitch>
  </Constants>
  <!-- parametry -->
  <Parameters>
    <Iteration>14</Iteration>
    <TurtleType>STRAIGHT_PIPE</TurtleType>
    <DefaultAngle>30.0</DefaultAngle>
  </Parameters>
  <!-- subsystémy -->
  <Subsystems>
    <Subsystem>data\ls\leaf01.ls</Subsystem>
  </Subsystems>
  <!-- axiom -->
  <Axiom>F'(0.65)A</Axiom>
  <!-- pøepisovací pravidla -->
  <Rules>
    <Rule>A:*->!(0.577)'(0.87)[/(90.74)B][/(-132.63)B]B</Rule>
    <Rule>B:*->^(33.95)[^(LeafPitch)#{Leaf01}][#{Leaf01}]Z
                       [^(LeafPitch)#{Leaf01}][#{Leaf01}]ZA</Rule>
  </Rules>
  <!-- homomorfismy -->
  <Homomorphisms>
    <Homomorphism>A:*->Z</Homomorphism>
  </Homomorphisms>
</LSystem>
\end{Verbatim}

Nìkteré symboly pravidel jsou bohu¾el zároveò øídícími symboly XML, a tak je zapotøebí nahradit je odpovídajícími XML entitami.

% ------------------------   
% Section 
\section{Øetìzce modulù}
\label{sec0502}\hypertarget{sec0502}{}%

Pøi generování slova L-systémem dochází k~vytváøení velmi dlouhých øetìzcù s~nestejnorodými daty. Moduly, ze kterých se øetìzce tvoøí, toti¾ kromì znaku pro identifikaci modulu obsahují také parametry rùzných datových formátù. Zpracování takovýchto dat musí být navíc dostateènì rychlé. Pro tento úèel byla vytvoøena na míru pøizpùsobená tøída {\texttt{{LongString}}}. Data jsou zde ulo¾ena ve formátu, který umo¾òuje rychlou manipulaci s~daty, pøedev¹ím pak pøipojení nového øetìzce na konec stávajícího. Pøi iteraèním procesu je zapotøebí provádìt tuto operaci rychle. S~ka¾dou iterací je zpracováno pùvodní slovo a podle nìj se vytváøí vytváøí, na základì pøepisovacích pravidel, nové slovo dal¹í iterace. Provádí to tak, ¾e prohlí¾í jednotlivé moduly pùvodního slova zleva doprava a hledá shodu s~nìkterým z~pøedchùdcù v~pøepisovacích pravidlech. V~pøípadì nalezení pravidla je následník pøidán na konec nového slova. V~pøípadì, ¾e pøedchùdce mezi pravidly nalezen není, pøipojí se na konec kopie pùvodního modulu. Pou¾ije se tedy pravidlo identity. Implementací samotného pøepisovacího mechanismu se zabývá kapitola \hyperlink{sec050403}{{\ref{sec050403}}}
\subsection{Vnitøní struktura øetìzce}
\label{sec050201}\hypertarget{sec050201}{}%

Datová struktura {\texttt{{LongString}}} je v~jádru tvoøena bajtovým polem. Toto pole se nezvìt¹uje pøi ka¾dém roz¹íøení øetìzce, ale v¾dy jen po dosa¾ení urèité velikosti. Dochází tak ke znatelné úspoøe èasu pøi alokaci pamìti, která se provádí podstatnì ménì èastìji. Ka¾dý modul je zde ulo¾en jako znak identifikující daný modul a pøípadnì jeho parametry. Parametry mohou být typu {\texttt{{int}}}, {\texttt{{unsigned char}}} nebo typu {\texttt{{double}}}. Implementace dal¹ích typù je mo¾ná a jednoduchá. Pro souèasné pou¾ití v¹ak nebyly jiné typy zapotøebí. Obrázek \hyperlink{pic05020101}{{\ref{pic05020101}}} ukazuje, jakým zpùsobem je struktura navr¾ena.

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic05020101}{}%
\begin{center}

{{\includegraphics[]{05020101}}\hypertarget{id383648}{}%
\label{id383648}
}
{{\caption[{Vnitøní uspoøádání dat v~øetìzci typu {\texttt{{LongString}}}}]{{{Vnitøní uspoøádání dat v~øetìzci typu {\texttt{{LongString}}}}}}\label{pic05020101}}}
\end{center}
\end{figure}

Jedno políèko odpovídá jednomu bajtu. Ka¾dý modul obsahuje jeden znak, jen¾ jej identifikuje. Dále pak mù¾e obsahovat libovolný poèet parametrù. Ka¾dý parametr je identifikován jedním bajtem zleva a jedním zprava. Pøi pou¾ití této datové struktury tedy není nutné provádìt jakékoli pøevody mezi typy, jejich¾ hodnoty jsou tak rychle dostupné. Pro ilustraci byly na obrázku pou¾ity u~jednoho modulu dva rùzné datové typy.
\subsection{Inicializace}
\label{sec050202}\hypertarget{sec050202}{}%

Pro vytvoøení instance slou¾í jediný konstruktor. Parametrem je velikost øetìzce. Implicitní hodnota tohoto parametru je 1 048 576 bajtù. Právì hodnota tohoto parametru je také pou¾ita jako minimální pøírùstek alokované pamìti, pokud se stávající pamì» naplní. Plnìní daty lze provádìt buï pøipojováním øetìzcù, je¾ je popsáno v~následující kapitole, nebo konverzí klasického zápisu øetìzce typu {\texttt{{std::string}}} do podoby øetìzce {\texttt{{LongString}}}. K~tomu slou¾í metoda {\texttt{{convertFromString()}}}. Této mo¾nosti lze vyu¾ít pøi naèítání pravidel získaných ze souboru.

Identifikující znaky modulù jsou v~nezmìnìné podobì ulo¾eny i v~øetìzci {\texttt{{LongString}}}. Hodnoty parametrù jsou v¹ak konvertovány do odpovídajícího typu. Pro rozli¹ení typù se pou¾ívají rùzné závorky. Zatímco kulaté závorky indikují typ {\texttt{{double}}}, slo¾ené závorky indikují typ {\texttt{{integer}}}. Konvertované hodnoty jsou v~øetìzci z~obou stran obaleny jednobajtovým identifikátorem. Hodnota tohoto idetifikátoru odpovídá poøadí ve výètovém typu {\texttt{{ParameterType}}}.
\subsection{Pøipojování øetìzcù}
\label{sec050203}\hypertarget{sec050203}{}%

Jak ji¾ bylo vý¹e zmínìno, je tato struktura optimalizována pro opakované zvìt¹ování pøidáváním øetìzcù na její konec. Pøi ka¾dém pøipojení se provádí kontrola, zda je alokované místo dostateèné pro pøipojení dal¹ích dat. Pokud ne, volá se automaticky metoda {\texttt{{resize()}}}, je¾ alokuje novou pamì» a zvìt¹í tento øetìzec o~délku nastavenou pøi vytváøení instance.

Pro pøipojení dat je k~dispozici nìkolik metod. Jedná se o~rùzné formy metody {\texttt{{append()}}}. Ta poskytuje díky ¹ablonì mo¾nost ulo¾it libovolný, ve výètu {\texttt{{ParameterType}}} definovaný, datový typ. Kromì toho je tato metoda pøetí¾ena kvùli specifickým zpùsobùm pøipojení nìkterých dat. Lze tak pøipojit jiný øetìzec typu {\texttt{{LongString}}} nebo pole bajtù ve správném formátu.
\subsection{Pøístup k~datùm øetìzce}
\label{sec050204}\hypertarget{sec050204}{}%

Pøistupovat lze k~datùm jedním ze ètyø zpùsobù. 
\begin{itemize}
%--- Item
\item 
Operátor {\texttt{{[]}}} pøímo poskytuje hodnotu bajtu na urèité pozici øetìzce.

%--- Item
\item 
Díky metodì {\texttt{{getData()}}} lze získat blok dat nebo celý øetìzec bajtù. Hodí se pøedev¹ím pøi provádìní substitucí.

%--- Item
\item 
Nejpou¾ívanìj¹í mo¾ností je metoda {\texttt{{getSymbol()}}}, díky ní¾ lze získat blok dat odpovídající jednomu modulu, neboli symbolu, na dané pozici.

%--- Item
\item 
Metody ¹ablony {\texttt{{getParameters()}}} se pou¾ívají pro zpracování parametrických L-systémù. Vrací pole parametrù libovolného typu a jejich poèet. Tyto parametry jsou získány z~pozice za identifikujícím znakem modulu.

%--- Item
\item 
Metody {\texttt{{matchRight()}}} a {\texttt{{matchLeft()}}} slou¾í pøedev¹ím k~ovìøování kontextu. Pro svou funkci vyu¾ívají metodu {\texttt{{peekSymbol()}}} pro nahlédnutí na levý nebo pravý nejbli¾¹í znak. Jeliko¾ øetìzce obsahují závorky, jsou implementovány i pomocné metody {\texttt{{findMatchingRightBracket()}}} a {\texttt{{findMatchingLeftBracket()}}} pro nalezení odpovídajícího protìj¹ku k~libovolné závorce. Podrobnìji je celá funkcionalita nalezení kontextu popsána v~kapitole \hyperlink{sec050503}{{\ref{sec050503}}}.

\end{itemize}
\noindent 

% ------------------------   
% Section 
\section{Implementace pøepisovacích pravidel}
\label{sec0503}\hypertarget{sec0503}{}%

Potomci tøídy {\texttt{{AbstractFile}}} zaji¹»ují, aby byla pravidla správnì naètena ze souboru. L-systému jsou pøedána jako klasický øetìzec znakù. Ten v¹ak není vhodný pro samotný iteraèní proces. Proto se ka¾dé pravidlo zpracovává do struktury {\texttt{{Rule}}}. Rùzné typy L-systémù zpracovávají pøedané øetìzce odli¹nì. Podrobnìji se tomuto rozdìlení vìnuje kapitola \hyperlink{sec0505}{{\ref{sec0505}}}. V~této èásti jsou uvedeny implementaèní podrobnosti struktury {\texttt{{Rule}}}, do nich¾ v¹echny L-systémy svá pøepisovací pravidla pøed iteraèním procesem ukládají.

Jednou ze zásadních vìcí bylo zakomponovat do pravidel nìjaký mechanismus pro vyhodnocování výrazù. V~pravidlech se toti¾ mohou výrazy vyskytovat hned na nìkolika místech. 
\begin{itemize}
%--- Item
\item 
Ka¾dý modul na stranì následníka mù¾e místo parametru obsahovat výraz, je¾ se vyhodnocuje a¾ na základì parametrù pøedchùdce.

%--- Item
\item 
U~parametrických L-systémù se mù¾e vyskytnout podmínka pøepisu, která se musí pøed ka¾dým pøepisem vyhodnotit. Pøi jejím nesplnìní je pravidlo zamítnuto.

%--- Item
\item 
Stochastické L-systémy mívají nastaven pravdìpodobnostní faktor, na jeho¾ základì závisí pravdìpodobnost vybrání daného pravidla pro pøepis. Tento faktor se mù¾e rovnì¾ vyhodnocovat z~výrazu.

\end{itemize}
\noindent 

Pro zpracování výrazù byla vybrána knihovna {\texttt{{FunctionParser}}}. Jedná se o~volnì ¹íøitelnou knihovnu, která poskytuje dostateènou a navíc u¾ivatelsky roz¹iøitelnou funkcionalitu. Nabízí i mo¾nosti optimalizace. Pro ka¾dý výraz, jen¾ je v~pravidlech nalezen, je vytvoøena jedna instance tøídy {\texttt{{FunctionParser}}}. Pro zpracování slou¾í metoda {\texttt{{Parse()}}} s~parametry zpracovávaného výrazu a øetìzce v¹ech promìnných. Vyhodnocení se provádí metodou {\texttt{{Eval()}}}, která po pøedání pole s~hodnotami promìnných vrací výsledek výrazu.

Jako pøíklad je zde uvedeno pravidlo stochastického parametrického 2L-systému, kterým se zabývala kapitola \hyperlink{sec050503}{{\ref{sec050503}}}.

\begin{Verbatim}[fontsize=\small]
A(x,y) < B(z) > C(a,b,c):(x>abs(a-c))->B(b-1)FA(x/2,y/2):max(0,1-1/z*z)
\end{Verbatim}

Z~tohoto zápisu je patrné, ¾e pro v¹echny výrazy se pou¾ívají promìnné pøedchùdce a kontextù. V~tomto pøípadì se jedná o~{\texttt{{x}}}, {\texttt{{y}}}, {\texttt{{z}}}, {\texttt{{a}}}, {\texttt{{b}}} a {\texttt{{c}}}. Tyto znaky jsou ulo¾eny ve struktuøe {\texttt{{Rule}}} jako {\texttt{{m\_Variables}}} a slou¾í k~vytváøení instancí tøídy {\texttt{{FunctionParser}}}. Dále struktura obsahuje promìnné pro ulo¾ení znakù pøechùdce, obou kontextù a ukazatele na instance pro vyhodnocení podmínky pravidla a pravdìpodobnostního faktoru. Tyto promìnné pak slou¾í k~výbìru správného pravidla pro pøepis modulu.

Jeliko¾ se následník skládá z~øetìzcù modulù a výrazù, je jeho zpracování slo¾itìj¹í. Øetìzce modulù jsou ulo¾eny do instancí tøídy {\texttt{{StaticString}}}. Jedná se o~zjednodu¹enou variantu tøídy {\texttt{{LongString}}}. Data jsou zde ulo¾ena ve stejné podobì. Rozdílem v¹ak je, ¾e tento øetìzec má nemìnnou velikost. Pro úèel krátkých nemìnných øetìzcù následníka je tedy ideální, proto¾e nezabírá tolik prostoru v~pamìti. Øetìzce i výrazy se ukládájí do kontejneru typu {\texttt{{std::vector}}}. Jsou zde ulo¾eny tak, aby mohly být pøi pøepisu tohoto pravidla støídavì z~kontejneru vybírány. Ukázka zpracovaného pravidla z~pøedchozího pøíkladu je na obrázku \hyperlink{pic050301}{{\ref{pic050301}}}.

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic050301}{}%
\begin{center}

{{\includegraphics[]{050301}}\hypertarget{id383979}{}%
\label{id383979}
}
{{\caption[{Rozdìlení následníka na øetìzce modulù a výrazy}]{{{Rozdìlení následníka na øetìzce modulù a výrazy}}}\label{pic050301}}}
\end{center}
\end{figure}

Na obrázku \hyperlink{pic050301}{{\ref{pic050301}}} je vidìt, ¾e pokud po sobì následují dva výrazy, mù¾e být øetìzec mezi nimi prázdný. ©edì jsou znázornìny znaky, které jsou zahozeny, nebo» jsou pro dal¹í zpracování nepotøebné. Pøi zpracování i následném pøepisu pravidla se v¾dy zaèíná a konèí výbìrem øetìzce modulù. Velikost kontejneru s~øetìzci je tedy v¾dy právì o~jednu vìt¹í ne¾ velikost kontejneru s~výrazy. Je to z~toho dùvodu, ¾e èasto existují pravidla, která obsahují v~následníkovi pouze øetìzec a ¾ádný výraz. Pokud nìjaký výraz obsahují, vyskytuje se vìt¹inou nìkde uprostøed následníka. Proto je tento zpùsob zpracování optimální.

% ------------------------   
% Section 
\section{Zpracování L-systémù}
\label{sec0504}\hypertarget{sec0504}{}%

L-systémy jsou implementovány jako potomci tøídy {\texttt{{AbstractLSystem}}}. Abstraktní tøída {\texttt{{AbstractLSystem}}} obsahuje nìkolik metod slou¾ících jako rozhraní pro práci s~L-systémy. 
\begin{itemize}
%--- Item
\item 
Pro inicializaci slou¾í metoda {\texttt{{loadFromFile()}}}, která naète v¹echna potøebná nastavení. Jako zdroj nastavení slou¾í instance potomkù abstraktní tøídy {\texttt{{AbstractFile}}}.

%--- Item
\item 
Pro provedení dal¹í iterace slou¾í metoda {\texttt{{nextIteration()}}}. Poèet iterací lze ovlivnit i nastavením v~konfiguraèním souboru a v~parametrech L-systému. Díky této metodì je v¹ak mo¾né interaktivnì provádìt dal¹í iterace L-systému.

%--- Item
\item 
Metoda {\texttt{{translate()}}} vrátí vygenerované slovo. Slovo je v¾dy uvnitø tøídy L-systému ulo¾eno ve své nejvy¹¹í iteraci. Na slovì, které tato metoda vrátí, jsou je¹tì pøedtím provedeny finální úpravy. Aplikují se pravidla homomorfismù a odkazy na podøízené L-systémy se nahradí slovy, je¾ tyto L-systémy stejným zpùsobem vygenerovaly.

\end{itemize}
\noindent  Ve¹kerá funcionalita, je¾ je spoleèná pro v¹echny typy L-systémù je implementována ve spoleèném rodièi {\texttt{{LSystem}}}. Celý proces se dá rozdìlit do tøí fází, jejich¾ popis je obsahem následujících kapitol.
\subsection{Výbìr nejvhodnìj¹ího L-systému}
\label{sec050401}\hypertarget{sec050401}{}%

Zásuvný modul v~souèasné podobì obsahuje tøi rùzné tøídy zpracovávající rùzné typy L-systémù. Li¹í se rychlostí a svými schopnostmi. Je tedy nutné, aby generátor vybral vhodný algoritmus. Stejnì dùle¾itý je i výbìr u~podøízených L-systémù. Ka¾dý soubor L-systému má nastaven svùj typ. Jedná se o~výèet vlastností, které od tøídy L-systému bude po¾adovat. Samotné tøídy mají pak implementovanou statickou metodu {\texttt{{isCapable()}}}, na jejím¾ základì lze rozpoznat, zda daná tøída po¾adavkùm vyhovuje. Pou¾ívá k~tomu statický atribut {\texttt{{capabilities}}}, kde jsou schopnosti ulo¾eny jako bitový souèet. Jednotlivé schopnosti jsou definovány ve výètu {\texttt{{LSystemCapabilities}}}.

Statická tovární metoda {\texttt{{AbstractGenerator::createLSystem()}}} usnadòuje vytváøení nejvhodnìj¹í instance. Na základì typu naèteného souboru automaticky vytvoøí a vrátí vhodnou instanci L-systému. Testování, zda daný typ L-systému vyhovuje, zde probíhá od nejrychlej¹ího typu algoritmu k~nejpomalej¹ímu. První typ, který splòuje v¹echny po¾adavky, je vybrán a pou¾it. Jeliko¾ se jedná o~tovární metodu, která nemù¾e zaruèi uvolnìní pamìti, je zde jako návratová hodnota pou¾it inteligentní ukazatel {\texttt{{boost::share\_ptr}}}.
\subsection{Inicializaèní fáze}
\label{sec050402}\hypertarget{sec050402}{}%

Pravidla, která jsou pøedána jako øetìzce, jsou v~této fázi konvertována do struktury {\texttt{{Rule}}}. Ke konverzi slou¾í trojice metod. Metoda {\texttt{{setAxiom()}}} jednodu¹e pøelo¾í øetìzec znakù na vnitøní formát slova a nastaví jej jako poèáteèní slovo typu {\texttt{{LongString}}} pro iteraèní proces.

Nezbytnou souèástí jsou metody pro pøidání pøepisovacích pravidel a homomorfismù. Struktura i funkce jsou u~{\texttt{{addRule()}}} a {\texttt{{addHomomorphism()}}} dosti podobné. Zpùsob zpracování je v~pøípadì pøedchùdce shodný. Li¹it se mù¾e zpracování následníka. Zpracování pravidel probíhá voláním jednotlivých funkcí struktury {\texttt{{Rule}}}, èím¾ se postupnì prochází øetìzec pravidla a instance struktury {\texttt{{Rule}}} je automaticky nastavována. Následující pseudokód ukazuje, jakým zpùsobem je zpracováno pravidlo parametrického stochastického 0L-systému.

\begin{Verbatim}[fontsize=\small]
pøidejPøepisovacíPravidlo( øetìzec zápisPravidla )
{
  Rule pravidlo;
  pravidlo.zpracujPøedchùdce( zápisPravidla );
  pravidlo.zpracujPodmínku( zápisPravidla );
 
  // metoda zpracujStatickýØetìzecNásledníka() vrací:
  //    - true - pokud po zpracování následník pokraèuje výrazem
  //    - false - pokud následník tímto statickým øetìzcem konèí 
  for( pravidlo.zpracujStatickýØetìzecNásledníka( zápisPravidla ))
  {
      pravidlo.zpracujVýrazVNásledníkovi( zápisPravidla );
  }      
  pravidlo.zpracujPravdìpodobnostníVýraz( zápisPravidla );
}
\end{Verbatim}

\subsection{Pøepisovací fáze}
\label{sec050403}\hypertarget{sec050403}{}%

Jednoznaènì nejdùle¾itìj¹í fází je samotný iteraèní proces. Probíhá v~krocích po jednotlivých iteracích. Zaèíná v¾dy s~poèáteèním slovem, axiomem, v~nìm¾ jsou pøi první iteraci v¹echny moduly nahrazeny dle pøepisovacích pravidel. Tento postup se opakuje pøi ka¾dé iteraci na novì vzniklých slovech. Celý proces pøepisu je zjednodu¹enì zobrazen v~následujícím pseudokódu.

\begin{Verbatim}[fontsize=\small]
LongString pùvodníSlovo;
LongString novéSlovo;
for( v¹echny moduly v pùvodníSlovo )
{
    najdi v¹echny pravidla, které mají aktuální modul jako pøedchùdce;
    if( existuje alespoò jedno takové)
    {
        if(vyber pravidlo)
        {
            novéSlovo.pøipoj( vygeneruj následníka modulu);
        }
        else
        {
            novéSlovo.pøipoj(pou¾ij pro daný modul pravidlo identity);
        }
    }
    else
    {
         novéSlovo.pøipoj(pou¾ij pro daný modul pravidlo identity);
    }
}
\end{Verbatim}

Prvotní prohledání pravidel vybere pouze ta, je¾ mají aktuální modul jako svého pøedchùdce. Takových pravidel mù¾e být hned nìkolik. Mohou se li¹it v~kontextu, podmínce nebo mohou být vybrány na základì pravdìpodobnosti. Výbìr jednoho pravidla z~této mno¾iny provádí metoda {\texttt{{selectRule()}}}, v~pseudokódu oznaèená jako \glqq vyber slovo\textquotedblleft{}. Právì toto je funkce, v~ní¾ se jednotlivé L-systémy mohou nejvíce li¹it a kde lze implementovat rùzné typy funkcionalit pro výbìr pravidla. Detaily výbìru pravidla u~jednotlivých typù L-systémù rozebírá kapitola \hyperlink{sec0505}{{\ref{sec0505}}}. Pokud ¾ádné z~pravidel nevyhovuje, pou¾ije se pravidlo identity, které pouze zkopíruje modul do novì vznikajícího slova. Vkládání do nového slova probíhá výhradnì pøipojováním na jeho konec.

% ------------------------   
% Section 
\section{Rozdìlení L-systémù}
\label{sec0505}\hypertarget{sec0505}{}%

Jak ji¾ bylo zmínìno v~kapitole \hyperlink{ch02}{{\ref{ch02}}} o~typech vìtvených struktur, je nutné pro modelování pokroèilej¹ích rostlinných organismù pou¾ít slo¾itìj¹í typy L-systémù. Zároveò v¹ak není kvùli optimalizaci vhodné pou¾ít stejné L-systémy pro generování jednoduchých struktur. Rùzné typy L-systémù mají navíc rùzné formy zápisù svých pøepisovacích pravidel. V~následující kapitole jsou popsány specifika implementace jednotlivých typù L-systémù a také formáty zápisù pravidel, je¾ tyto L-systémy zpracovávají. Jsou zde rozebrány pouze vlastnosti, které nebyly spoleèné a tak byly v~minulé kapitole \hyperlink{sec0504}{{\ref{sec0504}}} zmínìny jen okrajovì.
\subsection{D0L-systémy}
\label{sec050501}\hypertarget{sec050501}{}%

Nejjednodu¹¹ím L-systémem je tato varianta implementovaná tøídou {\texttt{{D0LSystem}}}. Jak ji¾ název napovídá, zpracovává pouze deterministické bezkontextové L-systémy. Pro øadu modelù je tento typ dostateèný. Navíc je díky své jednoduchosti nejrychlej¹í. Zápis pravidel je ukázán na následujícím vzorovém pøíkladu.

\begin{Verbatim}[fontsize=\small]
A->A+(10)FBF
\end{Verbatim}

Tento typ nepodporuje zpracování výrazù. Ka¾dý následník se skládá pouze z~jednoho øetìzce typu {\texttt{{StaticString}}}. Iteraèní proces je v~tomto pøípadì vcelku jednoduchý. V¾dy existuje maximálnì jedno pravidlo, jeho¾ pøedchùdce odpovídá právì zpracovávanému modulu pùvodního øetìzce. Toto pravidlo je také v¾dy vybráno a jeho následník je pou¾it pøi pøepisu.

Pøíklad stromu generovaného D0L-systémem je na obrázku \hyperlink{pic05050201}{{\ref{pic05050201}}} (a). Jedná se o~ternární strom, jen¾ se pøi ka¾dém vìtvení rozdìlí právì na tøi vìtve. Z~obrázku je velmi zjevná pravidelnost, která je hlavní nevýhodou D0L-systémù.
\subsection{Parametrické stochastické bezkontextové L-systémy}
\label{sec050502}\hypertarget{sec050502}{}%

Tento typ L-systému umo¾òuje zpracovat parametrické i stochastické L-systémy, èím¾ znaènì roz¹iøuje ¹kálu mo¾ností. Díky parametrùm lze vytvoøit i mezotonické a akrotonické struktury. Náhodnost pak dovoluje vytváøet jedince rostlinných organismù s~rozdílnou náhodnou strukturou, které v¹ak zároveò mají spoleèné rodové znaky. Implementace se nachází v~tøídì {\texttt{{ParStoch0LSystem}}}. Tato tøída zpracovává L-systémy ve tvaru, jak je popisuje kapitola \hyperlink{sec0205}{{\ref{sec0205}}}. Pøíkladem mohou být následující pravidla zapsaná ji¾ v~podobì, která je tímto L-systémem zpracovatelná.

\begin{Verbatim}[fontsize=\small]
A(x,y):(x>y)->A(x-1,y)FB(y/2)F:(x*y)
\end{Verbatim}

Jednotlivé èásti tohoto øetìzce mají následující význam. 
\begin{itemize}
%--- Item
\item 
{\em{A(x,y)}} oznaèuje pøedchùdce pravidla se dvìma parametry {\em{x}} a {\em{y}}. Tento údaj je povinný.

%--- Item
\item 
{\em{(x\textgreater{}y)}} je pøíklad podmínky. Pokud pravidlo podmínku neobsahuje, mù¾e být podmínka nahrazena symbolem {\em{*}}, který znaèí, ¾e je podmínka splnìna v¾dy.

%--- Item
\item 
Následník {\em{A(x-1,y)FB(y/2)F}} je rozdìlen a zpracován do struktury {\texttt{{Rule}}}.

%--- Item
\item 
(x*y) je pravdìpodobnostní faktor. Pokud se jedná o~deterministické pravidlo, lze tento výraz vynechat a ukonèit pravidlo posledním znakem následníka. V~takovém pøípadì je v¹ak nutné, aby ¾ádné z~pravidel s~tímto pøedchùdcem neobsahovalo pravdìpodobnostní faktor.

\end{itemize}
\noindent 

Výbìr konkrétního pravidla provádí pøetí¾ená virtuální metoda {\texttt{{selectRule()}}}, která na vstupu obdr¾í u¾ jen pravidla se shodujícím se pøedchùdcem. Tato pravidla je nutné dále protøídit. Pokud se nejedná o~stochastický L-systém, vybere se pravidlo, které splòuje svou podmínku. V~pøípadì stochastického L-systému je bì¾né, ¾e podmínku splòuje nìkolik pravidel. Zde je zapotøebí vyhodnotit jejich pravdìpodobnostní faktory a výsledky pak pøedat instanci pomocné tøídy {\texttt{{RandomIndex}}}. Ta na základì tìchto faktorù vybere náhodnì jedno z~pravidel, které je pak pou¾ito pro pøepis.

Ukázkou vlo¾ení parametrického prvku do modelu jsou obrázky \hyperlink{pic05050201}{{\ref{pic05050201}}} (b) a (c). Jedná se o~jednoduchý D0L-systém ternárního stromu, ve kterém je v¹ak pomocí jednoduchých parametrických pravidel dosa¾eno jevu, kdy listy rostou pouze na mlad¹ích vìtvích. Star¹í a tlust¹í vìtve jsou, dle subapikálních pravidel rùstu, bez listù. Listy na pùvodním D0L-systému lze vytvoøit pouze tak, ¾e jsou rovnomìrnì a pravidelnì rozprostøeny na v¹ech vìtvích.

Obrázek \hyperlink{pic05050201}{{\ref{pic05050201}}} (b) demonstruje pou¾ití pravdìpodobnostního faktoru. Výrazy pro jeho výpoèet byly zvoleny tak, ¾e s~rostoucí vdáleností od koøene klesá pravdìpodobnost dìlení vìtví. Je toho dosa¾eno pomocí dvou pravidel, z~nich¾ jedno obsahuje dìlení na dvì vìtve a druhé pouze krok vøed. Pøi prvních krocích je pravdìpodobnost rozdìlení témìø stoprocentní. Kolem tøetího kroku v¹ak prudce klesá a dále je naopak minimální. Podobných pravidel lze v~pøírodì nalézt celou øadu. Pomocí parametrických stochastických L-systémù je lze vcelku jednodu¹e nasimulovat.

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic05050201}{}%
\begin{center}

{{\includegraphics[]{05050201}}\hypertarget{id385055}{}%
\label{id385055}
}
{{\caption[{Bezkontextové L-systémy.}]{{{Bezkontextové L-systémy.}}}\label{pic05050201}}}
\end{center}
\end{figure}

\subsection{Parametrické stochastické kontextové L-systémy}
\label{sec050503}\hypertarget{sec050503}{}%

Aby byl zásuvný modul schopen zpracovávat dotazy a signály, obsahuje také tøídu pro zpracování kontextových L-systémù. Pou¾ití kontextu také znamená jiný zápis pravidel.

\begin{Verbatim}[fontsize=\small]
A(x,y) < B(z) > C(a,b,c):(z > abs(a-c))->B(b-1)FA(x/2,y/2):max(0,1-1/z*z)
\end{Verbatim}

Oproti bezkontextovým gramatikám se zde navíc zadává levý a pravý kontext. Jeho zadání lze vynechat, av¹ak znaménka \textless{} a \textgreater{} je nutné v~øetìzci pravidla zachovat. Zpracování podmínky i pravdìpodobnostního faktoru je zde obdobné jako u~bezkontextových L-systémù.

Nejdùle¾itìj¹ím roz¹íøením je schopnost ovìøovat kontext pøedchùdce. Ovìøování kontextu se øídí pravidly popsanými v~kapitole o~kontextových L-systémech \hyperlink{sec0204}{{\ref{sec0204}}}. Pro tuto èinnost byly implementovány metody {\texttt{{matchRight()}}} a {\texttt{{matchLeft()}}}. Jde o~metody tøídy {\texttt{{LongString}}} a vrací hodnotu {\texttt{{integer}}}, která informuje zda bylo ovìøování úspì¹né. V~pøípadì úspìchu tyto metody vrací pozici úspì¹nì ovìøeného modulu. Jinak vrací -1. Metody instance tøídy {\texttt{{LongString}}} tedy dostanou informace, jaký kontext a kde jej ovìøovat a poté samy vyhodnotí výsledek. Jak vyplývá z~vý¹e zmínìných pravidel, je potøeba u~L-systémù se závorkami provádìt nìkdy ovìøení na více místech zároveò. Jedná se napøíklad o~situaci symbolu vedle závorky nebo pokud je sousední symbol v~seznamu ignorovaných znakù. Ovìøovací metody tak uvnitø obsahují rekurzivní volání sebe sama, aby v¹echny tyto situace byly korektnì vyhodnoceny. Pokud dochází pøi ovìøování k~vìtvení, je vìt¹inou nutné naleznout v~øetìzci správná místa pro ovìøení kontextu tak, aby byla respektována skuteèná topologie modelu. K~tomuto úèelu slou¾í metody {\texttt{{findMatchingRightBracket()}}} a {\texttt{{findMatchingLeftBracket()}}}, které k~nalezené závorce najdou její protìj¹ek. Tímto umo¾ní ovìøovacímu mechanismu pokraèovat za závorkou. Pseudokód fungování metody {\texttt{{matchRight()}}} zjednodu¹enì ukazuje princip fungování této metody. U~metody {\texttt{{matchLeft()}}} je princip obdobný.

\begin{Verbatim}[fontsize=\small]
int matchRight( kontext,   /*symbol pravého kontextu*/
                pozice,    /*odkud hledat*/
                ignorovat  /*seznam ignorovaných znakù*/ )
{                                                              
  if ( slovo[pozice] == '[' )
    return matchRight( kontext, pozice + 1, ignorovat )  ||
           matchRight( kontext, findMatchingRightBracket(), ignorovat);
  else if ((slovo[pozice] == '[') || (ignorovat obsahuje slovo[pozice])
    return matchRight( kontext, pozice + 1, ignorovat );
  else if ( slovo[pozice] == kontext )
    return pozice;
  else
    return -1;
}
\end{Verbatim}

Levý i pravý kontext mù¾e stejnì jako pøedchùdce mít své parametry, které je nutné naèíst pro zpracování výrazù. Pozice modulù, získané jako návratové hodnoty bìhem ovìøování kontextù, slou¾í právì pro získání tìchto parametrù. Díky roz¹íøení o~zpracování kontextu mohl být do zásuvného modulu implementován také mechanismus pro zpracování dotazù. Podrobnìj¹ím popisem implementace dotazù se zabývá následující kapitola \hyperlink{sec0506}{{\ref{sec0506}}}.

Aplikaci dotazù i signálù pomocí kontextových L-systémù lze pozorovat na obrázcích \hyperlink{pic05050301}{{\ref{pic05050301}}}. Úèelem bylo vytvoøit modely, je¾ pomocí urèité funkce mohou reagovat na své okolí. Reakce v~tomto pøípadì spoèívá v~ukonèení rùstu a ¹íøení signálu o~pøeru¹ení zpìt smìrem ke koøenùm. Pokud se pøi ¹íøení signálu nalezne místo, kde je mo¾né vytvoøit vìtvení, vìtev se rozdìlí. Novì vytvoøená vìtev pak pokraèuje v~rùstu. Lze takto simulovat jev, který se obdobnì vyskytuje i v~pøírodì. Pokud je toti¾ z~nìjakého dùvodu zamezeno vìtvi dále rùst, aktivuje se pupen na cestì ke koøenùm. Zmínìné obrázky ukazují dva zpùsoby pou¾ití tohoto jevu. V~pøípadì obrázkù (a) a (b) se jedná o~simulaci zastøihování ¾ivého plotu. Jakmile vìtev opustí vymezený prostor, je zastøi¾ena a rùst pokraèuje jinde. Obdobnì funguje i druhý model na obrázcích (c) a (d). Zde je tímto mechanismem znemo¾nìno prorùstání stromu do zdi.

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic05050301}{}%
\begin{center}

{{\includegraphics[]{05050301}}\hypertarget{id385167}{}%
\label{id385167}
}
{{\caption[{Stochastické parametrické 2L-systémy.}]{{{Stochastické parametrické 2L-systémy.}}}\label{pic05050301}}}
\end{center}
\end{figure}

% ------------------------   
% Section 
\section{Dotazy}
\label{sec0506}\hypertarget{sec0506}{}%

Díky dotazùm lze ji¾ bìhem generování zjistit, kde a v~jaké poloze se bude daný modul nacházet v~prostoru. Roz¹iøitelnost knihovny {\texttt{{FunctionParser}}} umo¾òuje do výrazù vkládat funkce, které pak mohou vrátit kterýkoli parametr polohy ¾elvy. Toto pøipojení u¾ivatelsky definovaných funkcí je provádìno pouze do výrazù, které tyto funkce obsahují. Je to z~dùvodu, ¾e výrazy, které tyto funkce obsahují, nemohou být optimalizovány vnitøními algoritmy knihovny {\texttt{{FunctionParser}}}. Tyto dotazovací funkce jsou ve skuteènosti statickými metodami tøídy {\texttt{{Query}}}. Ka¾dá tato metoda je bezparametrická a vrací hodnotu {\texttt{{double}}}. Pro ka¾dou souøadnici ka¾dého vektoru polohové matice ¾elvy existuje jedna metoda.

Tøída {\texttt{{Query}}} slou¾í jako adaptér mezi tøídami {\texttt{{FunctionParser}}} a {\texttt{{QueryInterpret}}}. Tøída {\texttt{{QueryInterpret}}} je speciálnì uzpùsobený interpret pro zpracování dotazù. Jeho fungování je podobné jako u~tøídy pro interpretaci geometrie, je¾ bude popsána v~kapitole \hyperlink{sec0602}{{\ref{sec0602}}}. Na rozdíl od ní v¹ak nevytváøí ¾ádnou geometrii a interpretuje jen symboly, které jsou dùle¾ité pro polohu ¾elvy. Je implementován dle návrhového vzoru {\em{jedináèek}}.

Na základì volání nìkteré z~metod tøídy {\texttt{{Query}}} pak dostane pokyn k~interpretaci slova. Interpretována je v¾dy jen ta èást slova, která pøedcházela právì zpracovávanému modulu s~dotazy. Nakonci interpretace je poloha ¾elvy ulo¾ena a pøipravena pro dotazovací metody. Celá tato operace získání polohy je zaji¹»ována vnitøní metodou {\texttt{{update()}}}. Problémem je, ¾e hodnoty polohy ¾elvy velice rychle stárnou a jejich obnovení je kvùli nutnosti interpretace øetìzce èasovì nároèná procedura. Pro omezení volání metody {\texttt{{update()}}} je implementován jednoduchý algoritmus. Pokud je nìkterá souøadnice pøeètena podruhé, pøedpokládá se, ¾e se jedná o~jiný modul a je tedy tøeba provést obnovu. Na obrázku \hyperlink{pic050601}{{\ref{pic050601}}} lze vidìt, jakým zpùsobem vypadá pravidlo s~dotazy a jak se jednotlivé dotazy pomocí instance tøídy {\texttt{{QueryInterpret}}} vyhodnocují. U~dotazù, které si vynutí provedení interpretace slova je spolu s~dùvodem uvedena metoda {\texttt{{update()}}}. Ostatní dotazy obdr¾í odpovìï okam¾itì.

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic050601}{}%
\begin{center}

{{\includegraphics[]{050601}}\hypertarget{id385274}{}%
\label{id385274}
}
{{\caption[{Zpracování dotazù tøídou {\texttt{{QueryInterpret}}}}]{{{Zpracování dotazù tøídou {\texttt{{QueryInterpret}}}}}}\label{pic050601}}}
\end{center}
\end{figure}

Instance tøídy {\texttt{{QueryInterpret}}} tedy pøi prvním volání dotazu {\texttt{{positionX()}}} zjistí v¹echny souøadnice polohy ¾elvy. Poté je mo¾né vracet jednotlivé souøadnice polohy. Jakmile se jeden z~dotazù zopakuje, provede se obnova polohy ¾elvy a tedy i nová interpretace slova. Stejným zpùsobem reaguje interpret na dotazy týkající se aktuálních smìrových vektorù ¾elvy.

Zpracováním dotazù lze tedy do øetìzce slova dostat pozièní hodnoty je¹tì pøed vykreslovací fází. Kombinací s~kontextovými pravidly s~podmínkou lze dosáhnout toho, ¾e nìkterá pravidla budou pou¾ita jen pøi urèitých hodnotách tìchto dotazù. Druhou mo¾ností je vyu¾ít tyto hodnoty ke zmìnì parametrù modulù. Napøíklad v~pøípadì popínavých rostlin lze na základì polohy a smìru rostoucí vìtve vyhodnotit, kterým smìrem by se mìla daná vìtev vyvíjet a podle toho pak ovlivnit její smìr.

% ------------------------   
% Section 
\section{Podøízené L-systémy}
\label{sec0507}\hypertarget{sec0507}{}%

Problematiku návrhu modelu pomocí L-systémù lze rozdìlit na nìkolik úrovní. Pro lep¹í kontrolu, pøehlednost a také nastavitelnost je lep¹í jednotlivé dílèí celky hierarchicky seøadit. U~botanických organismù se mù¾e jednat napøíklad o~rozdìlení na rostlinné orgány. Jde v¹ak samozøejmì jít i hloubìji. Výhodou tohoto pøístupu je modularita. Ka¾dý takovýto dílèí L-systém má svá vlastní nastavení a mù¾e být pou¾it v~libovolném poètu jiných L-systémù. Pokud je tedy napøíklad vytvoøen L-systém pro list, je velice jednoduché pøidat jej jako podsystém ke v¹em L-systémùm stromù stejného druhu.

Ka¾dý L-systém si své podsystémy spravuje sám. Po jejich naètení pomocí metod tøídy {\texttt{{AbstractFile}}} je ka¾dý L-systém inicializován a zpracován podobnì jako ve tøídì {\texttt{{LSystemGenerator}}}. Ka¾dému podsystému je pøiøazeno unikátní èíslo. Pod ním je tento systém reprezentován v~øetìzci pomocí modulu {\texttt{{\#(L-System\_ID)}}}. V¹echna slova jsou vygenerována a ulo¾ena v~nadøazeném L-systému. Do øetìzce jsou vlo¾ena a¾ po ukonèení iteraèního procesu, kdy jsou v¹echny moduly {\texttt{{\#()}}} nahrazeny vygenerovanými slovy. Na zaèátku a konci ka¾dého slova podsystému jsou speciální moduly {\texttt{{\$}}}, je¾ poté informují interpret o~zmìnì L-systému. Ten pak dle parametrù tohoto modulu pøepne na zpracování øetìzce dle odpovídajících nových parametrù. Nebo» je toto chování dosti podobné zpracování závorek, vìnuje se jim spoleèná kapitola o~implementaci zásobníku \hyperlink{sec060201}{{\ref{sec060201}}}.

% -------------------------------------------------------------
% Chapter Interpretace slov 
% ------------------------------------------------------------- 	
\chapter{Interpretace slov}
\label{ch06}\hypertarget{ch06}{}%

Pøedchozí kapitola se vìnovala výhradnì iteraènímu procesu L-systémù za úèelem vytvoøení slova, je¾ bude reprezentovat po¾adovaný model. V~této kapitole budou podrobnìji rozvedeny techniky, které takto vygenerované slovo interpretují a vytváøí jeho geometrickou podobu. Pro interpretaci byla zvolena vý¹e zmínìná technika ¾elví grafiky. Jednotlivé moduly pak slou¾í jako pøíkazy ¾elvì k~rùzným úkonùm. Díky abstrakci na úrovni modulù lze vybírat z~rùzných technik, kterými ¾elva kreslí, a tak vytváøet rozmanitìj¹í modely.

Kromì samotné geometrie je nutné øe¹it i jiné otázky týkající se zobrazení modelu. Jedná se zejména o~mapování textur a o~úroveò detailù. Na této vrstvì je také mo¾né pøidat i rùzné vlivy okolí. Jeliko¾ se jedná pouze o~interpretaci, tyto vlivy nijak nemohou ovlivnit strukturu výsledného modelu. Mohou v¹ak globálnì ovlivnit celý model. Lze tak jednodu¹e pøidat modelu závislost na nìkterých silách jako je gravitace. Jinou mo¾ností je pøiblí¾ení rostlin svým reálným pøedlohám pomocí malé náhodnosti úhlù. Modely tak ztratí svou viditelnou matematickou pøesnost.

Jako rozhraní pro interpretaci slov slou¾í abstraktní tøída {\texttt{{AbstractInterpret}}}. Implementováni jsou dva potomci. {\texttt{{TurtleInterpret}}} zpracovává vì¹keré pøíkazy ¾elvy a slou¾í k~vytváøení geometrie. {\texttt{{QueryInterpret}}} provádí zpracování dotazù ohlednì polohy ¾elvy. Tento interpret zpracovává jen vybrané pøíkazy. Podrobnìji byl popsán v~kapitole \hyperlink{sec0506}{{\ref{sec0506}}}.

Øetìzec generovaný L-systémem je pøetypován na nový typ. Z~instance tøídy {\texttt{{LongString}}} je pøeveden na instanci tøídy {\texttt{{ParseableString}}}. Jedná se o~jednoduchou tøídu, která obsahuje metody pro dopøedné procházení øetìzce a získávání modulù a jejich parametrù.

% ------------------------   
% Section 
\section{Spojení s~grafem scény}
\label{sec0601}\hypertarget{sec0601}{}%

Pro zobrazení generované geometrie je dùle¾ité napojení na graf scény. Pøi vytváøení interpretu je mu konstruktorem pøedán ukazatel na rodièe v~grafu. Vzhledem k~tomu, ¾e slovo mù¾e díky mechanismu podsystémù obsahovat øetìzce nìkolika L-systémù mající rùzné parametry, je nutné i pøi vytváøení geometrie tyto L-systémy oddìlit. Díky grafu scény je k~dispozici ideální øe¹ení. Pro ka¾dý L-systém vytvoøí interpret jeden uzel s~geometrií, je¾ bude obsahovat i svá nastavení. Tyto uzly jsou instancemi tøídy {\texttt{{LSGeode}}}. Tato tøída je roz¹íøením tøídy {\texttt{{osg::Geode}}}. Navíc obsahuje metody pro volbu správného typu ¾elvy a také metody pro pøedání výchozích hodnot nastavení ¾elvy. V¹echny tyto hodnoty jsou získány z~parametrù, je¾ se naèítají pøi zpracování souborù L-systémù potomky tøídy {\texttt{{AbstractFile}}}.

Pøi inicializaci instance {\texttt{{LSGeode}}} dochází také k~nastavení uzlu. Nastaví se textura, materiály a dal¹í vlastnosti. Ve¹keré parametry jsou zpracovány a konvertovány do takové podoby, aby pøi generování byly buï ji¾ nastaveny nebo rychle pøipraveny ke zpracování.

% ------------------------   
% Section 
\section{Interpretace pomocí ¾elví grafiky}
\label{sec0602}\hypertarget{sec0602}{}%

Úkolem interpretu je projít celé slovo typu {\texttt{{ParseableString}}} a moduly, které rozpozná, pøevést na pøíkazy. Pro tento pøevod slou¾í metoda {\texttt{{parse()}}}. Ka¾dá tøída interpretu obsahuje v~této metodì svou sadu pøíkazù, které umí interpretovat. Následnì pak volá metody pro manipulaci s~¾elvami na zásobníku nebo nastavuje a kreslí ¾elvou, která je na vrcholu zásobníku.
\subsection{Zásobník pro ukládání ¾elvích instancí}
\label{sec060201}\hypertarget{sec060201}{}%

Pro zpracování slov, které obsahují závorky a podøízené L-systémy, je nutná dobrá implementace zásobníku pro ¾elvy. K~tomuto úèelu slou¾í tøída {\texttt{{TurtleStack}}}, která poskytuje standardní funkce zásobníku. Je v¹ak uzpùsobena pro pou¾ití v~tomto zásuvném modulu. Pøi interpretaci se pracuje v¾dy pouze se ¾elvou, která je aktuálnì na vrcholu zásobníku. Existují proto speciální moduly, je¾ doká¾í s~obsahem zásobníku manipulovat.

\begin{description}
% \null and \mbox are tricks to induce different typesetting decisions
\item[{[}]\null{}
Tato závorka oznaèuje poèátek nové vedlej¹í vìtve. V~tomto stavu je nutné vytvoøit metodou {\texttt{{push()}}} na zásobníku novou ¾elvu, která se vykreslováním této vìtve bude zabývat. Parametry i typ si tato ¾elva nastaví podle dosavadní ¾elvy na vrcholu zásobníku.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{]}]\null{}
Ukonèení vedlej¹í vìtve je signalizováno tímto symbolem. ®elva je z~vrcholu zásobníku odstranìna a dal¹í geometrii generuje ¾elva pod ní. V~rùstu tedy pokraèuje hlavní vìtev.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{\$(x)}]\null{}
Jednotlivé L-systémy mají ji¾ od svého naètení pøiøazen jednoznaèný identifikátor. Symbol dolaru s~jedním parametrem oznamuje interpretu, ¾e má dojít ke zmìnì L-systému. Podle identifikátoru v~parametru modulu je vybrán správný L-systém a jeho odpovídající uzel s~geometrií {\texttt{{LSGeode}}}. Ten u¾ poté ví, který typ ¾elvy pou¾ít a jaké výchozí parametry jí nastavit. Nìkteré parametry, jako je matice polohy, mohou být nastaveny podle dosavadní ¾elvy na vrcholu zásobníku. S~novì vytvoøenou ¾elvou se pak na zásobníku provede operace {\texttt{{push()}}}.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{\$}]\null{}
Ukonèení slova podsystému signalizuje symbol dolaru bez parametru. Z~vrcholu zásobníku je odstranìna ¾elva a ve vykreslování pokraèuje ¾elva nadøazeného L-systému.
\end{description}
\noindent 
\subsection{®elví rozhraní}
\label{sec060202}\hypertarget{sec060202}{}%

Pro vìt¹í modularitu byl pøi návrhu zvolen model, jen¾ umo¾òuje pou¾ití libovolného mno¾ství typù ¾elv. Lze tedy generovat rùznou geometrii pomocí stejných pøíkazù. V¹echny tøídy ¾elv dìdí z~abstraktní tøídy {\texttt{{AbstractTurtle}}}. Tato tøída obsahuje rozhraní pro úplnou kontrolu ¾elvy. Vìt¹inu tvoøí metody pro zpracování pøíkazù, které se ve slovech vyskytují jako moduly. Kromì toho obsahuje metody k~propojení s~uzlem geometrie. Do nìj pak pøímo ukládá ve¹kerou geometrii. K~propojení dochází pøi vkládání ¾elvy na vrchol zásobníku. Je zde k~dispozici i nìkolik metod pro vykreslování pomocné geometrie pøi ladìní.

Ka¾dá ¾elva má celou øadu parametrù, je¾ se mohou bìhem vykreslování neustále mìnit. Proto obsahuje strukturu {\texttt{{TurtleProperties}}}, která v¹echny tyto hodnoty uchovává. Parametry si ¾elvy mezi sebou pøedávají pøi operacích na zásobníku. Pokud se jedná o~první ¾elvu L-systému, nahrají se výchozí parametry z~instance tøídy {\texttt{{LSGeode}}}.
\subsection{®elví pøíkazy}
\label{sec060203}\hypertarget{sec060203}{}%

Ka¾dá ¾elva interpretuje celou øadu pøíkazù. Ne v¹echny ¾elvy musí nutnì implementovat v¹echny pøíkazy. Nìkteré mohou být úzce specializované. Obecnì lze pøíkazy rozdìlit do nìkolika kategorií.

\begin{itemize}
%--- Item
\item 
{\em{Základní pohybové pøíkazy}} --- Vìt¹ina ¾elv má implementovány základní pøíkazy pro pohyb. Metody pro pohyb jsou spoleèné a nachází se v~abstraktní tøídì {\texttt{{MovingTurtle}}}. Umo¾òují napøíklad pohyb ¾elvy dopøedu a natáèení kolem v¹ech os. ®elva se mù¾e pohybovat i bez generování geometrie pouze za úèelem pøemístìní se.

%--- Item
\item 
{\em{Pokroèilé pohybové pøíkazy}} --- Jedná se o~nestandardní pohyby ¾elvy, jako je otoèení do protismìru nebo vyrovnání náklonu do vodorovné polohy.

%--- Item
\item 
{\em{Zmìna stavových promìnných}} --- Øadu parametrù ¾elvy lze bìhem interpretace mìnit. Je tak mo¾né napøíklad prodlou¾it délku kroku nebo mìnit výchozí úhel rotace.

%--- Item
\item 
{\em{Nastavení vnìj¹ích vlivù}} --- Nìkteré pøíkazy mohou ovlivnit reakci ¾elvy na globální vnìj¹í vlivy. V~pøípadì gravitace se mù¾e napøíklad jednat o~zmìnu pru¾nosti vìtve.

\end{itemize}
\noindent 

% ------------------------   
% Section 
\section{Generování geometrie}
\label{sec0603}\hypertarget{sec0603}{}%

Z~definice ¾elvy vyplývá, ¾e ke kreslení dochází pouze pøi jediném typu pøíkazu. Jedná se o~krok vpøed. V~pøípadì trojrozmìrné implementace v~zásuvném modulu LSystem dochází pøi interpretaci tohoto pøíkazu ke generování geometrie. Implementaènì se jedná o~metodu {\texttt{{drawStep()}}} deklarovanou ve tøídì {\texttt{{AbstractTurtle}}}. Její konkrétní definice zále¾í na typu ¾elvy. Mù¾e se jednat o~planární i trojrozmìrné objekty, nahrané modely a jiné. Ve¹kerá geometrie se ukládá do jedné èi více instancí tøídy {\texttt{{osg::Geometry}}}, která slou¾í jako úlo¾i¹tì ve¹keré geometrie instance tøídy {\texttt{{LSGeode}}}. Ka¾dá ¾elva má ulo¾en ukazatel na tyto kontejnery s~geometrií. Díky tomuto propojení uzlù geometrie s~¾elvami na zásobníku je pak geometrie vykreslena dle parametrù jednotlivých L-systémù.
\subsection{Válce s~klouby}
\label{sec060301}\hypertarget{sec060301}{}%

Jedná se o~jednoduché vykreslování grafiky, je¾ simuluje ¾elvou kreslenou èáru. Pro ka¾dý krok se vygeneruje právì jeden válec o~pøeddefinovaném polomìru a délce jednoho kroku. Umístìn je tak, aby pøímka procházející støedem obou jeho podstav byla toto¾ná s~pøímkou která prochází krajními body kroku ¾elvy. Proto¾e by pøi rotaci mezi jednotlivými kroky docházelo k~nespojitostem v~geometrii, umis»ují se na podstavy válcù koule, které plní funkci kloubu. Pøi shodném polomìru s~válci nespojitosti vyplní. Pro optimalizaci je pøi implementaci pou¾ita pouze polokoule. Lze také nastavit detail jednotlivých tìles pomocí parametru {\texttt{{ContourDetail}}}.

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic06030101}{}%
\begin{center}

{{\includegraphics[]{06030101}}\hypertarget{id385673}{}%
\label{id385673}
}
{{\caption[{Generování válcù s~klouby.}]{{{Generování válcù s~klouby.}}}\label{pic06030101}}}
\end{center}
\end{figure}

\subsection{Spojité válce}
\label{sec060302}\hypertarget{sec060302}{}%

®elvy tohoto typu generují, podobnì jako pøedchozí typ geometrii, slo¾enou z~válcù. Díky odli¹nému pøístupu v¹ak zde nedochází k~nespojitostem geometrie pøi rotacích ¾elvy mezi jednotlivými kroky. Ka¾dý krok je zde rozdìlen na dva pùlkroky. Po provedení prvního pùlkroku je pozice ¾elvy ulo¾ena jako kontrolní bod a je pou¾ita jako bod pro generování kontury, která tvoøí horní podstavu pøede¹lé válcovité geometrie a zároveò spodní podstavu geometrie kroku, který bude pøípadnì následovat. Rovina kontury je v¾dy kolmá na smìr pohybu ¾elvy.

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic06030201}{}%
\begin{center}

{{\includegraphics[]{06030201}}\hypertarget{id385710}{}%
\label{id385710}
}
{{\caption[{Generování spojité válcovité geometrie.}]{{{Generování spojité válcovité geometrie.}}}\label{pic06030201}}}
\end{center}
\end{figure}

Geometrie v~tomto pøípadì tedy pøesnì nekopíruje trasu ¾elvy. Generuje v¹ak vizuálnì mnohem lep¹í výsledek ne¾ v~pøípadì válcù s~klouby a navíc kvùli absenci polokoulí obsahuje men¹í mno¾ství trojúhelníkù. V~tomto pøípadì lze také mnohem lépe vyøe¹it navazování textur.
\subsection{Obdélníky}
\label{sec060303}\hypertarget{sec060303}{}%

Pøedchozí dva typy ¾elv jsou vhodné pro tvorbu stonkù a kmenù. Pro modely stromù je implementována tato tøída pro tvorbu listù. Stromy obsahují velké mno¾ství tvarovì málo rozmanitých listù. Právì pro tento úèel je vhodná ¾elva typu {\texttt{{Rectangle}}}. Pøi kroku vpøed vytváøí v¾dy pouze obdélník. Tento obdélník je pak vhodný pro naná¹ení textury, je¾ díky prùhlednosti list jednodu¹e a tvarovì pøesnì vykreslí. Velikost obdélníku se øídí bì¾nými parametry ¾elvy. Jde o~délku kroku a tlou¹»ku èáry.

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic06030301}{}%
\begin{center}

{{\includegraphics[]{06030301}}\hypertarget{id385754}{}%
\label{id385754}
}
{{\caption[{Generování geometrie pro listy.}]{{{Generování geometrie pro listy.}}}\label{pic06030301}}}
\end{center}
\end{figure}

Listy stromù je vhodné vytvoøit pomocí samostatného podøízeného L-systému. Pokud je pro interpretaci slov listù pou¾ita tato ¾elva, nemusí být L-systém, jen¾ toto slovo generuje, nijak slo¾itý. Vìt¹inou postaèí jeden krok kupøedu spoleènì s~pøípadnými rotacemi.

% ------------------------   
% Section 
\section{Textury}
\label{sec0604}\hypertarget{sec0604}{}%

Pro reálné zobrazení rostlinných organismù je dùle¾ité naná¹ení textur. U~generované geometrie je tedy potøebné dbát na správné generování souøadnic textury. Zásuvný modul LSystem umo¾òuje naná¹ení difuzních textur na navazující válcovité a jednoduché planární objekty. Je tedy mo¾né pou¾ít texturu jak pro geometrii vìtví, tak pro geometrii listù.
\subsection{Mapování textur na navazující válce}
\label{sec060401}\hypertarget{sec060401}{}%

Na geometrie vìtví se obvykle naná¹ejí textury kùry nebo stonku, které jsou vytvoøeny tak, aby pøi jejich skládání nebyly viditelné okraje textur. Z~dùvodu válcovitého tvaru se generování texturových souøadnic v¾dy øídí podle obvodu podstav válce. Aby textury správnì navazovaly, je nutné, aby se po obvodu opakovaly v~celoèíselných násobcích. Tento násobek je mo¾né nastavit parametrem {\texttt{{TextureSRepeatings}}}, který nastavuje, kolikrát se bude textura podél obvodu opakovat.

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic06040101}{}%
\begin{center}

{{\includegraphics[]{06040101}}\hypertarget{id385812}{}%
\label{id385812}
}
{{\caption[{Mapování textury na válce}]{{{Mapování textury na válce}}}\label{pic06040101}}}
\end{center}
\end{figure}

Smìr podél obvodu odpovídá texturové souøadnici {\em{s}}. Smìr pohybu ¾elvy kupøedu pak urèuje smìr texturové souøadnice {\em{t}}. Tato souøadnice se v¾dy pøizpùsobuje obvodu vìtve tak, aby byl pøibli¾nì zachován pomìr stran a textura tak pùsobila pøirozenì. Opakování textury v~tomto podélném smìru tedy nemusí být celoèíselné a hodnota souøadnice z~konce jednoho válcovitého dílu se pøená¹í dále jako poèáteèní hodnota pro dal¹í krok. Pøená¹í se v¹ak pouze desetinná èást, nebo» pouze ta je dùle¾itá pro korektní navázání textury. Podobný princip naná¹ení textury lze nalézt i v~práci \docbooktolatexcite{Mech97}{}. Implementace v~tomto zásuvném modulu navíc umo¾òuje opakování ve smìru {\em{s}}. Zpùsob a pøíklad generování texturových souøadnic je znázornìn na obrázku \hyperlink{pic06040101}{{\ref{pic06040101}}}. Celý válec pøedstavuje jeden krok ¾elvy. Kolem obvodu se zde textura opakuje dvakrát. Podélná textura je pak adekvátnì pøizpùsobena.
\subsection{Mapování textur na obdélníky}
\label{sec060402}\hypertarget{sec060402}{}%

Pro naná¹ení textury na objekty listù je pou¾ita jednoduchá metoda mapování. Jeliko¾ je ka¾dý list reprezentován jedním obdélníkem, jeho krajní body odpovídají krajním bodùm textury. Tvaru listu je dosa¾eno pomocí prùhlednosti textury. Díky tomu je zapotøebí mnohem ménì geometrie. Toto øe¹ení v¹ak s~sebou nese jedno úskalí. {\em{OpenSceneGraph}} obsahuje pro správné zobrazení prùhledných objektù speciální ko¹. Pøi vykreslování postupnì vybírá z~ko¹e jednotlivé objekty typu {\texttt{{osg::Geometry}}} seøazené podle vzdálenosti od pozorovatele odzadu dopøedu. Díky tomu jsou i prùhledné objekty vykresleny korektnì. Kvùli optimalizaci je v¹ak vhodné mít v¹echny objekty listù v~jedné geometrii, co¾ v¹ak mù¾e mít za následek ¹patné seøazení objektù. Tato optimalizace tak mù¾e nìkdy zpùsobovat na okrajích listù {\em{halo}} efekt. Pro odstranìní tohoto efektu je mo¾né nastavit parametr {\texttt{{SeparateGeometryForTranslucent}}}, který vynutí pou¾ití oddìlených geometrií pro ka¾dý objekt listu. Listy jsou v~tomto módu korektnì seøazeny. Vzhledem k~velkému poètu instancí tøídy {\texttt{{osg::Geometry}}} v¹ak dochází ke sní¾ení výkonu.

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic06040201}{}%
\begin{center}

{{\includegraphics[]{06040201}}\hypertarget{id385889}{}%
\label{id385889}
}
{{\caption[{Ukázka mapování textur listù.}]{{{Ukázka mapování textur listù.}}}\label{pic06040201}}}
\end{center}
\end{figure}

% ------------------------   
% Section 
\section{Minimalizace pøíèného náklonu}
\label{sec0605}\hypertarget{sec0605}{}%

Interpretace ¾elví grafikou je bezesporu jednou z~velmi univerzálních metod pro interpretaci L-systémù. Pøiná¹í v¹ak s~sebou i mo¾né nevýhody. Jednou z~nich je deformace válcù pøi provádìní rotace kolem osy \ensuremath{\vec{H}}. V~ka¾dém kroku ¾elva generuje body válcovité geometrie podle své kontury a øídí se svou aktuální orientací. Poloha bodù závisí na orientaci vektoru \ensuremath{\vec{L}}. Pokud v~jednom kroku dojde k~pøíènému náklonu o~pøíli¹ velký úhel, mù¾e dojít k~deformaci geometrie.

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic060502}{}%
\begin{center}

{{\includegraphics[]{060502}}\hypertarget{id385947}{}%
\label{id385947}
}
{{\caption[{Porovnání vzhledu geometrie bez (a) a s~(b) pou¾itím minimalizace pøíèného náklonu pøi interpretaci øetìzce {\texttt{{F/F/F/F/F/F}}}.}]{{{Porovnání vzhledu geometrie bez (a) a s~(b) pou¾itím minimalizace pøíèného náklonu pøi interpretaci øetìzce {\texttt{{F/F/F/F/F/F}}}.}}}\label{pic060502}}}
\end{center}
\end{figure}

Nìkdy mù¾e být tento efekt ¾ádoucí, vìt¹inou je ale lep¹í jej odstranit. Øe¹ením mù¾e být jeden z~nìkolika algoritmù pro minimalizaci pøíèného náklonu. Pro zásuvný modul {\em{LSystem}} byla zvolena Bloomenthalova metoda minimalizace rotace, kterou Bloomethal obdobnì pou¾il pøi generování svého modelu {\em{Mohutný javor}}. Kromì polohové matice ¾elvy se zavádí navíc matice kontury. Tato matice pak slou¾í ke generování bodù kontury a vytvoøení válcovité geometrie, která nepodléhá pøíènému náklonu. Je vytvoøena na základì ortogonální báze vektorového prostoru \ensuremath{( \vec{H} , \vec{V} , \vec{H} \times \vec{V} )}, kde \ensuremath{\vec{H}} je smìrový vektor ¾elvy a \ensuremath{\vec{V}} je vektor, podle nìho¾ se bude generovat geometrie. Tento vektor je pøed interpretací slova nastaven jako shodný s~vektorem \ensuremath{\vec{L}}.

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic060501}{}%
\begin{center}

{{\includegraphics[]{060501}}\hypertarget{id386017}{}%
\label{id386017}
}
{{\caption[{Princip minimalize pøíèného náklonu u~dvou následujících bází polohy ¾elvy.}]{{{Princip minimalize pøíèného náklonu u~dvou následujících bází polohy ¾elvy.}}}\label{pic060501}}}
\end{center}
\end{figure}

Pøi ka¾dém kroku ¾elvy kupøedu jsou v~metodì {\texttt{{adjustMatrices()}}} upraveny hodnoty vektorù. Pokud oznaèíme \ensuremath{\vec{H_1}} jako smìrový vektor ¾elvy pùvodní báze a \ensuremath{\vec{H_2}} oznaèíme smìrový vektor ¾elvy po vykonaném kroku vpøed, mù¾eme novou bázi získat otoèením pùvodní ortogonální báze kolem osy \ensuremath{\vec{H_1} \times \vec{H_2}} o~úhel, který svírají vektory \ensuremath{\vec{H_1}} a \ensuremath{\vec{H_2}}. Vektor \ensuremath{\vec{V}} pak bude v¾dy ve stejné rovinì s~vektorem \ensuremath{\vec{L}}. Na rozdíl od nìj v¹ak \ensuremath{\vec{V}} nebude podléhat pøíènému náklonu.

% ------------------------   
% Section 
\section{Odezva na smìrové podnìty}
\label{sec0606}\hypertarget{sec0606}{}%

Rostlinné organismy v~pøírodì reagují na celou øadu podnìtù. Nìkteré podnìty, jako je gravitace, mohou mít na vzhled rostliny zásadní vliv a implementací reakce na tyto podnìty lze modely podstatnì pøiblí¾it realitì. Pro smìrové podnìty se pou¾ívá termín {\em{tropismus}}. Jedná se o~zmìnu orientace rostlinného organismu na základì nìjakého podnìtu èi podrá¾dìní \docbooktolatexcite{Bell08}{}. Tento podnìt je v~pøípadì tropismu veden v¾dy v~nìjakém smìru. V~pøírodì existuje mnoho druhù tropismu. Nìkteré z~nich jsou velmi dùle¾ité i zajímavé pro simulaci.

\begin{description}
% \null and \mbox are tricks to induce different typesetting decisions
\item[{Geotropismus/Gravitropismus}]\null{}
V~rámci simulace biomechanických jevù se jedná o~nejdùle¾itìj¹í formu tropismu. Geotropismus je reakce rostlinného organismu na gravitaci. Pøíkladem mù¾e být smìøování vìtví pod svou tíhou k~zemi nebo naopak rùst stonku proti gravitaci.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{Fototropismus}]\null{}
Dal¹ím èasto simulovaným jevem je reakce na svìtelné podmínky, kdy se orgány rostlin orientují smìrem k~nejvìt¹ímu zdroji svìtla. Obdobnou formou je pohyb za sluncem nazývaný heliotropismus.
\end{description}
\noindent 
Pøi aplikaci tìchto vlivù na ¾elvu, dochází pøi ka¾dém kroku ¾elvy ke korekci jejího smìru tak, aby respektovala síly, které na ní pùsobí.
\subsection{Geotropismus}
\label{sec060601}\hypertarget{sec060601}{}%

Pro implementaci tropismu byla pou¾ita metoda zalo¾ená na výpoètu zrychlení momentu síly. Lze tak vypoèítat úhel, o~který je tøeba otoèit smìrový vektor ¾elvy \ensuremath{\vec{H}} smìrem k~vektoru podnìtu \ensuremath{\vec{T}}.

\begin{dbequation}
\begin{center}
\hypertarget{id386187}{}%
\ensuremath{\beta = e  \vert \vec{H} \times \vec{T} \vert }{{\caption{Výpoèet korekèního úhlu pøi geotropismu.}\label{id386187}}}
\end{center}
\end{dbequation}

Dùle¾itou roli zde hraje parametr \ensuremath{e}, který udává pøizpùsobivost danému podnìtu. Napøíklad u~vìtví tento parametr udává jejich pru¾nost. V~zásuvném modulu je geotropismus implementován oddìlenì od ostatních tropismù, nebo» se jedná o~velmi dùle¾itý podnìt. Úhel podnìtu smìøuje v¾dy smìrem k~zemi (proti smìrovému vektoru \ensuremath{\vec{H}} na poèátku interpretace). Nastavení se provádí pomocí parametru {\texttt{{GeotropismElasticity}}}.

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic06060101}{}%
\begin{center}

{{\includegraphics[]{06060101}}\hypertarget{id386265}{}%
\label{id386265}
}
{{\caption[{Ukázka vlivu geotropismu na ternární strom. Pøi generování stromù na obrázcích {\texttt{{a}}}, {\texttt{{b}}}, {\texttt{{c}}} a {\texttt{{d}}} byly pou¾ity hodnoty pru¾nosti 0.0, 0.1, 0.2 a 0.3.}]{{{Ukázka vlivu geotropismu na ternární strom. Pøi generování stromù na obrázcích {\texttt{{a}}}, {\texttt{{b}}}, {\texttt{{c}}} a {\texttt{{d}}} byly pou¾ity hodnoty pru¾nosti 0.0, 0.1, 0.2 a 0.3.}}}\label{pic06060101}}}
\end{center}
\end{figure}

Pøi ka¾dém kroku ¾elvy je metodou {\texttt{{adjustMatrices()}}} vypoèten pomocí vý¹e zmiòovaného vzorce nový smìrový vektor a zbývající ortogonální vektory jsou adekvátnì dopoèítány.
\subsection{Diatropismus}
\label{sec060602}\hypertarget{sec060602}{}%

Tento vzorec lze dále roz¹íøit na obecnìj¹í formu \hyperlink{eq06060201}{{\ref{eq06060201}}}. Jedná se o~takzvaný diatropismus, pøi nìm¾ se rostlinné orgány sna¾í se smìrovým vektorem podnìtu svírat úhel \ensuremath{\gamma}. Tato obecná forma tropismu lze vyu¾ít pro modelování rùzných jevù. Na obrázku lze vidìt ovlivnìní stromu pøi rùzných nastaveních. Implementace je obdobná jako u~geotropismu. Navíc jsou v¹ak dispozici parametry {\texttt{{TropismAngle}}} pro nastavení úhlu \ensuremath{\gamma} a {\texttt{{TropismVector}}} pro nastavení úhlu tropismu. Pru¾nost se zde nastavuje parametrem {\texttt{{TropismElasticity}}}.

Pro ka¾dý model lze nastavit maximálnì jeden takový podnìt. Zároveò v¹ak díky oddìlené implementaci lze v¾dy zároveò nastavit i geotropismus.

\begin{dbequation}
\begin{center}
\hypertarget{eq06060201}{}%
\ensuremath{\beta = e \left( \cos ( \gamma ) - \sin ( \gamma )  \frac{ \vec{H} \cdot \vec{T} }
                    { \bigl\vert \vec{H} \times \vec{T} \bigr\vert }  \right)}{{\caption{Výpoèet korekèního úhlu pøi diatropismu.}\label{eq06060201}}}
\end{center}
\end{dbequation}

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic06060201}{}%
\begin{center}

{{\includegraphics[]{06060201}}\hypertarget{id386377}{}%
\label{id386377}
}
{{\caption[{Stromy na obrázcích jsou generovány s~aplikovaným plagiotropismem dle parametrù v~tabulce {{\ref{tab06060201}}}.}]{{{Stromy na obrázcích jsou generovány s~aplikovaným plagiotropismem dle parametrù v~tabulce {{\ref{tab06060201}}}.}}}\label{pic06060201}}}
\end{center}
\end{figure}

% table ------------------------------------------------------
\begin{table}[htb]
\begin{center}%
\hypertarget{tab06060201}{}%
\begin{tabular}{cccc}
\hline 
{{Obrázek}} & {{Pru¾nost}} & {{Smìrový vektor diatropismu}} & {{Úhel diatropismu}} \tabularnewline
{{a}} & {{0.17}} & {{(0.0,1.0,0.0)}} & {{60}} \tabularnewline
{{b}} & {{0.2}} & {{(0.0,1.0,0.0)}} & {{90}} \tabularnewline
{{c}} & {{0.09}} & {{(0.7,1.0,0.0)}} & {{0}} \tabularnewline
{{d}} & {{0.2}} & {{(0.0,0.0,1.0)}} & {{90}} \tabularnewline
\hline 
\end{tabular}
{{\caption{Parametry diatropismu.}\label{tab06060201}}}
\label{tab06060201}
\end{center}
\end{table}

% ------------------------   
% Section 
\section{Fluktuace úhlù}
\label{sec0607}\hypertarget{sec0607}{}%

Jedním z~velkých kladù L-systémù je, ¾e ka¾dé slovo pøesnì odpovídá generované rostlinì. Nìkdy je v¹ak ¾ádoucí, aby bylo mo¾né pomocí minimálních zmìn vytvoøit organismus, který bude topologicky shodný, ale vizuálnì mírnì odli¹ný. Tímto zpùsobem lze z~jednoho ji¾ vygenerovaného slova vytváøet ne zcela identické jedince. Druhým argumentem pro zavedení toho mechanismu je èasto absolutní matematická pøesnost úhlù generovaných rostlin. Mírným náhodným roztøesením úhlù lze odstranit viditelnou pravidelnost a dosáhnout tak mnohem lep¹ích vizuálních výsledkù.

% figure ------------------------------------------------------
\begin{figure}[hbt]
\hypertarget{pic060701}{}%
\begin{center}

{{\includegraphics[]{060701}}\hypertarget{id386576}{}%
\label{id386576}
}
{{\caption[{Obrázek {\texttt{{a}}} je vykreslen bez fluktuace úhlù. Obrázky {\texttt{{b}}}, {\texttt{{c}}} a {\texttt{{d}}} mají fluktuaci nastavenou na 50\% a semínko 1, 2 a 3.}]{{{Obrázek {\texttt{{a}}} je vykreslen bez fluktuace úhlù. Obrázky {\texttt{{b}}}, {\texttt{{c}}} a {\texttt{{d}}} mají fluktuaci nastavenou na 50\% a semínko 1, 2 a 3.}}}\label{pic060701}}}
\end{center}
\end{figure}

Nastavením parametru {\texttt{{AngleVariance}}} lze toho efektu dosáhnou i v~zásuvném modulu {\em{LSystem}}. Jde o~hodnotu v~procentech, která udává o~kolik procent se mohou úhly maximálnì zmìnit. Pøi provádìní libovolné rotace ¾elvy kolem jedné z~jejich os, je pak úhel otoèení vynásoben náhodnou hodnotou získanou na základì tohoto parametru. I~pøi této náhodnosti lze nastavit náhodné semínko. Nastavením parametru {\texttt{{AngleFluctuationSeed}}} na stejnou hodnotu lze vytvoøit vícekrát stejného jedince. Pokud tento parametr není nastaven v~konfiguraèním souboru ani v~souboru L-systému, je jako semínko pou¾it systémový èas.

% -------------------------------------------------------------
% Chapter Výkonnostní testy modulu LSystem 
% ------------------------------------------------------------- 	
\chapter{Výkonnostní testy modulu LSystem}
\label{ch07}\hypertarget{ch07}{}%

Pøi implementaci zásuvného modulu byl brán ohled na optimalizaci celého procesu. Modul je navr¾en tak, aby bylo mo¾né vkládání stromù i jiných rostlin \glqq za bìhu\textquotedblleft{}. Dùraz byl kladen zejména na rychlost generování slov. V~pøechozích kapitolách této práce se vyskytují obrázky nìkolika vzorových modelù. Tabulka 7.1 obsahuje data namìøená pøi testování modulu LSystem. Pro testování byla pou¾ita následující poèítaèová sestava:

\begin{description}
% \null and \mbox are tricks to induce different typesetting decisions
\item[{CPU}]\null{}
Intel Core 2 Duo T9400 (2,53 GHz)
% \null and \mbox are tricks to induce different typesetting decisions
\item[{Operaèní pamì»}]\null{}
DDR2 PC5300 --- 3072 MB
% \null and \mbox are tricks to induce different typesetting decisions
\item[{Èipová sada}]\null{}
Mobile Intel GM965 Express
% \null and \mbox are tricks to induce different typesetting decisions
\item[{Grafická karta}]\null{}
nVidia GeForce 9600M GT 256 MB
\end{description}
\noindent 

% table ------------------------------------------------------
\begin{table}[htb]
\begin{center}%
\hypertarget{tab0701}{}%
\begin{tabular}{ccccccccc}
\hline 
\docbooktolatexalignll {{Obrázek modelu}} & {{\ensuremath{t_1}}} & {{\ensuremath{L}}} & {{\ensuremath{I}}} & {{\ensuremath{M}}} & {{\ensuremath{R}}} & {{\ensuremath{Q}}} & {{\ensuremath{t_2}}} & {{\ensuremath{T}}} \tabularnewline
{{\hyperlink{pic05050201}{{\ref{pic05050201}}} (a) --- D0L-systém}} & {{0,024}} & {{2}} & {{14}} & {{157002}} & {{4372}} & {{0}} & {{0,630}} & {{28419}} \tabularnewline
{{\hyperlink{pic05050201}{{\ref{pic05050201}}} (a) --- 0L-systém}} & {{0,061}} & {{2}} & {{14}} & {{157002}} & {{4372}} & {{0}} & {{0,628}} & {{28419}} \tabularnewline
{{\hyperlink{pic05050201}{{\ref{pic05050201}}} (a) --- 2L-systém}} & {{0,074}} & {{2}} & {{14}} & {{157002}} & {{4372}} & {{0}} & {{0,633}} & {{28419}} \tabularnewline
{{\hyperlink{pic05050201}{{\ref{pic05050201}}} (d) --- bez listù}} & {{0,053}} & {{1}} & {{25}} & {{110112}} & {{2693}} & {{0}} & {{0,092}} & {{340}} \tabularnewline
{{\hyperlink{pic05050201}{{\ref{pic05050201}}} (d) --- s~listy}} & {{0,055}} & {{2}} & {{25}} & {{110112}} & {{23491}} & {{0}} & {{0,187}} & {{5992}} \tabularnewline
{{\hyperlink{pic05050301}{{\ref{pic05050301}}} (c)}} & {{0,663}} & {{2}} & {{20}} & {{38753}} & {{14157}} & {{2883}} & {{0,107}} & {{47486}} \tabularnewline
{{\hyperlink{pic05050301}{{\ref{pic05050301}}} (a)}} & {{3,083}} & {{2}} & {{90}} & {{785429}} & {{226138}} & {{6552}} & {{0,168}} & {{172610}} \tabularnewline
\hline 
\end{tabular}
{{\caption{Výsledky testù výkonu zásuvného modulu LSystem.}\label{tab0701}}}
\label{tab0701}
\end{center}
\end{table}

Tabulka 7.1 obsahuje kromì èasu zpracování i mno¾ství zpracovaných dat a poèet provedených, po výkonnostní stránce dùle¾itých, operací. Ve¹keré èasy byly vypoèteny jako prùmìr z~pìti mìøení. Jednotlivé sloupce mají následující význam:

\begin{description}
% \null and \mbox are tricks to induce different typesetting decisions
\item[{\ensuremath{t_1}}]\null{}
Udává èas potøebný pro vygenerování slova v~sekundách. Jedná se tedy o~nahrání a zpracování L-systému a vykonání v¹ech iterací.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{\ensuremath{L}}]\null{}
Poèet pou¾itých L-systémù.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{\ensuremath{I}}]\null{}
Poèet iterací, je¾ byly provedeny na hlavním L-systému.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{\ensuremath{M}}]\null{}
Celkový poèet zpracovaných modulù.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{\ensuremath{R}}]\null{}
Jedná se poèet aplikací pøepisovacího pravidla rozdílného od identity.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{\ensuremath{Q}}]\null{}
Poèet zpracovaných dotazù.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{\ensuremath{t_2}}]\null{}
Èas interpretace v¹ech modulù a vytvoøení geometrie modelu.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{\ensuremath{T}}]\null{}
Celkový poèet vytvoøených ¾elv pro dotazy i geometrii.
\end{description}
\noindent 

Výsledky z~prvních tøí øádkù tabulky 7.1 patøí k~toto¾nému L-systému. Jedná se o~jednoduchý ternární strom generovatelný i D0L-systémem. Li¹í se pouze pou¾itým algoritmem pro generování. První øádek obsahuje èasy pøi generování modelu pomocí algoritmu pro D0L-systémy. Díky optimalizaci pro tento typ má tento algoritmus nejlep¹í výsledek pøi generování slova. Tento algoritmus je také automaticky zvolen pøi správném nastavení parametrù typu L-systému. Druhý øádek obsahuje hodnoty pøi generování toto¾ného modelu stochastickým parametrickým 0L-systémem. Hodnoty v~tøetím øádku pak byly získány pomocí generování algoritmem pro stochastické parametrické 2L-systémy. I~kdy¾ v~pøípadì tohoto modelu není rozdíl pro èlovìka znatelný, pøi generování del¹ích a komplikovanìj¹ích slov, èi vìt¹ího poètu L-systému, bude volba správného, pro daný úèel optimalizovaného, algoritmu dùle¾itá.

Dal¹ím modelem byl strom vytvoøený pomocí stochastického parametrického L-systému. Ètvrtý a pátý øádek tabulky nabízí srovnání generování modelu bez listù a s~listy. Tento model obsahuje ve svých pravidlech výrazy, je¾ jsou pøi ka¾dém pøepisu pøedchùdce na následníka vyhodnocovány. Zároveò také náhodnì vybírá pravidla dle podmínek, je¾ jsou s~ka¾dým modulem pøedchùdce rùzné. Poslední dva øádky obsahují hodnoty modelù kontextových L-systémù. Prvním z~nich je simulace ¾ivého plotu. Druhý pak simuluje chování stromu u~pøeká¾ky. Oba tyto modely vyu¾ívají kromì metod zmínìných u~pøedchozích modelù také mechanismus dotazù pro zji¹»ování polohy ¾elvy.

% -------------------------------------------------------------
% Chapter Závìr 
% ------------------------------------------------------------- 	
\chapter{Závìr}
\label{ch08}\hypertarget{ch08}{}%

Simulace pøírody je, a v~nejbli¾¹í budoucnosti nejspí¹ i bude, jednou z~nejvíce zkoumaných oblastí poèítaèové grafiky. Poznat a napodobit jevy kolem nás se sna¾í odborníci ji¾ od poèátku výpoèetní techniky. Generování rostlinných organismù je pro øadu vìdcù velkou výzvou. Jedná se sice o~geometricky slo¾ité organismy, jejich stavbu, vývoj a vlastnosti lze v¹ak èasto jednodu¹e matematicky popsat. Díky tomu se tímto tématem zabývá nìkolik výzkumných skupin a k~dispozici je vcelku velké mno¾ství literatury z~oblasti poèítaèové grafiky i biologie.

V~rámci této práce vznikl pro systém Vrecko jednodu¹e roz¹iøitelný zásuvný modul pracující s~L-systémy, je¾ jsou v~souèasné dobì nejvíce pou¾ívanou metodou pro generování rostlinných organismù. Pro vývoj tohoto modulu bylo zapotøebí nastudovat mno¾ství literatury, která se zabývá rùznými metodami generování slov pomocí L-systémù a vytváøením geometrie rostlinných organismù. Nutností v¹ak bylo zamìøit se i na materiály zabývající se biologickou stavbou rostlin. Pøi návrhu byl pak kladen velký dùraz na modulárnost a zároveò optimalizaci celého jádra zásuvného modulu. Byly proto navr¾eny specializované a rychlé datové struktury. Vìt¹ina tøíd je navr¾ena proti rozhraní a tak není problém libovolnou funkcionalitu roz¹íøit. Pro srozumitelnost a roz¹iøitelnost kódu byla øada tøíd navr¾ena pomocí návrhových vzorù.

Zásuvný modul se skládá ze dvou samostatných celkù. První z~nich generuje slova pomocí u¾ivatelsky zadaných L-systémù. Díky implementaci rùzných pokroèilých typù L-systému, je mo¾né vytváøet slova, je¾ simulují slo¾ité struktury a dodr¾ují rùzné pøírodní nebo i jiné zákonitosti. Výkonnostní testy ukázaly, ¾e pøepisovací proces je velice rychlý a nebrání tak ve vytváøení slov v~reálném èase. K~vìt¹ímu zpomalení nedochází ani pøi pou¾ití výrazù v~parametrických L-systémech a náhodného výbìru následníka dle zadaných kritérií. I~kontextové L-systémy jsou navr¾eny tak, ¾e je ovìøování kontextu jednoznaèné a dostateènì rychlé pro pou¾ití v~reálném èase. Razantnìj¹í zpomalení pøichází a¾ s~pou¾itím dotazù. Zji¹»ování polohy ¾elvy ji¾ v~dobì generování slova je èasovì nejnákladnìj¹í procedurou, která v¹ak umo¾òuje reakci L-sytému na okolí. Díky tomu byly vytvoøeny modely je¾ se automaticky vytváøejí a zastøíhávají do parametricky definovaného tvaru. U¾ivatelský vstup se provádí pomocí strukturovaných XML souborù s~L-systémy a jejich parametry.

Druhý samostatný celek se stará o~generování geometrie pomocí ¾elví grafiky. Je optimalizován pøedev¹ím pro tvorbu stromù, je¾ byly prvotním cílem této práce. K~dispozici jsou ¾elvy, které generují geometrii kmenù, stonkù i jednoduchých listù. Díky jednoduchým rozhraním je v¹ak jednodu¹e mo¾né mno¾ství implementovaných typù ¾elv roz¹íøit a vytváøet libovolná jiná pøírodní nebo umìlá geometrická tìlesa. I~zde je navíc implementována øada roz¹iøujícch metod, které dìlají modely zajímavìj¹ími a reálnìj¹ími.

Spojením tìchto dvou èástí vznikl modul, který umo¾òuje vytváøet velice ¹irokou ¹kálu modelù, které pak mohou být souèástí jiných grafických scén èi simulací systému Vrecko. Tato práce ukázala, jak zajímavé mù¾e generování rostlin být a snad také polo¾ila základní kámen generování rostlin v~tomto interaktivním virtuálním prostøedí.
% ------------------------------------------- 
%
%  Bibliography - chapter
%
% ------------------------------------------- 
\begin{thebibliography}{123}\hypertarget{id388881}{}

% ............. biblioentry 
\bibitem{Abel82}\docbooktolatexbibaux{id389494}{Abel82}
\hypertarget{id389494}
Abelson, H. a DiSessa, A.: \emph{Turtle geometry}, M.I.T. Press, 1982. 

% ............. biblioentry 
\bibitem{Bell08}\docbooktolatexbibaux{id389002}{Bell08}
\hypertarget{id389002}
Bell, A. a Bryan, A.: \emph{Plant form: an illustrated guide to flowering plant morphology}, Timber Press, 2008. 

% ............. biblioentry 
\bibitem{Bloom94}\docbooktolatexbibaux{id388966}{Bloom94}
\hypertarget{id388966}
Hanan, J.: \emph{Modeling the mighty maple}, Computer Graphics (SIGGRAPH '94 Conference Proceedings), 1985. 

% ............. biblioentry 
\bibitem{Deus05}\docbooktolatexbibaux{id389577}{Deus05}
\hypertarget{id389577}
Deussen, O. a Lintermann, B.: \emph{Digital Design of Nature: Computer Generated Plants and Organics}, Springer-Verlag, 2005, 978-3-540-40591-7. 

% ............. biblioentry 
\bibitem{Hanan92}\docbooktolatexbibaux{id388934}{Hanan92}
\hypertarget{id388934}
Hanan, J.: \emph{Parametric L-systems and their application to the modelling and visualisation of plants}, , 1992. 

% ............. biblioentry 
\bibitem{Holt94}\docbooktolatexbibaux{id389122}{Holt94}
\hypertarget{id389122}
Holton, M.: \emph{Strands, gravity and botanical tree imagery}, Computer Graphics Forum, 1994. 

% ............. biblioentry 
\bibitem{Kele86}\docbooktolatexbibaux{id389541}{Kele86}
\hypertarget{id389541}
Kelemenová, A.: \emph{Complexity of L-systems}, Springer-Verlag, 1986. 

% ............. biblioentry 
\bibitem{Koch05}\docbooktolatexbibaux{id389050}{Koch05}
\hypertarget{id389050}
von Koch, H.: \emph{Une méthode géométrique élémentaire pour l'étude de certaines questions de la théorie des courbes planes}, Acta mathematica, 1905. 

% ............. biblioentry 
\bibitem{Linden68}\docbooktolatexbibaux{id389086}{Linden68}
\hypertarget{id389086}
Lindenmayer, A.: \emph{Mathematical models for cellular interaction in development, Díl I~a II}, Journal of Theoretical Biology, 1968. 

% ............. biblioentry 
\bibitem{Mech97}\docbooktolatexbibaux{id389367}{Mech97}
\hypertarget{id389367}
Mìch, R. a Prusinkiewicz, P. a Hanan, J.: \emph{Extension to the graphical interpretion of L-systems based on turtle geometry}, CSIRO Publishing, 1997. 

% ............. biblioentry 
\bibitem{Mitch1972}\docbooktolatexbibaux{id389205}{Mitch1972}
\hypertarget{id389205}
Mitchinson, G. a Wilcox, M.: \emph{Rules governing cell division in Anabaena}, Nature, 1972. 

% ............. biblioentry 
\bibitem{Prusin04}\docbooktolatexbibaux{id388883}{Prusin04}
\hypertarget{id388883}
Prusinkiewicz, P. a Lindenmayer, A.: \emph{The Algorithmic Beauty of Plants}, Springer-Verlag, 1990, 9780387972978. 

% ............. biblioentry 
\bibitem{Prusin94}\docbooktolatexbibaux{id389252}{Prusin94}
\hypertarget{id389252}
Prusinkiewicz, P. a Kari, L.: \emph{Subapical bracketed L-systems}, Proceedings of the Fifth International Workshop on Graph Grammars and their Application to Computer Science, 1994. 

% ............. biblioentry 
\bibitem{Prusin96}\docbooktolatexbibaux{id389299}{Prusin96}
\hypertarget{id389299}
Prusinkiewicz, P. a Hammel, M. a Hanan, J. a Mìch, R.: \emph{L-systems: from the Theory to Visual Models of Plants}, CSIRO Publishing, 1996. 

% ............. biblioentry 
\bibitem{Rozen1980}\docbooktolatexbibaux{id389158}{Rozen1980}
\hypertarget{id389158}
Rozenberg, G. a Saloma, A.: \emph{The mathematical theory of L-systems}, Academic Press, 1980. 

% ............. biblioentry 
\bibitem{Zara04}\docbooktolatexbibaux{id389425}{Zara04}
\hypertarget{id389425}
®ára, J. a Bene¹, B. a Sochor, J. a Felkel, P.: \emph{Moderní poèítaèová grafika}, Computer Press, a.s., 2004. 

\end{thebibliography}
\addcontentsline{toc}{chapter}{Literatura}

\newcommand{\dbappendix}[1]{\chapter{#1}}%
% ------------------------------------------------------------- 
% Appendices start here
% -------------------------------------------------------------
\appendix

% -------------------------------------------------------------
% appendix:  Pøehled interpretovaných pøíkazù pro ¾elví grafiku 
% ------------------------------------------------------------- 	
\dbappendix{Pøehled interpretovaných pøíkazù pro ¾elví grafiku}
\label{appA}\hypertarget{appA}{}%

V~interpretaèní fází prochází instance nìkterého z~interpretù celý zpracovávaný øetìzec modulù zleva doprava. Jednotlivé moduly pak pøevede na pøíkaz buï nìkteré z~¾elv nebo pøímo zásobníku s~¾elvami.Tato pøíloha obsahuje pøehled v¹ech interpretovaných modulù, jejich identifikující znak a popis pøíkazu, který vykonají. Vìt¹ina modulù umo¾òuje zadání parametru. Pokud není tento parametr zadán, pou¾ije se výchozí hodnota nastavená v~konfiguraci modulu LSystem.

% ------------------------   
% Section 
\section{Rotace ¾elvy}
\label{secA01}\hypertarget{secA01}{}%

®elva mù¾e provádìt rotace pouze kolem nìkterého ze svých bázových vektorù.

\begin{description}
% \null and \mbox are tricks to induce different typesetting decisions
\item[{+($\alpha$)}]\null{}
Zmìní kurs rotací kolem osy U~o~úhel $\alpha$ doleva.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{-($\alpha$)}]\null{}
Zmìní kurs rotací kolem osy U~o~úhel $\alpha$ doprava.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{\&($\alpha$)}]\null{}
Provede podélný sklon rotací kolem osy L o~úhel $\alpha$ dolù.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{\textasciicircum{}($\alpha$)}]\null{}
Provede podélný sklon rotací kolem osy L o~úhel $\alpha$ nahoru.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{\textbackslash ($\alpha$)}]\null{}
Provede pøíèný náklon rotací kolem osy H o~úhel $\alpha$ doleva.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{/($\alpha$)}]\null{}
Provede pøíèný náklon rotací kolem osy H o~úhel $\alpha$ doprava.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{\docbooktolatexpipe{}}]\null{}
Provede otoèení do protismìru. Tento symbol odpovídá pøíkazu +(180) nebo -(180).
% \null and \mbox are tricks to induce different typesetting decisions
\item[{=}]\null{}
Vyrovná pøíèný náklon do vodorovné polohy vùèi pùvodnímu souøadnicovému systému.
\end{description}
\noindent 
% ------------------------   
% Section 
\section{Zmìna vlastností ¾elvy}
\label{secA02}\hypertarget{secA02}{}%

Tyto pøíkazy mìní hodnoty, je¾ jsou pou¾ity pøi bezparametrickém pou¾ití modulù.

\begin{description}
% \null and \mbox are tricks to induce different typesetting decisions
\item[{:(x)}]\null{}
Vynásobí hodnotu výchozího úhlu hodnotou {\em{x}}.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{'(x)}]\null{}
Vynásobí hodnotu výchozí délky kroku hodnotou {\em{x}}.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{!(x)}]\null{}
Vynásobí hodnotu výchozí tlou¹»ky kreslené èáry hodnotou {\em{x}}.
\end{description}
\noindent 
% ------------------------   
% Section 
\section{Zmìna pozice ¾elvy}
\label{secA03}\hypertarget{secA03}{}%

Tyto pøíkazy posouvají ¾elvu kupøedu ve smìru vektoru \ensuremath{\vec{H}}.

\begin{description}
% \null and \mbox are tricks to induce different typesetting decisions
\item[{F(x)}]\null{}
Posune ¾elvu o~délku x kupøedu. Tento pøíkaz generuje geometrii.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{Z}]\null{}
Posune ¾elvu kupøedu o~polovièní délku ne¾ je výchozí hodnota. Tento pøíkaz generuje geometrii.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{f(x)}]\null{}
Posune ¾elvu o~délku x kupøedu. Tento pøíkaz negeneruje geometrii.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{z}]\null{}
Posune ¾elvu kupøedu o~polovièní délku ne¾ je výchozí hodnota. Tento pøíkaz negeneruje geometrii.
\end{description}
\noindent 
% ------------------------   
% Section 
\section{Operace na zásobníku ¾elv}
\label{secA04}\hypertarget{secA04}{}%

Vìtvení a vkládání podøízených L-systémù zaji¹»ují pøíkazy pro manipulaci se zásobníkem ¾elv.

\begin{description}
% \null and \mbox are tricks to induce different typesetting decisions
\item[{[}]\null{}
Vlo¾í na zásobník novou ¾elvu, která sdìdí parametry od ¾elvy, je¾ byla na vrcholu zásobníku pøed ní.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{]}]\null{}
Odstraní z~vrcholu zásobníku ¾elvu.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{\#\{ID\}}]\null{}
Vlo¾í, a po interpretaci opìt odstraní, ¾elvu podøízeného L-systému. Parametr ID je unikátní identifikátor L-systému.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{\%}]\null{}
Vynutí násilné ukonèení vìtve. Odstraní v¹echny symboly dané vìtve, je¾ za tímto symbolem následují.
\end{description}
\noindent 
% ------------------------   
% Section 
\section{Zmìna nastavení tropismu}
\label{secA05}\hypertarget{secA05}{}%

Pomocí tìchto pøíkazù lze zmìnit pru¾nost ¾elv.

\begin{description}
% \null and \mbox are tricks to induce different typesetting decisions
\item[{;(x)}]\null{}
Vynásobí hodnotu pru¾nosti pøi diatropismu hodnotou {\em{x}}.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{\textasciitilde{}(x)}]\null{}
Vynásobí hodnotu pru¾nosti pøi geotropismu hodnotou {\em{x}}.
\end{description}
\noindent 
% -------------------------------------------------------------
% appendix:  Pøehled parametrù pro nastavení L-systémù 
% ------------------------------------------------------------- 	
\dbappendix{Pøehled parametrù pro nastavení L-systémù}
\label{appB}\hypertarget{appB}{}%

Zásuvný modul LSystem se pøi generování a interpretaci slova øídí celou øadou parametrù. Jejich globální nastavení nezávislé na konrétním L-systému lze provést v~konfiguraèním souboru. Parametry lze nastavit i pro konkrétní L-systém pøímo v~jeho souboru. Tato nastavení pak mají pøednost pøed globálními.

% ------------------------   
% Section 
\section{Parametry generátoru slov}
\label{secB01}\hypertarget{secB01}{}%

\begin{description}
% \null and \mbox are tricks to induce different typesetting decisions
\item[{Iteration}]\null{}
Pøi nastavení této hodnoty je po nahrání L-systému automaticky spu¹tìn iteraèní proces a provede se nastavený poèet iterací. Hodnota je typu {\texttt{{unsigned integer}}}.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{UseQueries}]\null{}
Povolí pou¾ití dotazù. Hodnota je typu {\texttt{{unsigned integer}}}.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{Ignore}]\null{}
Výèet znakù, je¾ budou ignorovány pøi párování kontextu. Hodnota je øetìzec znakù.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{RandomSeed}]\null{}
Nastaví semínko generátoru pseudonáhodných èísel. Pokud tento parametr není nastaven, pou¾ije se jako semínko systémový èas poèítaèe. Tento parametr lze nastavit pouze v~konfiguraèním souboru jako globální hodnotu. V~parametrech L-systému nebude mít ¾ádný vliv. Hodnota je typu {\texttt{{unsigned integer}}}.
\end{description}
\noindent 
% ------------------------   
% Section 
\section{Parametry ¾elvy}
\label{secB02}\hypertarget{secB02}{}%

\begin{description}
% \null and \mbox are tricks to induce different typesetting decisions
\item[{TurtleType}]\null{}
Nastaví typ ¾elvy, která bude interpretovat slovo.

Jedná se o~výètový typ a implementovány jsou tyto tøi typy:

\begin{description}
% \null and \mbox are tricks to induce different typesetting decisions
\item[{JOINTED\_PIPE}]\null{}
Vykresluje geometrii válcù s~klouby.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{STRAIGHT\_PIPE}]\null{}
Vykresluje geometrii navazujících válcovitých tìles.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{RECTANGLE}]\null{}
Vykresluje obdélníky. Vhodná pro jednoduché listy.
\end{description}
\noindent % \null and \mbox are tricks to induce different typesetting decisions
\item[{DefaultAngle}]\null{}
Nastaví výchozí úhel pro ve¹keré rotace ¾elvy. Hodnota je typu {\texttt{{double}}}.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{DefaultLength}]\null{}
Nastaví výchozí délku kroku ¾elvy. Hodnota je typu {\texttt{{double}}}.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{DefaultRadius}]\null{}
Nastaví výchozí polomìr èáry, kterou ¾elva kreslí. Hodnota je typu {\texttt{{double}}}.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{AngleMultiplier}]\null{}
Pøi bezparametrickém pou¾ití symbolu {\texttt{{:}}} je touto hodnotou vynásoben výchozí úhel. Hodnota je typu {\texttt{{double}}}.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{LengthMultiplier}]\null{}
Pøi bezparametrickém pou¾ití symbolu {\texttt{{'}}} je touto hodnotou vynásobena výchozí délka kroku. Hodnota je typu {\texttt{{double}}}.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{RadiusMultiplier}]\null{}
Pøi bezparametrickém pou¾ití symbolu {\texttt{{!}}} je touto hodnotou vynásoben výchozí polomìr kreslené èáry. Hodnota je typu {\texttt{{double}}}.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{DegreesToRadians}]\null{}
Pøi zadávání úhlù ve stupních musí být tato hodnota nastavena na 1.
\end{description}
\noindent 
% ------------------------   
% Section 
\section{Parametry vykreslované geometrie}
\label{secB03}\hypertarget{secB03}{}%

\begin{description}
% \null and \mbox are tricks to induce different typesetting decisions
\item[{ContourDetail}]\null{}
Tento parametr udává úroveò detailu vykreslované geometrie. U~extrudovaných tìles se jedná o~poèet vrcholù kontury. Hodnota je typu {\texttt{{unsigned integer}}}.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{AngleVariance}]\null{}
Tento parametr udává maximální procentuální náhodný výkyv úhlù. Hodnota je typu {\texttt{{unsigned integer}}}.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{DrawPipeCaps}]\null{}
Povolí vykreslování podstavy na konci válcovitých tìles. Hodnota je typu {\texttt{{unsigned integer}}}.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{MinimizeTwist}]\null{}
Povolí vyrovnávání pøíèného náklonu. Hodnota je typu {\texttt{{unsigned integer}}}.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{SeparateGeometryForTranslucent}]\null{}
Vynutí vytváøení uzlu pro ka¾dé vzkreslené tìleso s~prùhlednou texturou. Lze takto odstranit halo efekt u~listù za cenu sní¾ení výkonu. Hodnota je typu {\texttt{{unsigned integer}}}.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{Color}]\null{}
Nastaví barvu vykreslované geometrie. Pøi nastavení materiálù se barva neprojeví. Hodnota je vektor ve tvaru {\texttt{{(double,double,double)}}}.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{DiffuseMaterial}]\null{}
Nastaví difuzní slo¾ku materiálu geometrie. Hodnota je vektor ve tvaru {\texttt{{(double,double,double)}}}.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{SpecularMaterial}]\null{}
Nastaví spekulární slo¾ku materiálu geometrie. Hodnota je vektor ve tvaru {\texttt{{(double,double,double)}}}.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{AmbientMaterial}]\null{}
Nastaví ambientní slo¾ku materiálu geometrie. Hodnota je vektor ve tvaru {\texttt{{(double,double,double)}}}.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{DiffuseTexture}]\null{}
Nastaví texturu. Hodnota je cesta k~souboru textury.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{TextureSRepeatings}]\null{}
Nastaví poèet opakování textury po obvodu válcovité struktury. Hodnota je typu {\texttt{{unsigned integer}}}.
\end{description}
\noindent 
% ------------------------   
% Section 
\section{Tropismus}
\label{secB04}\hypertarget{secB04}{}%

\begin{description}
% \null and \mbox are tricks to induce different typesetting decisions
\item[{GravitropismElasticity}]\null{}
Nastaví pru¾nost modelu vzhledem ke gravitropismu. Hodnota je typu {\texttt{{double}}}.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{TropismElasticity}]\null{}
Nastaví pru¾nost modelu vzhledem k~diatropismu. Hodnota je typu {\texttt{{double}}}.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{TropismVector}]\null{}
Nastaví vektor pro diatropismus. Hodnota je vektor ve tvaru {\texttt{{(double,double,double)}}}.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{TropismAngle}]\null{}
Nastaví úhel pro diatropismus. Hodnota je typu {\texttt{{double}}}.
\end{description}
\noindent 
% ------------------------   
% Section 
\section{Geometrie pro ladìní}
\label{secB05}\hypertarget{secB05}{}%

\begin{description}
% \null and \mbox are tricks to induce different typesetting decisions
\item[{DrawDebugGeometry}]\null{}
Povolí vykreslování geometrie pro ladìní. Standardnì vykresluje polohové vektory ¾elvy pøi ka¾dém kroku. Hodnota je typu {\texttt{{unsigned integer}}}.
% \null and \mbox are tricks to induce different typesetting decisions
\item[{DebugGeometryScale}]\null{}
Mìøítko geometrie pro ladìní. Hodnota je typu {\texttt{{double}}}.
\end{description}
\noindent 
% -------------------------------------------------------------
% appendix:  Pøilo¾ené CD 
% ------------------------------------------------------------- 	
\dbappendix{Pøilo¾ené CD}
\label{appC}\hypertarget{appC}{}%

K~této diplomové práci je pøilo¾en kompaktní disk s~následujícím obsahem:

\begin{itemize}
%--- Item
\item 
Text této diplomové práce ve formátech PDF, PS a XML.

%--- Item
\item 
Ve¹keré pou¾ité obrázky ve formátu JPG.

%--- Item
\item 
Zdrojové kódy zásuvného modulu LSystem vèetnì projektových souborù pro Visual Studio 2005.

%--- Item
\item 
Dokumentace k~zásuvnému modulu LSystem.

%--- Item
\item 
Zkompilovaný zásuvný modul LSystem ve formì dynamické knihovny DLL.

%--- Item
\item 
Zkompilovaná aplikace Vrecko.

%--- Item
\item 
Dávkové soubory s~ukázkami generování stromù pomocí zásuvného modulu LSystem v~prostøedí Vrecko.

%--- Item
\item 
Archívy pou¾itých knihoven Boost a FunctionParser.

\end{itemize}
\noindent 

\end{document}

